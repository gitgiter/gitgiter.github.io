<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>gitgiter&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="gitgiter&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="gitgiter&#39;s blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gitgiter&#39;s blog">
  
    <link rel="alternate" href="/atom.xml" title="gitgiter&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gitgiter&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/22/hello-world/" class="article-date">
  <time datetime="2018-09-22T11:32:14.545Z" itemprop="datePublished">2018-09-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/22/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/22/hello-world/" data-id="cjmdefsxw000h5sq2i3xcs03h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw10-联机冰球对战" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/24/Unity3d-hw10-联机冰球对战/" class="article-date">
  <time datetime="2018-06-23T16:34:31.000Z" itemprop="datePublished">2018-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/24/Unity3d-hw10-联机冰球对战/">Unity-hw10-联机冰球对战</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Unity3d之联机冰球对战"><a href="#Unity3d之联机冰球对战" class="headerlink" title="Unity3d之联机冰球对战"></a>Unity3d之联机冰球对战</h1><hr>
<h2 id="1-游戏简介"><a href="#1-游戏简介" class="headerlink" title="1. 游戏简介"></a>1. 游戏简介</h2><p>一个简单的联机冰球对战小游戏，双方可在自己的视角分别控制</p>
<hr>
<h2 id="2-效果"><a href="#2-效果" class="headerlink" title="2. 效果"></a>2. 效果</h2><ul>
<li>静态图</li>
</ul>
<p><img src="/2018/06/24/Unity3d-hw10-联机冰球对战/scene.png" alt=""></p>
<ul>
<li>动态图</li>
</ul>
<p><img src="/2018/06/24/Unity3d-hw10-联机冰球对战/GIF.gif" alt=""></p>
<hr>
<h2 id="3-预备知识——Unity网络编程相关组件"><a href="#3-预备知识——Unity网络编程相关组件" class="headerlink" title="3. 预备知识——Unity网络编程相关组件"></a>3. 预备知识——Unity网络编程相关组件</h2><h3 id="3-1-浅谈个人对多人游戏与网络的一些看法"><a href="#3-1-浅谈个人对多人游戏与网络的一些看法" class="headerlink" title="3.1 浅谈个人对多人游戏与网络的一些看法"></a>3.1 浅谈个人对多人游戏与网络的一些看法</h3><ul>
<li>网络游戏可以说是目前最吸引各路游戏开发者的一大热点，尤其是多人游戏。因此，大多数游戏引擎及基本的开发语言都配有基本的成套的网络编程相关的功能或接口，如果一门开发语言或是游戏引擎不支持网络编程，那这个语言或是这类IDE肯定是走不远的。网络编程的运用在unity现在的游戏里面是必须的。完整的游戏都需要提供网络功能。</li>
<li>多人游戏与网络，相比单机的游戏，实现起来要复杂许多，但是可以实现更加丰富的功能。原理其实是很简单的，其实就是一个游戏的多个实例运行在不同的机器上，这些机器既可以是通过局域网互相连通，也可以是通过更广的网络连向世界各地。因此，要管理好这么多的实例，毫无疑问网络编程比较棘手的一个地方就是多个游戏实例之间的同步和通信，而一个实例里面就可能有成千上百的游戏对象，多人游戏更是可能涉及到上前上百万的游戏实例，这正是多人游戏与网络要解决的问题。</li>
<li>unity里面比较常用的是unet，更底层、高端的还有像planton、socket之类，相较而言，unet就显得更加轻便和容易使用，是一个轻量级的好工具，也由于unet的轻便特性，更加适合开发局域网内的联机游戏，虽然在做高级开发时可能会遇到一些瓶颈（Unity自带的Networkview对于广域网就很难适应，这里就要转向socket一类更加底层的实现），但作为初学者学习网络编程是再好不过的选择了。</li>
</ul>
<h3 id="3-2-一些重要概念（引自-这里-）"><a href="#3-2-一些重要概念（引自-这里-）" class="headerlink" title="3.2 一些重要概念（引自 这里 ）"></a>3.2 一些重要概念（引自 <a href="https://pmlpml.github.io/unity3d-learning/13-Multiplayer-and-Networking" target="_blank" rel="noopener">这里</a> ）</h3><ul>
<li>主机与服务器<ul>
<li>HOST：主机，运行服务器程序的机器</li>
<li>Server：服务器，游戏程序实例。它连接所有客户端，并管理所有客户端共享的游戏对象及部分需要同步的状态（属性）</li>
<li>Client：客户端，游戏程序实例。玩家游戏主机运行的程序</li>
<li>重要的关系图<br><img src="/2018/06/24/Unity3d-hw10-联机冰球对战/relation.png" alt=""></li>
</ul>
</li>
<li>游戏对象<ul>
<li><strong>网络游戏对象（Networked GameObjects）</strong> ：在服务器上注册，由孵化（也叫派生）系统（Spawning System）管理的对象，它必须包含 NetworkIdentity 组件，并用 NetworkBehaviour 脚本编程。</li>
<li><strong>玩家游戏对象（player GameObjects）</strong> ：是特殊的网络游戏对象，指一个 client 加入网络游戏，服务器创建并孵化到客户端，由玩家控制的游戏对象。客户端代码可以控制它们的状态，并自动有服务器同步到其他玩家的客户端。例如：联网赛车游戏，每个玩家都有属于自己的赛车。</li>
<li>关系图<br><img src="/2018/06/24/Unity3d-hw10-联机冰球对战/spawn.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="3-3-unet基本组件"><a href="#3-3-unet基本组件" class="headerlink" title="3.3 unet基本组件"></a>3.3 unet基本组件</h3><ul>
<li><p>NetworkManager（核心）。作为多玩家游戏的核心控制组件。通常挂载在一个空的物体，或者一个方便的管理物体上。</p>
<ul>
<li>Spawn Info属性集（重要）。最常用的一个组件属性，同时又由以下属性构成：<ul>
<li>PlayerPrefab。客户端加入时自动生成的预制对象，可以预先定义好。</li>
<li>AutoCreatePlayer。勾选表示自动生成上面定义好的PlayerPrefab。</li>
<li>PlayerSpawnMethod。指定具体的生成方法：<ul>
<li>Random。随机生成。</li>
<li>RoundRobin。轮询生成，适合用与对战游戏，在本次项目就采用这种生成方式，可以在指定的地点轮流生成（这里就要用到后面的NetworkStartPosition组件）</li>
</ul>
</li>
<li>RegisteredSpawnablePrefabs。注册接下来需要派生的预制对象，比如一些枪战游戏，子弹就需要在各个客户端同步，需要派生到各个客户端。在本次项目中则是冰球，也需要由服务器派生到客户端。这是一个预制对象的数组，数组中的游戏对象可以在网络中同步生成。</li>
</ul>
</li>
</ul>
</li>
<li><p>NetworkManagerHUD。一个基础的网络连接UI面板，适合用于简单的应用界面或者最初的开发调试界面（一般后期会被替换成更美观的UI）。所起的作用主要提供现成接口帮助实现前期的开发任务。</p>
</li>
<li><p>NetworkIdentity。将一个预制对象标识为网络中的对象及扮演的角色。</p>
<ul>
<li>ServerOnly。勾选表示该对象只在服务器端生成和存在。</li>
<li>LocalPlayerAuthority。勾选表示该对象可以在各个客户端中生成和存在，并由拥有它的客户端控制的，在对应客户端具有特定的权限，可以通过isLocalPlayer来识别。</li>
</ul>
</li>
<li><p>NetworkTransform。用于同步挂载了该组件的派生对象。</p>
<ul>
<li>NetworkSendRate（seconds）。同步的频率。0代表在生成是同步一次</li>
<li>TransformSyncMode。指定要被同步的组件。一般默认第二个，具有刚体数属性的预制会自动默认为后两个（根据刚体组件是2d还是3d决定）<ul>
<li>SyncNone。不同步其他组件</li>
<li>SyncTransform。同步Transform组件。</li>
<li>SyncRigidbody2D。同步Rigidbody2D组件。</li>
<li>SyncRigidbody3D。同步Rigidbody3D组件。</li>
</ul>
</li>
</ul>
</li>
<li><p>NetworkStartPosition（很有用，也是很必要的一个组件）。指定预制对象的初始位置（可以不同）。因为实际情况往往就很需要多个客户端的玩家对象初始在不同位置，如本项目的两个玩家必须在两对面，不用这个组件就很麻烦，会导致玩家对象都生成在同一个位置。</p>
</li>
<li><p>基本标识</p>
<ul>
<li>游戏对象判断<ul>
<li>IsClient。如果是正在运行的客户端对象，且是从服务器派生的，则为true。</li>
<li>IsLocalPlayer。如果是当前客户端的本地游戏对象（本地玩家——自己），则为true。</li>
<li>IsServer。如果这个对象是激活状态，且在一个被激活的服务器上，则为true。</li>
</ul>
</li>
<li>函数、变量判断<ul>
<li>[Command]。用来标识只能在服务端被调用的方法，这些方法名都必须以Cmd开头，且不能是静态方法，否则会导致编译错误。常用于比如联网发射子弹，状态同步只能通过服务器来同步，再派生到各个客户端，因此发射子弹需要由客户端调用服务端上的发射方法，即被[Command]标记的方法。如果该方法用[Command]标记而是任由客户端自己调用的话，在各个客户端之间子弹就是各飞各的，一个客户端射出的子弹不会被另外一个客户端感知。</li>
<li>[ClientRpc]。用来表示只能在客户端被调用的方法，服务器调用该方法时，也会在客户端调用。被标识的方法必须以Rpc开头。</li>
<li>[SyncVar]。用来标识需要同步的变量，可以将被标识的变量同步到所有的客户端和服务器端。作用也是非常大，再拿对战游戏来说，需要同步各个客户端之间的具有不同值的血条，这时就必须将这些记录血量的变量标识为同步变量，否则各个客户端上的变量都是互不相关。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>华丽的分割线——说了那么多，终于可以开始讲实现步骤了，多图预警。步骤有些繁琐（如仿作切勿遗漏），毕竟想实现这个游戏也是我一时脑洞兴起。</p>
<hr>
<h2 id="4-实现步骤"><a href="#4-实现步骤" class="headerlink" title="4. 实现步骤"></a>4. 实现步骤</h2><h3 id="4-1-网络管理对象设置"><a href="#4-1-网络管理对象设置" class="headerlink" title="4.1 网络管理对象设置"></a>4.1 网络管理对象设置</h3><p>经过以下几步，应该就有了一个空的游戏管理对象，包含了基本的网络控制器和用户控制界面。这些组件的所以属性都还是默认设置。</p>
<ul>
<li>创建一个空对象。</li>
<li>为其添加一个NetworkManager组件。</li>
<li>为其添加一个NetworkManagerHUD组件。</li>
</ul>
<h3 id="4-2-设置玩家对象预制"><a href="#4-2-设置玩家对象预制" class="headerlink" title="4.2 设置玩家对象预制"></a>4.2 设置玩家对象预制</h3><p>经过以下几步，应该就有了一个具有基本需要的网络玩家对象预制，其他代码脚本之后再添加。</p>
<ul>
<li>创建一个圆柱体。</li>
<li>创建一个球体，作为圆柱体的子对象。</li>
<li>适当调整两者参数，使得两者组合看起来像一个冰球对战的手柄（就是手抓的那个，具体名字不知道叫什么）</li>
<li>添加NetworkIdentity组件。由前面的预备知识可知，我们需要在客户端和服务端中对玩家对象进行区分。</li>
<li>添加NetwTransform组件。因为玩家对象的移动需要在多个客户端之间同步。</li>
<li>添加Rigidbody刚体组件。点开Constraints属性集，对玩家预制进行一些约束。我们的玩家对象是需要紧贴在游戏台（桌面）上移动的，因此我们冻结其与等下要制作的游戏台（桌面）所在平面垂直的轴，我的桌面是平放的，因此我冻结了它的y轴，也就是防止它在碰撞过程中飞起来。同样，还要防止它在碰撞中产生旋转（假设我们的握力无穷大，现实中我们玩这个也是不会让手柄转起来的），所以干脆把旋转的三个轴都冻结了。综上，冻结了位置的y轴，旋转的所有轴。</li>
<li>拖入project面板做成预制。</li>
</ul>
<h3 id="4-3-玩家预制的移动"><a href="#4-3-玩家预制的移动" class="headerlink" title="4.3 玩家预制的移动"></a>4.3 玩家预制的移动</h3><p>添加一个PlayerMove脚本，这里我直接把完整代码贴出来了，注释写得比较详细，结合前面的预备知识看。这个脚本我实现的功能主要是：</p>
<ul>
<li>对玩家对象移动的控制。这里我实现了键盘移动和鼠标拖拽的功能，大量的代码其实用来判断边界条件了，主要是为了防止玩家对象移出界。注意这里不再是使用MonoBehaviour，而是NetworkBehaviour，需要引入UnityEngine.Networking;命名空间。</li>
<li>识别本地玩家对象。我们需要对玩家对象进行区分，这里通过前面提到的IsLocalPlayer来区分本地玩家对象和非本地玩家对象——自己和对手，<strong>不区分的话会导致两个玩家对象同时被操控</strong>。我用了红色来标记本地玩家对象，方便辨认。</li>
<li>冰球的创建（这个在后面会详细说，这里简要提一下）。OnStartLocalPlayer是一个在本地玩家对象创建的时候会被调用的方法，在这个方法里面我生成了唯一（看起来是一个，但是服务器在不同客户端各派生了一个）的冰球，防止重复创建。</li>
<li><strong>摄像机角度的问题</strong>。只要是对战游戏，就会涉及到用户角度的问题，如何让两个玩家看起来都是自己控制的对象靠近自己这边。这个问题困扰了我很久，由于摄像机不是玩家对象，没法像初始化玩家对象位置时用NetworkTransform来指定不同的初始位置。<strong>最后，我想到了用两个摄像机，分别预先留在场景中，预先调好针对两个玩家的角度，然后在本地玩家创建时，将对方的摄像机灭活，这样就保证了每个玩家端都只有一个摄像机，且都是自己的角度。</strong></li>
<li><strong>由摄像机角度问题带来的移动问题</strong>。因为调整针对不同玩家的摄像机的时候，有个摄像机是翻转过来的，因此对于这个摄像机所活跃在的客户端，对玩家的运动需要反过来控制，也即是对x和z取个反。<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.Networking;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerMove</span> : <span class="title">NetworkBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> GameObject ballPrefab;</span><br><span class="line">    <span class="keyword">private</span> Vector3 screenPoint;</span><br><span class="line">    <span class="keyword">private</span> Vector3 offset;</span><br><span class="line">    <span class="keyword">private</span> Vector3 scanPos;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        scanPos = transform.position;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isLocalPlayer)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> x = Input.GetAxis(<span class="string">"Horizontal"</span>) * <span class="number">0.1</span>f;</span><br><span class="line">        <span class="keyword">var</span> z = Input.GetAxis(<span class="string">"Vertical"</span>) * <span class="number">0.1</span>f;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是哪边的玩家</span></span><br><span class="line">        <span class="keyword">if</span> (transform.position.z &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//向前不能越过中线，向后不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (transform.position.z + z &lt; <span class="number">0</span> &amp;&amp; transform.position.z + z &gt; <span class="number">-6</span>)</span><br><span class="line">            &#123;                </span><br><span class="line">                transform.Translate(<span class="number">0</span>, <span class="number">0</span>, z);</span><br><span class="line">            &#125;      </span><br><span class="line">            <span class="comment">//向左向右都不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (transform.position.x + x &lt; <span class="number">3.5</span> &amp;&amp; transform.position.x + x &gt; <span class="number">-3.5</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                transform.Translate(x, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//向前不能越过中线，向后不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (transform.position.z - z &gt; <span class="number">0</span> &amp;&amp; transform.position.z - z &lt; <span class="number">6</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                transform.Translate(<span class="number">0</span>, <span class="number">0</span>, -z);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//向左向右都不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (transform.position.x - x &lt; <span class="number">3.5</span> &amp;&amp; transform.position.x - x &gt; <span class="number">-3.5</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                transform.Translate(-x, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnMouseDown</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        screenPoint = Camera.main.WorldToScreenPoint(scanPos);</span><br><span class="line">        offset = scanPos - Camera.main.ScreenToWorldPoint(<span class="keyword">new</span> Vector3(Input.mousePosition.x, Input.mousePosition.y, screenPoint.z));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnMouseDrag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isLocalPlayer)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        Vector3 curScreenPoint = <span class="keyword">new</span> Vector3(Input.mousePosition.x, Input.mousePosition.y, screenPoint.z);</span><br><span class="line">        Vector3 curPosition = Camera.main.ScreenToWorldPoint(curScreenPoint) + offset;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> temp = transform.position;</span><br><span class="line">        <span class="comment">//判断是哪边的玩家</span></span><br><span class="line">        <span class="keyword">if</span> (transform.position.z &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//向前不能越过中线，向后不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (curPosition.z &lt; <span class="number">-0.5</span> &amp;&amp; curPosition.z &gt; <span class="number">-6</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                temp.z = curPosition.z;</span><br><span class="line">                transform.position = temp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//向左向右都不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (curPosition.x &lt; <span class="number">3.5</span> &amp;&amp; curPosition.x &gt; <span class="number">-3.5</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                temp.x = curPosition.x;</span><br><span class="line">                transform.position = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//向前不能越过中线，向后不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (curPosition.z &gt; <span class="number">0.5</span> &amp;&amp; curPosition.z &lt; <span class="number">6</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                temp.z = -curPosition.z;</span><br><span class="line">                transform.position = temp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//向左向右都不能超出边界</span></span><br><span class="line">            <span class="keyword">if</span> (curPosition.x &lt; <span class="number">3.5</span> &amp;&amp; curPosition.x &gt; <span class="number">-3.5</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                temp.x = -curPosition.x;</span><br><span class="line">                transform.position = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Debug.Log(<span class="string">"curPosition"</span> + curPosition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnStartLocalPlayer</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//创建冰球，且唯一</span></span><br><span class="line">        <span class="keyword">if</span> (GameObject.Find(<span class="string">"Ball(Clone)"</span>) == <span class="literal">null</span>)</span><br><span class="line">            CmdStart();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取消对方的摄像机</span></span><br><span class="line">        <span class="keyword">if</span> (transform.position.z &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject.Find(<span class="string">"Camera"</span>).SetActive(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置己方颜色</span></span><br><span class="line">        MeshRenderer[] temp = GetComponentsInChildren&lt;MeshRenderer&gt;();</span><br><span class="line">        <span class="keyword">foreach</span> (MeshRenderer m <span class="keyword">in</span> temp)</span><br><span class="line">        &#123;</span><br><span class="line">            m.material.color = Color.red;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    [<span class="meta">Command</span>]</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CmdStart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// This [Command] code is run on the server!</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// create the bullet object locally</span></span><br><span class="line">        <span class="keyword">var</span> ball = (GameObject)Instantiate(</span><br><span class="line">             ballPrefab,</span><br><span class="line">             <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0.002</span>f, <span class="number">0</span>),</span><br><span class="line">             Quaternion.identity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// spawn the bullet on the clients</span></span><br><span class="line">        NetworkServer.Spawn(ball);        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-4-注册联网玩家对象"><a href="#4-4-注册联网玩家对象" class="headerlink" title="4.4 注册联网玩家对象"></a>4.4 注册联网玩家对象</h3><p>到上一步为止，玩家对象应该算是大功告成了。这里就要将玩家对象注册到网络管理器中（也就是第一步做的那个空对象）。</p>
<ul>
<li>找到最开始创建的那个空对象，并展开NetworkManager组件。</li>
<li>找到Spawn Info属性集（默认被折叠），总之——展开。</li>
<li>找到 “Player Prefab” 插槽，拖入我们前面做好的玩家对象预制。</li>
<li>保存当前场景为scene（待会Build的时候需要添加现有场景）。</li>
</ul>
<h3 id="4-5-玩家对象初始化不同位置"><a href="#4-5-玩家对象初始化不同位置" class="headerlink" title="4.5 玩家对象初始化不同位置"></a>4.5 玩家对象初始化不同位置</h3><p>在前面的基础上，如果只用代码无论如何调节都会导致两个玩家对象初始化在同一个位置。玩家应该在不同的地点。NetworkStartPosition 组件可用于执行此操作。</p>
<ul>
<li>创建一个新的空对象 Pos1</li>
<li>添加 NetworkStartPosition 组件</li>
<li>将Pos1对象设置成其中一个玩家要被初始化的位置</li>
<li>创建第二个空对象 Pos2</li>
<li>添加 NetworkStartPosition 组件</li>
<li>将Pos1对象设置成另一个玩家要被初始化的位置</li>
<li>找到 NetworkManager 并选择它。</li>
<li>打开 “Spawn Info” 折页</li>
<li>将 Player Spawn Method 更改为 Round Robin。前面有提到这是轮询生成玩家对象。</li>
</ul>
<h3 id="4-6-冰球对象预制"><a href="#4-6-冰球对象预制" class="headerlink" title="4.6 冰球对象预制"></a>4.6 冰球对象预制</h3><p>冰球其实就是一个普通的圆柱体，但是要加一些关键的组件和脚本，见步骤。</p>
<ul>
<li>创建一个圆柱体，调参成所要的样子，比玩家对象直径略小即可。</li>
<li>添加NetworkIdentity组件。由前面的预备知识可知，我们需要在客户端和服务端中对玩家对象进行区分。</li>
<li>添加NetwTransform组件。因为玩家对象的移动需要在多个客户端之间同步。</li>
<li>添加Rigidbody刚体组件。点开Constraints属性集，对玩家预制进行一些约束。我们的玩家对象是需要紧贴在游戏台（桌面）上移动的，因此我们冻结其与等下要制作的游戏台（桌面）所在平面垂直的轴，我的桌面是平放的，因此我冻结了它的y轴，也就是防止它在碰撞过程中飞起来。同样，还要防止它在碰撞中产生旋转（假设我们的握力无穷大，现实中我们玩这个也是不会让手柄转起来的），所以干脆把旋转的三个轴都冻结了。综上，冻结了位置的y轴，旋转的所有轴。</li>
<li>拖入project面板做成预制。</li>
<li>在PlayerMove脚本组件上，找到 ballPrefab 插槽</li>
<li>将冰球预制件拖入 ballPrefab 插槽</li>
</ul>
<h3 id="4-7-冰球移动及碰撞脚本"><a href="#4-7-冰球移动及碰撞脚本" class="headerlink" title="4.7 冰球移动及碰撞脚本"></a>4.7 冰球移动及碰撞脚本</h3><p>这部分实现冰球的主要代码。主要包括基本的移动边界判断，以及碰撞的检测和响应。代码注释挺详细，就不多做解释了。<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Ball</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> speed = GetComponent&lt;Rigidbody&gt;().velocity;</span><br><span class="line">        <span class="comment">//Debug.Log("speed: " + speed);        </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果没有碰到上下边界，操作待扩展</span></span><br><span class="line">        <span class="keyword">if</span> (transform.position.z &gt; <span class="number">-6</span> &amp;&amp; transform.position.z &lt; <span class="number">6</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//transform.Translate(new Vector3(0, 0, speed.z));            </span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//碰到上下边界</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//碰到门，更改比分，重置球位置</span></span><br><span class="line">            <span class="keyword">if</span> (transform.position.x &gt; <span class="number">-1.5</span> &amp;&amp; transform.position.x &lt; <span class="number">1.5</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> score = GetComponent&lt;Score&gt;();</span><br><span class="line">                Debug.Log(score);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (transform.position.z &gt; <span class="number">0</span>)</span><br><span class="line">                    score.HostWin();</span><br><span class="line">                <span class="keyword">else</span> score.ClientWin();</span><br><span class="line"></span><br><span class="line">                transform.position = Vector3.zero;</span><br><span class="line">                GetComponent&lt;Rigidbody&gt;().velocity = Vector3.zero;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//z轴速度反向</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                speed.z = -speed.z;</span><br><span class="line">                GetComponent&lt;Rigidbody&gt;().velocity = speed;</span><br><span class="line">                Debug.Log(<span class="string">"up down bound speed: "</span> + speed);</span><br><span class="line">            &#125;            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//如果没有碰到左右边界，操作待扩展</span></span><br><span class="line">        <span class="keyword">if</span> (transform.position.x &gt; <span class="number">-3.5</span> &amp;&amp; transform.position.x &lt; <span class="number">3.5</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//transform.Translate(new Vector3(speed.x, 0, 0));</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//碰到左右边界，x轴速度反向</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            speed.x = -speed.x;</span><br><span class="line">            GetComponent&lt;Rigidbody&gt;().velocity = speed;</span><br><span class="line">            Debug.Log(<span class="string">"left right bound speed:"</span> + speed);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//速度衰减</span></span><br><span class="line">        <span class="comment">//speed *= 0.999f;</span></span><br><span class="line">        <span class="comment">//GetComponent&lt;Rigidbody&gt;().velocity = speed;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnCollisionEnter</span>(<span class="params">Collision collision</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> hit = collision.gameObject;</span><br><span class="line">        <span class="keyword">var</span> hitPlayer = hit.GetComponent&lt;PlayerMove&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (hitPlayer != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> ballRigid = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">            Debug.Log(<span class="string">"velocity: "</span> + ballRigid.velocity);</span><br><span class="line">            <span class="comment">//适当加速</span></span><br><span class="line">            <span class="comment">//ballRigid.velocity *= 2;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="4-8-注册联网冰球对象"><a href="#4-8-注册联网冰球对象" class="headerlink" title="4.8 注册联网冰球对象"></a>4.8 注册联网冰球对象</h3><p>这一步是要将冰球的预制声明为网络预制对象，以便服务器可以派生创建。</p>
<ul>
<li>选择 NetworkManager 并打开 “Spawn Info” 折叠</li>
<li>用 Add 按钮添加一个新的 spawn 预制件</li>
<li>将 Ball 预制件拖入新的 spawn 预制插槽</li>
</ul>
<h3 id="4-9-自己手动制作场景"><a href="#4-9-自己手动制作场景" class="headerlink" title="4.9 自己手动制作场景"></a>4.9 自己手动制作场景</h3><p>前面说了这么多场景，不如先来做一下场景。这个场景做法因人而异，因为场景也比较简单，所以自己手动搭了一个，当然调参数还是非常繁琐的，要耐心点。这里我就说一下我的场景的架构。</p>
<ul>
<li>架构一览图</li>
</ul>
<p><img src="/2018/06/24/Unity3d-hw10-联机冰球对战/desk_structure.png" alt=""></p>
<ul>
<li>Plane就是桌面，没改名字，和Walls并列。</li>
<li>Walls是旁边的墙（桌沿）的组合，为空对象。<ul>
<li>Left。左边的墙，Cube。</li>
<li>Right。右边的墙，Cube。</li>
<li>Line。中间的分界线（把高度设成很小很小，并且去掉Collider，假装是二维），Cube，蓝色用材质加。</li>
<li>Bottom。下边界（下桌沿）对象的组合，空对象。下边界分为三部分组成。<ul>
<li>Gate。球门，中间的红色部分，Cube，颜色用材质加。</li>
<li>Left。球门左边部分，Cube。</li>
<li>Right。球门右边部分，Cube。</li>
</ul>
</li>
<li>Top。上边界（上桌沿）对象的组合，空对象。<ul>
<li>Gate。球门，中间的红色部分，Cube，颜色用材质加。</li>
<li>Left。球门左边部分，Cube。</li>
<li>Right。球门右边部分，Cube。</li>
</ul>
</li>
</ul>
</li>
<li>参数都是精确计算过的，全都是刚好无缝衔接，这里就不一给出了。</li>
<li>给Plane添加Rigidbody刚体组件。并勾选Is Kinematic，去除运动学属性，以撑住其他物体，防止其他物体的重力导致下坠。</li>
<li>给Walls添加Rigidbody刚体组件。墙是需要碰撞的，但是墙不能移动，所以在Constraints里冻结所有位置轴和旋转轴。</li>
<li>近景效果图</li>
</ul>
<p><img src="/2018/06/24/Unity3d-hw10-联机冰球对战/desk.png" alt=""></p>
<h3 id="4-10-玩家分数同步"><a href="#4-10-玩家分数同步" class="headerlink" title="4.10 玩家分数同步"></a>4.10 玩家分数同步</h3><p>这部分负责完成玩家分数状态的同步和相关的UI界面。</p>
<ul>
<li>需要同步的变量。与对战胜负有关的变量是分数，这个分数既可以在场景中单独维护，由于这里有两个玩家，因此需要有两个分数变量，另外记录游戏状态也需要一个变量，这三个值都需要在网络中同步。这里我是挂载在冰球这个对象上，其实挂载一个空对象或者其他方便管理的对象都是可以的。</li>
<li>分数和游戏状态同步。这里要使用到的就是 [SyncVar] 标识，把一个变量标识为同步变量，也可以认为就是所有客户端共享的变量，因为这些被标记的变量都只能在服务端上修改，而所有客户端都可以通过访问服务端来获取变量。</li>
<li><p>服务端修改权限。这里用 IsServer 来限制权限，只允许服务端修改变量值。</p>
</li>
<li><p>Score。以分数变量为主的共享数据类，包括一些基本的get/set方法以及对共享变量的修改方法。</p>
</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.Networking;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Score</span> : <span class="title">NetworkBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Use this for initialization</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SyncVar</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> score1 = <span class="number">0</span>;</span><br><span class="line">    [<span class="meta">SyncVar</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> score2 = <span class="number">0</span>;</span><br><span class="line">    [<span class="meta">SyncVar</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> game = <span class="number">0</span>; <span class="comment">// status: 0=&gt;playing; 1=&gt;player1 win; 2=&gt;player2 win;    </span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HostWin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//保证在服务端上修改共享变量</span></span><br><span class="line">        <span class="keyword">if</span> (!isServer)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        score1++;</span><br><span class="line">        game = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ClientWin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//保证在服务端上修改共享变量</span></span><br><span class="line">        <span class="keyword">if</span> (!isServer)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        score2++;</span><br><span class="line">        game = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetHostScore</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> score1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetClientScore</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> score2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetGameStatus</span>(<span class="params"><span class="keyword">int</span> status</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        game = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetGameStatus</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> game;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>UserGUI。获取同步变量的值并以一定的UI界面呈现。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserGUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    GUIStyle LabelStyle1;</span><br><span class="line">    GUIStyle LabelStyle2;</span><br><span class="line">    GUIStyle ButtonStyle;</span><br><span class="line">    Score score;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        score = GetComponent&lt;Score&gt;();</span><br><span class="line">        Debug.Log(score);        </span><br><span class="line"></span><br><span class="line">        LabelStyle1 = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        LabelStyle1.fontSize = <span class="number">20</span>;</span><br><span class="line">        LabelStyle1.alignment = TextAnchor.MiddleCenter;</span><br><span class="line"></span><br><span class="line">        LabelStyle2 = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        LabelStyle2.fontSize = <span class="number">30</span>;</span><br><span class="line">        LabelStyle2.alignment = TextAnchor.MiddleCenter;</span><br><span class="line"></span><br><span class="line">        ButtonStyle = <span class="keyword">new</span> GUIStyle(<span class="string">"Button"</span>);</span><br><span class="line">        ButtonStyle.fontSize = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Continue</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        score.SetGameStatus(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (score != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//playing</span></span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">280</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Host: "</span> + score.GetHostScore(), LabelStyle1);</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">250</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Client: "</span> + score.GetClientScore(), LabelStyle1);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (score.GetGameStatus() == <span class="number">1</span>) <span class="comment">// host win</span></span><br><span class="line">            &#123;</span><br><span class="line">                GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">85</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Host win!"</span>, LabelStyle2);</span><br><span class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">70</span>, Screen.height / <span class="number">2</span>, <span class="number">140</span>, <span class="number">70</span>), <span class="string">"Continue"</span>, ButtonStyle))</span><br><span class="line">                &#123;</span><br><span class="line">                    Continue();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (score.GetGameStatus() == <span class="number">2</span>) <span class="comment">// client win</span></span><br><span class="line">            &#123;</span><br><span class="line">                GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">85</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Client win!"</span>, LabelStyle2);</span><br><span class="line">                <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">70</span>, Screen.height / <span class="number">2</span>, <span class="number">140</span>, <span class="number">70</span>), <span class="string">"Continue"</span>, ButtonStyle))</span><br><span class="line">                &#123;</span><br><span class="line">                    Continue();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-11-运行！"><a href="#4-11-运行！" class="headerlink" title="4.11 运行！"></a>4.11 运行！</h3><p>完成前面的所有步骤后，便是创建客户端了，实现客户端和服务端联机。</p>
<ul>
<li>使用菜单 File -&gt; Build Settings 打开 Build Settings 对话框。</li>
<li>按下 Add Open Scenes 按钮，将当前场景添加到版本</li>
<li>按 Build and Run 按钮创建构建。保存可执行文件为IceBall。</li>
<li>编译后的独立程序将启动，并显示分辨率选择对话框。</li>
<li>选择 windowed 复选框和较低的分辨率（为保持良好的流畅性），如800x600。</li>
<li>运行并连接（两个应用只要是一个当主机，一个当客户机即可）。<ul>
<li>点击Play按钮，程序将启动并显示 NetworkManager HUD 的UI界面。</li>
<li>从 NetworkManagerHUD 用户界面中，选择 LAN HOSTED 作为局域网主机启动。</li>
<li>切换回编辑器，点击运行按钮进入运行模式。</li>
<li>从 NetworkManagerHUD 用户界面中，选择 LAN Client 作为客户端连接到主机</li>
</ul>
</li>
<li>这时会发现就出现最开始的界面了，接下来就可以尽情地玩耍了。</li>
</ul>
<p><img src="/2018/06/24/Unity3d-hw10-联机冰球对战/scene.png" alt=""></p>
<hr>
<h2 id="5-其他"><a href="#5-其他" class="headerlink" title="5. 其他"></a>5. 其他</h2><p>在学了将近一个学期的3d游戏编程后，终于来到了令人激动的网络编程模块。通过本次实战，对unity中的网络编程乃至对整个网络游戏的开发流程有了一个相对清晰了思路，对网络编程的原理和机制也有了更深的了解。虽然可能实现起来一开始会摸不着头脑，但随着对网络编程由浅入深的了解，就能慢慢体会到网络编程的乐趣所在了，而且学会网络编程这一套思想，不止是unity开发，像是web，java，cocos的开发都是通吃的。</p>
<hr>
<h2 id="6-各种链接"><a href="#6-各种链接" class="headerlink" title="6. 各种链接"></a>6. 各种链接</h2><ul>
<li>b站视频地址</li>
</ul>
<p><a href="https://www.bilibili.com/video/av25456530/" target="_blank" rel="noopener">https://www.bilibili.com/video/av25456530/</a></p>
<ul>
<li>Github地址  </li>
</ul>
<p><a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework10" target="_blank" rel="noopener">https://github.com/gitgiter/unity3d-learning/tree/master/homework10</a></p>
<ul>
<li>CSDN博客地址</li>
</ul>
<p><a href="https://blog.csdn.net/Wonderful_sky/article/details/80788546" target="_blank" rel="noopener">https://blog.csdn.net/Wonderful_sky/article/details/80788546</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/24/Unity3d-hw10-联机冰球对战/" data-id="cjmdefsxa00035sq285n0mlr4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw9-AR小游戏" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/19/Unity3d-hw9-AR小游戏/" class="article-date">
  <time datetime="2018-06-19T15:46:33.000Z" itemprop="datePublished">2018-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/19/Unity3d-hw9-AR小游戏/">Unity3d-hw9-AR小游戏</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Unity3d之AR小游戏"><a href="#Unity3d之AR小游戏" class="headerlink" title="Unity3d之AR小游戏"></a>Unity3d之AR小游戏</h1><hr>
<h2 id="游戏简介"><a href="#游戏简介" class="headerlink" title="游戏简介"></a>游戏简介</h2><p>一个控制小飞龙躲避障碍物的小型AR跑酷游戏，有两个虚拟按钮可以控制飞龙向上或向下移动。</p>
<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><ul>
<li>静态图<br><img src="/2018/06/19/Unity3d-hw9-AR小游戏/effect.png" alt=""></li>
<li>动态图<br><img src="/2018/06/19/Unity3d-hw9-AR小游戏/GIF.gif" alt=""></li>
</ul>
<hr>
<h2 id="AR模型识别"><a href="#AR模型识别" class="headerlink" title="AR模型识别"></a>AR模型识别</h2><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><p>这里网上教程很多，就不详细阐述了，大致过程就是去高通（vuforia）官网注册一个账号同意相关协议，下载sdk并导入。然后创建一个app关联数据库，数据库中上传待识别的图像，然后等vuforia分析完识别图的特征点之后，将target作为一个unity editor的选项下载下来后也导入unity项目。最后是项目内的配置，需要配置根据之前创建app时密钥配置unity项目，然后将预制ImageTarget的目标设置成你要识别的图片。运行项目时将待识别的图片放置在电脑摄像头范围内即可。</p>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h3><ul>
<li>图像的星级<br>我们会注意到将识别图上传到数据库时，target项右侧会有星级显示，星级越高代表识别图的质量越高。你可能会问，何为识别图质量？识别图质量有什么用？答案是，你踩过坑之后就知道了。经试验，影响识别图最主要的因素就是待识别图的对比度，这里应该要极力避免使用有很多连续相同或相似大色块的图片，因为分析识别图特征点的原理是 <strong>根据色块边缘</strong> 来决定的，色彩变化越丰富，色块边缘、棱角就越多（如果棱角分布均匀且每个色块都很小那就再好不过了），进而特征点就越多，而特征点越多就意味着识别图质量越高。另外，以下三点则是我总结的识别图质量最主要影响的三个方面：<ul>
<li>星级越高越容易识别</li>
<li>星级越高识别速度越快</li>
<li>星级越高更不容易出现抖动</li>
</ul>
</li>
<li><p><strong>模型的抖动问题（比较棘手）</strong><br>识别出来的模型抖动问题一直是AR图像识别中存在的难题，这一定程度上和识别算法有关，很多识别工具也还没有做得很完善。因此我们能做的就是采取一些比较初级的措施来尽可能地避免模型抖动，高级的方法当然还有待研究。初级的方法我们就是要大致了解图像识别的原理，换句话说，就是尽可能地让图像容易识别和模型容易被渲染。我的话虽然识别图是五星的，但是一开始使用了一个比较复杂的模型，导致渲染模型时抖动比较剧烈，网上找了好多有关防抖动的原因，总结起来切入点主要有以下几个（一般推荐前两个）：</p>
<ul>
<li>提高识别图的星级，尽量使用容易识别的图（前面已经提到过）</li>
<li>使用更简单的模型，减少模型的面数，会使降低渲染难度</li>
<li>烘培场景，调整灯光。因为现场实时识别最大的问题就是光线和角度的不稳定或不恰当，导致模型会不停抖动。</li>
<li>优化识别算法（不在我们考虑范围内）</li>
</ul>
</li>
<li><p><strong>虚拟按钮的检测（尤其注意）</strong><br>虚拟按钮第一次接触的话，听起来是个很神奇的东西。因此感觉用虚拟按钮做什么都很有意思。但是这里有个很大的坑，就是 <strong>虚拟按钮必须在识别图范围内，否则无论怎么点都点不到！！！</strong> 一开始没有注意到，还以为是点击方式的问题，盲目实现导致花费了很多时间到头来发现实现不了，可以说这次项目基本时间都花在这个坑里了，因此最后也就只好交了一个比较简单的版本，这是由于没有弄清楚虚拟按钮的原理导致的。在网上搜了很多技术博客以及逛了许多技术论坛，有关的博客少之又少，因为往年没有布置过AR的作业，所以也没有师兄博客可以参考，总之就是几乎没有发现有人提过类似的问题，于是就不得已只好将目光投向虚拟按钮的实现原理。虚拟按钮的触发原理是，<strong>根据识别图被遮挡的特征点所在的位置来判断是否点击了按钮</strong>。为什么叫遮挡，遮挡了什么？这时才反应过来是虚拟按钮的点击是通过检测识别图的对应位置是否被遮挡了，所以按钮一定要在识别图范围内，更准确地说，是在特征点分布的范围内。这样就又带来一个问题，如何使在遮挡虚拟按钮时不要让识别目标丢失。因为一开始我用的识别图虽然是五星的，但特征点整体集中在中间区域，也就是我的图有很多留白，总体来说特征点太集中，遮挡一部分时虚拟按钮都还没响应就失去目标了，这是我遇到的又一个问题，至此才真正发现问题所在（当时以为把虚拟按钮放在识别图范围内了还没有效果，一度以为是触发方式的问题）。于是我就将识别图换成了一幅特征点分布比较均匀的图，并且将待识别图载体由原来用手机换成了平板（面积更大），或许还可以将待识别图打印到一张A4的彩印纸上。</p>
</li>
</ul>
<hr>
<h2 id="地图的动态维护"><a href="#地图的动态维护" class="headerlink" title="地图的动态维护"></a>地图的动态维护</h2><h3 id="地图结构"><a href="#地图结构" class="headerlink" title="地图结构"></a>地图结构</h3><p>分为好多间隔相同的列，每列有三个障碍物位置，不能全放满（要留条活路），因此允许放0~2个障碍物，这些位置的障碍物都是随机生成的。</p>
<h3 id="地图初始化（生成）"><a href="#地图初始化（生成）" class="headerlink" title="地图初始化（生成）"></a>地图初始化（生成）</h3><p>一开始初始化足够多的列，这里我是选择初始化5列，只要能保证移动的时候能衔接自然即可。然后针对每列的随机算法是，对每列的三个位置，随机不重复地挑选至多两个位置，然后在该位置上，随机决定该位置是否应该有障碍物。这样就可以完全使地图随机生成了。</p>
<h3 id="地图维护"><a href="#地图维护" class="headerlink" title="地图维护"></a>地图维护</h3><p>为了减少运行开销，对于移出视野的地图，应该进行销毁。另外，为了生成无尽的地图，应该也要在移动过程中动态生成新的地图拼接在原地图后面。这里我是采用一个队列来维护整个地图以及实现地图的移动，因为队列是不允许直接遍历的，所以我的遍历是将队列头部元素重新插入到队尾来遍历。</p>
<h3 id="地图部分完整代码"><a href="#地图部分完整代码" class="headerlink" title="地图部分完整代码"></a>地图部分完整代码</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Map</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">float</span> ydis = <span class="number">0.5</span>f;<span class="comment">//y间隔    </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span>[] ypos;<span class="comment">//y位置    </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">float</span> zdis = <span class="number">2</span>;<span class="comment">//z间隔    </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span>[] zpos;<span class="comment">//z位置</span></span><br><span class="line">    <span class="comment">//private GameObject[] barriers;//所有障碍物</span></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;GameObject&gt; barriers;<span class="comment">//所有障碍物</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> delta;<span class="comment">//移动距离</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//初始化队列</span></span><br><span class="line">        barriers = <span class="keyword">new</span> Queue&lt;GameObject&gt;();     </span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化y位置</span></span><br><span class="line">        ypos = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            ypos[i] = ydis * i + <span class="number">0.3</span>f; <span class="comment">//0.3是偏移</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化z位置</span></span><br><span class="line">        zpos = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">        &#123;            </span><br><span class="line">            zpos[i] = zdis * (i + <span class="number">1</span>f); <span class="comment">//保证障碍物全在视野外</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Debug.Log(ypos);</span><br><span class="line">        Debug.Log(zpos);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//移入视野前产生5列障碍物，确保移动过程中能无缝衔接</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">//每列的障碍物数量</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//每列的三个位置</span></span><br><span class="line">            <span class="keyword">bool</span>[] state = &#123; <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span> &#125;;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//随机一个位置</span></span><br><span class="line">                <span class="keyword">int</span> rpos = (<span class="keyword">int</span>)Random.Range(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">                <span class="comment">//该位置必须没有放置过</span></span><br><span class="line">                <span class="keyword">while</span> (state[rpos])</span><br><span class="line">                &#123;</span><br><span class="line">                    rpos = (<span class="keyword">int</span>)Random.Range(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                state[rpos] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//在该位置随机产生或不产生障碍物</span></span><br><span class="line">                <span class="keyword">float</span> rand = Random.Range(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (rand &lt; <span class="number">0.5</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//加载预制障碍物</span></span><br><span class="line">                    GameObject barrier = (GameObject)Instantiate(Resources.Load(<span class="string">"Barrier"</span>, <span class="keyword">typeof</span>(GameObject)), </span><br><span class="line">                        <span class="keyword">new</span> Vector3(<span class="number">0</span>, ypos[rpos], zpos[i]), Quaternion.identity, <span class="literal">null</span>);                    </span><br><span class="line">                    barrier.transform.parent = <span class="keyword">this</span>.transform;</span><br><span class="line">                    barrier.transform.position *= <span class="number">0.03</span>f;</span><br><span class="line">                    barrier.transform.localScale *= <span class="number">0.03</span>f;</span><br><span class="line">                    barrier.GetComponent&lt;BoxCollider&gt;().center = barrier.transform.position;</span><br><span class="line">                    barriers.Enqueue(barrier);</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//每列的障碍物不能超过2个</span></span><br><span class="line">                <span class="keyword">if</span> (count &gt;= <span class="number">2</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化距离</span></span><br><span class="line">        delta = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//移动</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//遍历队列</span></span><br><span class="line">        <span class="keyword">int</span> len = barriers.Count;</span><br><span class="line">        <span class="keyword">while</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//取出第一个</span></span><br><span class="line">            GameObject front = barriers.Peek();</span><br><span class="line">            front.transform.position -= <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0.0002</span>f);                       </span><br><span class="line">            barriers.Dequeue();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Debug.Log("front pos: " + front.transform.position);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//消除移出视野的障碍物                       </span></span><br><span class="line">            <span class="keyword">if</span> (front.transform.position.z &lt; <span class="number">-1</span> * <span class="number">0.03</span>f)</span><br><span class="line">            &#123;</span><br><span class="line">                Destroy(front);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//否则插回队列尾部</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                barriers.Enqueue(front);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            len--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//移动距离增加，注意相对坐标和绝对坐标的转换</span></span><br><span class="line">        delta += <span class="number">0.0002</span>f / <span class="number">0.03</span>f;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果移动了一个z间距，那么并产生新一列放在最后 </span></span><br><span class="line">        <span class="keyword">if</span> (delta &gt;= zdis)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(delta);</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>; <span class="comment">//每列的障碍物数量</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//每列的三个位置</span></span><br><span class="line">            <span class="keyword">bool</span>[] state = &#123; <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>&#125;; </span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//随机一个位置</span></span><br><span class="line">                <span class="keyword">int</span> rpos = (<span class="keyword">int</span>)Random.Range(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">                <span class="comment">//该位置必须没有放置过</span></span><br><span class="line">                <span class="keyword">while</span> (state[rpos])</span><br><span class="line">                &#123;</span><br><span class="line">                    rpos = (<span class="keyword">int</span>)Random.Range(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                state[rpos] = <span class="literal">true</span>;</span><br><span class="line">                Debug.Log(rpos);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//在该位置随机产生或不产生障碍物</span></span><br><span class="line">                <span class="keyword">float</span> rand = Random.Range(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (rand &lt; <span class="number">0.5</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//加载预制障碍物</span></span><br><span class="line">                    GameObject barrier = (GameObject)Instantiate(Resources.Load(<span class="string">"Barrier"</span>, <span class="keyword">typeof</span>(GameObject)),</span><br><span class="line">                        <span class="keyword">new</span> Vector3(<span class="number">0</span>, ypos[rpos], zpos[<span class="number">4</span>]), Quaternion.identity, <span class="literal">null</span>);</span><br><span class="line">                    barrier.transform.parent = <span class="keyword">this</span>.transform;</span><br><span class="line">                    barrier.transform.position *= <span class="number">0.03</span>f;</span><br><span class="line">                    barrier.transform.localScale *= <span class="number">0.03</span>f;</span><br><span class="line">                    barrier.GetComponent&lt;BoxCollider&gt;().center = barrier.transform.position;</span><br><span class="line">                    barriers.Enqueue(barrier);</span><br><span class="line">                    <span class="comment">//Debug.Log(barrier);</span></span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//每列的障碍物不能超过2个</span></span><br><span class="line">                <span class="keyword">if</span> (count &gt;= <span class="number">2</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            delta = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>其他实现如按钮的控制和移动范围的判断，以及按钮的点击放大效果等，比较简单就不列出来了，调参也是比较需要耐心，花时间的。</p>
<hr>
<ul>
<li>视频<br><a href="https://www.bilibili.com/video/av25227554/" target="_blank" rel="noopener">https://www.bilibili.com/video/av25227554/</a></li>
<li>Github地址  <a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework9" target="_blank" rel="noopener">https://github.com/gitgiter/unity3d-learning/tree/master/homework9</a></li>
<li>CSDN博客<br><a href="https://blog.csdn.net/Wonderful_sky/article/details/80744334" target="_blank" rel="noopener">https://blog.csdn.net/Wonderful_sky/article/details/80744334</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/19/Unity3d-hw9-AR小游戏/" data-id="cjmdefsxy000j5sq2alwxt4ha" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw8-背包系统" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/06/06/Unity3d-hw8-背包系统/" class="article-date">
  <time datetime="2018-06-05T16:03:50.000Z" itemprop="datePublished">2018-06-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/06/Unity3d-hw8-背包系统/">Unity3d-hw8-背包系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Unity3d实战之背包系统"><a href="#Unity3d实战之背包系统" class="headerlink" title="Unity3d实战之背包系统"></a>Unity3d实战之背包系统</h1><h2 id="选题要求"><a href="#选题要求" class="headerlink" title="选题要求"></a>选题要求</h2><p>参考unity官网的背包系统例子，实现一个简单的背包系统</p>
<h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><ul>
<li>静态图<br><img src="/2018/06/06/Unity3d-hw8-背包系统/scene.png" alt=""></li>
<li>动态图<br><img src="/2018/06/06/Unity3d-hw8-背包系统/GIF.gif" alt=""></li>
</ul>
<h2 id="知识准备"><a href="#知识准备" class="headerlink" title="知识准备"></a>知识准备</h2><ul>
<li>摄像机渲染<ul>
<li>Clearing Flags：<ul>
<li>Skybox：天空盒(默认项)。在屏幕空白处显示当前摄像机的天空盒，如果没有指定天空盒，则会显示默认背景色。</li>
<li>Solid Color：空白处将显示默认此处设置的背景色。</li>
<li>Depth only：仅深度，该模式用于对象不被裁剪。</li>
<li>Don’t Clear：不清除，该模式不清楚任何颜色和或深度缓存，但这样做每帧渲染的结果都会叠加在下一帧之上。</li>
</ul>
</li>
<li>Culling Mask： 摄像机渲染的层</li>
<li>Layers： 摄像机所在的层</li>
<li>Depth： 指定多个摄像机的渲染顺序</li>
<li>Rendering Path：渲染路径，设定摄像机的渲染方法</li>
<li>Projection：投影方式，分为透视和正交</li>
<li>Clipping Planes：剪裁平面，摄像机的渲染范围。Near为最近的点，Far为最远的点</li>
</ul>
</li>
<li>粒子系统<br>  粒子系统有许多大模块，比如最常用的有初始化模块、发射模块、粒子群形状模块，颜色随存活时间、速度变化的模块等。方便起见这里再把上次的粒子系统贴一遍。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">持续时间（Duration）</td>
<td style="text-align:center">粒子系统发射粒子的持续时间</td>
</tr>
<tr>
<td style="text-align:center">循环（Looping）</td>
<td style="text-align:center">粒子系统是否循环</td>
</tr>
<tr>
<td style="text-align:center">预热（Prewarm）</td>
<td style="text-align:center">当looping开启时，才能启动预热（Prewarm），游戏开始时粒子已经发射了一个周期</td>
</tr>
<tr>
<td style="text-align:center">初始延迟（Start Delay）</td>
<td style="text-align:center">粒子系统发射粒子之前的延迟。注意在prewarm（预热）启用下不能使用此项</td>
</tr>
<tr>
<td style="text-align:center">初始生命（Start Lifetime）</td>
<td style="text-align:center">以秒为单位，粒子存活数量</td>
</tr>
<tr>
<td style="text-align:center">初始速度（Start Speed）</td>
<td style="text-align:center">粒子发射时的速度</td>
</tr>
<tr>
<td style="text-align:center">初始大小（Start Size）</td>
<td style="text-align:center">粒子发射时的大小</td>
</tr>
<tr>
<td style="text-align:center">初始旋转（Start Rotation）</td>
<td style="text-align:center">粒子发射时的旋转值</td>
</tr>
<tr>
<td style="text-align:center">初始颜色（Start Color）</td>
<td style="text-align:center">粒子发射时的颜色</td>
</tr>
<tr>
<td style="text-align:center">重力修改器（Gravity Modifier）</td>
<td style="text-align:center">粒子在发射时受到的重力影响</td>
</tr>
<tr>
<td style="text-align:center">继承速度（Inherit Velocity）</td>
<td style="text-align:center">控制粒子速率的因素将继承自粒子系统的移动（对于移动中的粒子系统）</td>
</tr>
<tr>
<td style="text-align:center">模拟空间（Simulation Space）</td>
<td style="text-align:center">粒子系统在自身坐标系还是世界坐标系</td>
</tr>
<tr>
<td style="text-align:center">唤醒时播放（Play On Awake）</td>
<td style="text-align:center">如果启用粒子系统当在创建时，自动开始播放</td>
</tr>
<tr>
<td style="text-align:center">最大粒子数（Max Particles）</td>
<td style="text-align:center">粒子发射的最大数量</td>
</tr>
</tbody>
</table>
<h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ul>
<li>第一步，搭建UI界面。新建一个画布（Canvas），再创建一个Panel容器，里面包含UI界面的所有UI控件，比如背包区的九个格子和装备区的三个格子，每个格子都是一个Button控件，背包区和装备区的这些按钮的父级分别是Bag和Equip两个空对象，主要是为了添加GridLayout控件来控制子对象的布局，以及相应的控制脚本。基本的控件创建好之后，将画布设置成UI层，接着再创建一个保存鼠标图片的Image控件，这是为了暂存移动的图片达到交换目的，最后创建一个专门渲染UI层的摄像机，将其Culling Mask设置成UI层。这样UI层的搭建基本完成，剩下的就是对控件位置、大小等的参数调整，以及更改控件的图片。这里要注意的一点是，<strong>添加图片时必须先把原来的图片转成Sprite类型才可以被Image组件识别</strong>。<br>搭建完成后的文件结构<br><img src="/2018/06/06/Unity3d-hw8-背包系统/step1.png" alt=""><br>UI Camera设置<br><img src="/2018/06/06/Unity3d-hw8-背包系统/step1_2.png" alt=""><br>GridLayout组件的设置<br><img src="/2018/06/06/Unity3d-hw8-背包系统/step1_3.png" alt=""></li>
<li>第二步，搭建背景界面。这个比布置UI界面容易多了。为了让背景有点简单的动态特效，这里用到了一点粒子系统。首先新建一个空对象scene，然后右键scene-&gt;Effects-&gt;Particle System，便可把例子系统添加为其子对象。接着再新建一个空对象，用来显示背景图片，修改其Sprite Renderer的Sprite为要添加的背景图片即可。最后把主摄像机放到这个空对象下面，其渲染的层是默认层，无需修改。要注意的是必须确保UI层的渲染要介于背景层渲染和英雄层渲染之间，用摄像机的深度Depth控制。<br>搭建完成后的文件结构<br><img src="/2018/06/06/Unity3d-hw8-背包系统/step2.png" alt=""><br>主摄像机设置<br><img src="/2018/06/06/Unity3d-hw8-背包系统/step2_2.png" alt=""></li>
<li>第三步，搭建英雄层。这层就是用来渲染英雄的，为了和UI层区分开来以便拓展更多的功能。新建一个摄像机，负责渲染英雄层，将英雄作为该摄像机的子对象，并将英雄的所在层设置成英雄层（自定义的一个层）。<br>搭建完成后的总的文件结构<br><img src="/2018/06/06/Unity3d-hw8-背包系统/step3_1.png" alt=""><br>英雄摄像机的设置<br><img src="/2018/06/06/Unity3d-hw8-背包系统/step3_2.png" alt=""></li>
<li><p>第四步，实现画布随鼠标旋转。这里用的是老师上课提供的一个源码，我外加做了一些修改，原本是整个画布的旋转，但是感觉看起来怪怪的，我将其改成以中轴线为界，两边（背包区和装备区）分别旋转，鼠标在背包区的时候装备区不动，鼠标在装备区的时候背包区不动。因此便有了两份类似的代码，分别挂载在背包区的父级元素Bag上和装备区的父级元素Equip上。<br>以控制背包区随鼠标旋转的代码为例</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BagTilt</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Vector2 range = <span class="keyword">new</span> Vector2(<span class="number">50</span>f, <span class="number">30</span>f);</span><br><span class="line"></span><br><span class="line">    Transform mTrans;</span><br><span class="line">    Quaternion mStart;</span><br><span class="line">    Vector2 mRot = Vector2.zero;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mTrans = transform;</span><br><span class="line">        mStart = mTrans.localRotation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Vector3 pos = Input.mousePosition;</span><br><span class="line">        <span class="comment">//Debug.Log(pos);        </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> halfWidth = Screen.width * <span class="number">0.5</span>f;</span><br><span class="line">        <span class="keyword">float</span> halfHeight = Screen.height * <span class="number">0.5</span>f;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pos.x - halfWidth &lt; <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> x = Mathf.Clamp((pos.x - halfWidth) / halfWidth, <span class="number">-1</span>f, <span class="number">1</span>f);</span><br><span class="line">        <span class="keyword">float</span> y = Mathf.Clamp((pos.y - halfHeight) / halfHeight, <span class="number">-1</span>f, <span class="number">1</span>f);</span><br><span class="line">        mRot = Vector2.Lerp(mRot, <span class="keyword">new</span> Vector2(x, y), Time.deltaTime * <span class="number">5</span>f);</span><br><span class="line"></span><br><span class="line">        mTrans.localRotation = mStart * Quaternion.Euler(-mRot.y * range.y, -mRot.x * range.x, <span class="number">0</span>f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第五步，实现游戏的管理者。挂载到任何一个对象上都行，因为其执行与所挂在的对象无关，是对整个游戏场景的控制。这里我是挂载到Canvas上。游戏的管理者主要负责跟踪装备区的装备情况、装备类型的判断以及鼠标对象的单例化。这里为了方便添加脚本，在构造函数中采用循环为每个Button添加对应的脚本。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Manager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MouseImage mouse;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> IsWeapon1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> IsWeapon2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> IsWeapon3 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mouse = (MouseImage)FindObjectOfType(<span class="keyword">typeof</span>(MouseImage));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject.Find(<span class="string">"Grid"</span> + i).AddComponent&lt;Bag&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject.Find(<span class="string">"Weapon"</span> + i).AddComponent&lt;Equip&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MouseImage <span class="title">getMouse</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mouse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMouse</span>(<span class="params">MouseImage m</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mouse == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            mouse = m;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeapon1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> IsWeapon1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeapon2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> IsWeapon2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeapon3</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> IsWeapon3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWeapon1</span>(<span class="params"><span class="keyword">int</span> w1</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IsWeapon1 = w1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWeapon2</span>(<span class="params"><span class="keyword">int</span> w2</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IsWeapon2 = w2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWeapon3</span>(<span class="params"><span class="keyword">int</span> w3</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        IsWeapon3 = w3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第六步，实现对鼠标对象的维护。新建一个C#脚本MouseImage，挂载在MouseImage这个Image对象上。目的也就是，使得点击装备区或是背包区的时候，如果点击的格子里面有装备，则和鼠标上的图片发生交换，以达到将装备取出的效果，而且实现点击图片，图片跟随鼠标移动的效果。这个脚本主要负责装备类型的检测、鼠标图片的设置和图片跟随鼠标移动。Update部分鼠标坐标减去的值是为了不让鼠标上的图片阻挡了对按钮的点击。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MouseImage</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Manager GM;</span><br><span class="line">    <span class="keyword">private</span> Image mouseImage;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mouseType = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> z;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Sprite none;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon1;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon2;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon3;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GM = (Manager)FindObjectOfType(<span class="keyword">typeof</span>(Manager));</span><br><span class="line">        GM.setMouse(<span class="keyword">this</span>);</span><br><span class="line">        mouseImage = GetComponent&lt;Image&gt;();        </span><br><span class="line">        z = <span class="number">-400</span>;</span><br><span class="line"></span><br><span class="line">        weapon1 = GameObject.Find(<span class="string">"Grid1"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        weapon2 = GameObject.Find(<span class="string">"Grid2"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        weapon3 = GameObject.Find(<span class="string">"Grid3"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        none = GameObject.Find(<span class="string">"MouseImage"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMouseType</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mouseType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMouseType</span>(<span class="params"><span class="keyword">int</span> m</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mouseType = m;</span><br><span class="line">        <span class="keyword">switch</span> (m)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                mouseImage.sprite = none;</span><br><span class="line">                z = <span class="number">-400</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                mouseImage.sprite = weapon1;</span><br><span class="line">                z = <span class="number">100</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                mouseImage.sprite = weapon2;</span><br><span class="line">                z = <span class="number">100</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                mouseImage.sprite = weapon3;</span><br><span class="line">                z = <span class="number">100</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                mouseImage.sprite = none;</span><br><span class="line">                z = <span class="number">-400</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        transform.position = <span class="keyword">new</span> Vector3(Input.mousePosition.x - <span class="number">26</span>, Input.mousePosition.y - <span class="number">26</span>, z);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第七步，实现背包区的交换逻辑。这里主要是要赋予背包区按钮对点击事件的响应能力。比如做一些基本的判断：不管鼠标图片是否为空，如果点中有装备的格子，那么将发生交换，交换的时候要记录装备类型，其他情况一律不交换。为了避免重复添加的繁琐，我是直接在代码里面绑定点击事件，这样也便于修改。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Bag</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Manager GM;</span><br><span class="line">    <span class="keyword">private</span> Image gridImage;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mouseType = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Sprite none;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon1;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon2;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon3;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        GM = (Manager)FindObjectOfType(<span class="keyword">typeof</span>(Manager));</span><br><span class="line">        gridImage = GetComponent&lt;Image&gt;();</span><br><span class="line">        weapon1 = GameObject.Find(<span class="string">"Grid1"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        weapon2 = GameObject.Find(<span class="string">"Grid2"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        weapon3 = GameObject.Find(<span class="string">"Grid3"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        none = GameObject.Find(<span class="string">"Grid4"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        Debug.Log(gridImage.sprite == weapon1);</span><br><span class="line">        Debug.Log(weapon1);</span><br><span class="line">        Debug.Log(weapon2);</span><br><span class="line">        Debug.Log(weapon3);</span><br><span class="line">        <span class="keyword">this</span>.GetComponent&lt;Button&gt;().onClick.AddListener(OnBagButton);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnBagButton</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//Debug.Log("grid click");</span></span><br><span class="line">        mouseType = GM.getMouse().getMouseType();</span><br><span class="line">        <span class="keyword">if</span> (gridImage.sprite == none &amp;&amp; mouseType != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (mouseType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    gridImage.sprite = weapon1;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    gridImage.sprite = weapon2;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    gridImage.sprite = weapon3;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    gridImage.sprite = none;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            GM.getMouse().setMouseType(<span class="number">0</span>);          </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//Debug.Log(gridImage.sprite);</span></span><br><span class="line">            <span class="comment">//Debug.Log(mouseType);</span></span><br><span class="line">            <span class="keyword">if</span> (gridImage.sprite == none)</span><br><span class="line">            &#123;</span><br><span class="line">                GM.getMouse().setMouseType(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (gridImage.sprite == weapon1)</span><br><span class="line">            &#123;</span><br><span class="line">                GM.getMouse().setMouseType(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (gridImage.sprite == weapon2)</span><br><span class="line">            &#123;</span><br><span class="line">                GM.getMouse().setMouseType(<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (gridImage.sprite == weapon3)</span><br><span class="line">            &#123;</span><br><span class="line">                GM.getMouse().setMouseType(<span class="number">3</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (mouseType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:                    </span><br><span class="line">                    gridImage.sprite = none;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    gridImage.sprite = weapon1;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    gridImage.sprite = weapon2;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    gridImage.sprite = weapon3;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    gridImage.sprite = none;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;                 </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第八步，实现装备区的交换逻辑。这里同样是要赋予装备区按钮对点击事件的响应能力。比如稍有不同的简单判断：类似在背包区交换的原理和基础上，外加检测交换的装备类型是否符合该格子所应装备的类型，如果符合才允许交换。同样的，也是在代码里面绑定点击事件。这里我为了弥补添加装备时没有动画的遗憾，规定每次添加动作时英雄都播放一次攻击动画，播放完成后回到Idle状态。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Equip</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Manager GM;</span><br><span class="line">    <span class="keyword">private</span> Image weaponImage;</span><br><span class="line">    <span class="keyword">private</span> GameObject hero;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> mouseType;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon1;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon2;</span><br><span class="line">    <span class="keyword">public</span> Sprite weapon3;</span><br><span class="line">    <span class="keyword">public</span> Sprite none;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        GM = (Manager)FindObjectOfType(<span class="keyword">typeof</span>(Manager));</span><br><span class="line">        weaponImage = GetComponent&lt;Image&gt;();</span><br><span class="line">        hero = GameObject.Find(<span class="string">"Hero"</span>);</span><br><span class="line">        weapon1 = GameObject.Find(<span class="string">"Grid1"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        weapon2 = GameObject.Find(<span class="string">"Grid2"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        weapon3 = GameObject.Find(<span class="string">"Grid3"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        none = GameObject.Find(<span class="string">"Grid4"</span>).GetComponent&lt;Image&gt;().sprite;</span><br><span class="line">        Debug.Log(weapon1);</span><br><span class="line">        Debug.Log(weapon2);</span><br><span class="line">        Debug.Log(weapon3);</span><br><span class="line">        Debug.Log(none);</span><br><span class="line">        <span class="keyword">this</span>.GetComponent&lt;Button&gt;().onClick.AddListener(OnEquipButton);</span><br><span class="line">        mouseType = <span class="keyword">this</span>.name[<span class="keyword">this</span>.name.Length - <span class="number">1</span>] - <span class="string">'0'</span>;</span><br><span class="line">        Debug.Log(mouseType);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Update is called once per frame</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (hero.GetComponent&lt;Animation&gt;().IsPlaying(<span class="string">"Attack"</span>) == <span class="literal">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"idle"</span>, PlayMode.StopAll);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mouseType == <span class="number">1</span> &amp;&amp; GM.getWeapon1() == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GM.setWeapon1(<span class="number">0</span>);</span><br><span class="line">            weaponImage.sprite = weapon1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mouseType == <span class="number">2</span> &amp;&amp; GM.getWeapon2() == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GM.setWeapon2(<span class="number">0</span>);</span><br><span class="line">            weaponImage.sprite = weapon2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (mouseType == <span class="number">3</span> &amp;&amp; GM.getWeapon3() == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GM.setWeapon3(<span class="number">0</span>);</span><br><span class="line">            weaponImage.sprite = weapon3;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnEquipButton</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//Debug.Log("equiping");</span></span><br><span class="line">        <span class="keyword">int</span> _mouseType = GM.getMouse().getMouseType();</span><br><span class="line">        Debug.Log(_mouseType);</span><br><span class="line">        <span class="keyword">if</span> (weaponImage.sprite != <span class="literal">null</span> &amp;&amp; _mouseType == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            weaponImage.sprite = none;</span><br><span class="line">            GM.getMouse().setMouseType(mouseType);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (weaponImage.sprite == none &amp;&amp; _mouseType == mouseType)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (_mouseType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    weaponImage.sprite = none;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    GM.setWeapon1(<span class="number">1</span>);</span><br><span class="line">                    weaponImage.sprite = weapon1;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    GM.setWeapon2(<span class="number">1</span>);</span><br><span class="line">                    weaponImage.sprite = weapon2;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    GM.setWeapon3(<span class="number">1</span>);</span><br><span class="line">                    weaponImage.sprite = weapon3;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    weaponImage.sprite = none;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            GM.getMouse().setMouseType(<span class="number">0</span>);</span><br><span class="line">            Animation animation = hero.GetComponent&lt;Animation&gt;();</span><br><span class="line">            animation.Play(<span class="string">"Attack"</span>, PlayMode.StopAll);</span><br><span class="line">            animation.wrapMode = WrapMode.Once;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第九步，图片加工。在网上进行了一番搜索和筛选之后，选到比较符合心意的图，但是都是白底不透明的，放在界面上感觉很生硬。为了更加逼真地模仿，我用了ps对筛选好的图片进行了简单的抠图处理，使得每个装备除装备实体以外的部分都是透明的，同样美观起见，将没有装备时的鼠标图片也设置成一张全透明的图片。<br>效果对比（深色背景下才看得出差别）：  </p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">武器</th>
<th style="text-align:center">袖箭</th>
<th style="text-align:center">匕首</th>
<th style="text-align:center">斧子</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">处理前</td>
<td style="text-align:center"><img src="/2018/06/06/Unity3d-hw8-背包系统/weapon1.jpg" alt=""></td>
<td style="text-align:center"><img src="/2018/06/06/Unity3d-hw8-背包系统/weapon2.jpg" alt=""></td>
<td style="text-align:center"><img src="/2018/06/06/Unity3d-hw8-背包系统/weapon3.jpg" alt=""></td>
</tr>
<tr>
<td style="text-align:center">处理后</td>
<td style="text-align:center"><img src="/2018/06/06/Unity3d-hw8-背包系统/weapon1.png" alt=""></td>
<td style="text-align:center"><img src="/2018/06/06/Unity3d-hw8-背包系统/weapon2.png" alt=""></td>
<td style="text-align:center"><img src="/2018/06/06/Unity3d-hw8-背包系统/weapon3.png" alt=""></td>
</tr>
</tbody>
</table>
<ul>
<li>最后一步。核对所有代码挂载情况、文件结构以及摄像机的渲染情况，耐心慢慢调参。调好合适的位置后变可以正常的运行了。到此便和一开始展示的效果完全一致了。<br><img src="/2018/06/06/Unity3d-hw8-背包系统/GIF.gif" alt=""></li>
</ul>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>以上为个人理解，可能有误，仅供参考。</li>
<li>如感兴趣，可访问笔者Gayhub地址—<a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework8" target="_blank" rel="noopener">传送门</a></li>
<li>视频演示地址—<a href="https://www.bilibili.com/video/av24424927/" target="_blank" rel="noopener">传送门</a></li>
<li>csdn博客地址—<a href="https://blog.csdn.net/Wonderful_sky/article/details/80589009" target="_blank" rel="noopener">传送门</a></li>
</ul>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/06/06/Unity3d-hw8-背包系统/" data-id="cjmdefsxu000e5sq2y8z1goq5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw7-粒子系统" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/28/Unity3d-hw7-粒子系统/" class="article-date">
  <time datetime="2018-05-27T17:39:42.000Z" itemprop="datePublished">2018-05-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/28/Unity3d-hw7-粒子系统/">Unity3d-hw7-粒子系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Unity3d实战之粒子系统"><a href="#Unity3d实战之粒子系统" class="headerlink" title="Unity3d实战之粒子系统"></a>Unity3d实战之粒子系统</h1><h2 id="选题要求"><a href="#选题要求" class="headerlink" title="选题要求"></a>选题要求</h2><p>参考 <a href="http://i-remember.fr/en" target="_blank" rel="noopener">http://i-remember.fr/en</a> 这类网站，使用粒子流编程控制制作一些效果， 如“粒子光环”</p>
<h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><ul>
<li>静态图<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/scene.png" alt=""></li>
<li>动态图<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/GIF.gif" alt=""></li>
</ul>
<h2 id="知识准备"><a href="#知识准备" class="headerlink" title="知识准备"></a>知识准备</h2><p>粒子系统有许多大模块，比如最常用的有初始化模块、发射模块、粒子群形状模块，颜色随存活时间、速度变化的模块等。这里重点学习了一下最重要的初始化模块中各个参数的作用。<br>|参数|功能|<br>|:—:|:—:|<br>|持续时间（Duration）|粒子系统发射粒子的持续时间|<br>|循环（Looping）|粒子系统是否循环|<br>|预热（Prewarm）|当looping开启时，才能启动预热（Prewarm），游戏开始时粒子已经发射了一个周期|<br>|初始延迟（Start Delay）|粒子系统发射粒子之前的延迟。注意在prewarm（预热）启用下不能使用此项|<br>|初始生命（Start Lifetime）|以秒为单位，粒子存活数量|<br>|初始速度（Start Speed）|粒子发射时的速度|<br>|初始大小（Start Size）|粒子发射时的大小|<br>|初始旋转（Start Rotation）|粒子发射时的旋转值|<br>|初始颜色（Start Color）|粒子发射时的颜色|<br>|重力修改器（Gravity Modifier）|粒子在发射时受到的重力影响|<br>|继承速度（Inherit Velocity）|控制粒子速率的因素将继承自粒子系统的移动（对于移动中的粒子系统）|<br>|模拟空间（Simulation Space）|粒子系统在自身坐标系还是世界坐标系|<br>|唤醒时播放（Play On Awake）|如果启用粒子系统当在创建时，自动开始播放|<br>|最大粒子数（Max Particles）|粒子发射的最大数量|</p>
<h2 id="思路确定"><a href="#思路确定" class="headerlink" title="思路确定"></a>思路确定</h2><p>对 <a href="http://i-remember.fr/en" target="_blank" rel="noopener">http://i-remember.fr/en</a> 上的例子进行了一定的学习后，最后打算做一些改进和创新，利用其原理实现一个卫星带，再用这个卫星带实现一个卫星带围绕行星转的效果。详细过程请见实现步骤。</p>
<h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ul>
<li>第一步，新建一个空对象StarRing，注意将其位置设置成（0，0，0），然后添加一个粒子系统的组件，叫ParticleSystem，组建里面的各种参数先不用改动，<strong>推荐通过代码来修改</strong>，可以批量修改，方便快捷而且有利于团队合作、给别人参考等方面。如果直接在组件里改，其他人每次都需要加载对应的场景才看得到修改的参数，而且粒子系统参数众多，这样也不能很直观地看出修改了哪些参数。因此还是推荐写在代码里。<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/step1.png" alt=""><br><img src="/2018/05/28/Unity3d-hw7-粒子系统/step1_2.png" alt=""></li>
<li>第二步，从上一步可以看出，最开始默认的粒子似乎出现了材质丢失的情况，可能是因为<strong>新老版本材质球不兼容</strong>的原因导致的，也正好，我们可以自己找一些想要的材质，将其拖到承载ParticleSystem的对象上，就完成了对粒子的贴图。我在网上找了一张土壤表面的材质，大致充当一些小卫星的样子（拉近看可能效果没那么好）<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/step2.png" alt=""></li>
<li>第三步，为了匹配星空的背景，原来这样的默认背景肯定是不合适的，无法营造出那种效果。因此要将天空盒改成纯黑色的模仿宇宙中的光吞噬。更改步骤是上面菜单栏Window-&gt;Lighting-&gt;Settings-&gt;Skybox Material的材质改成黑色的即可，这里我是改成Defualt Material。<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/step3_1.png" alt=""><br><img src="/2018/05/28/Unity3d-hw7-粒子系统/step3_2.png" alt=""></li>
<li>第四步，创建一个球体Star，贴上木星贴图，充当大行星，位置设置在（0，0，0），位于粒子群中心，并让其自转，目的是模仿木星环围绕着木星转的情景，这里就没有设置木星的公转了，涉及到镜头跟随等其他一系列操作，不是这次作业的主要重点。<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/step4.png" alt=""></li>
<li><p>第五步，添加一个c#脚本，挂载到Star上，来控制Star的自转。这个代码只需要在update中添加如下代码，即可实现自转，相关原理有在之前的太阳系作业中学习过，这里就算是巩固复习了。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.transform.Rotate(Vector3.up * <span class="number">30</span> * Time.deltaTime);</span><br></pre></td></tr></table></figure>
</li>
<li><p>第六步，添加一个c#脚本，用来挂载到StarRing上，开始主要代码的编写，实现对粒子系统的控制。<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/step6.png" alt=""></p>
</li>
<li><p>第七步，为方便起见，创建一个类，来记录每个粒子所应该具有的基本信息。这样有利于提升代码<strong>美观度</strong>，<strong>可读性</strong>，也使得可<strong>扩展性</strong>大大增强，如果往后需要给每个粒子加基本属性信息的话，只需要在类中加一个成员，不用大幅度改动重要代码。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ParticleInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> radius = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> angle = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParticleInfo</span>(<span class="params"><span class="keyword">float</span> radius, <span class="keyword">float</span> angle</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.radius = radius;   <span class="comment">// 半径  </span></span><br><span class="line">        <span class="keyword">this</span>.angle = angle;     <span class="comment">// 角度  </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第八步，确定并添加和粒子系统初始化及管理有关的成员变量。成员变量应该<strong>越简越好</strong>，防止成员冗余造成额外的空间开销。这里其实最重要的就是前面三个成员变量，分别是粒子系统、粒子数组以及粒子信息数组。<strong>粒子系统</strong>就是大Boss，<strong>粒子数组</strong>主要是用来更细致地定义每个粒子的属性，最后可以通过粒子数组来设置粒子系统。而<strong>粒子信息数组</strong>则更多地扮演着一个对每个粒子信息进行统一集成和管理的角色，存储着随机生成的粒子半径和角度，可以用来计算每个粒子的位置，已确定粒子数组中每个元素的position。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ParticleSystem particleSys;  <span class="comment">// 粒子系统  </span></span><br><span class="line"><span class="keyword">private</span> ParticleSystem.Particle[] particleArr;  <span class="comment">// 粒子数组  </span></span><br><span class="line"><span class="keyword">private</span> ParticleInfo[] info; <span class="comment">// 粒子信息数组  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> speed = <span class="number">0.25</span>f;            <span class="comment">// 速度    </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> count = <span class="number">8000</span>;       <span class="comment">// 粒子数量</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第九步，初始化粒子系统。主要是要申请两个重要数组，以及设置整个粒子系统的初始速度和最大粒子量。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化粒子数组  </span></span><br><span class="line">    particleArr = <span class="keyword">new</span> ParticleSystem.Particle[count];</span><br><span class="line">    info = <span class="keyword">new</span> ParticleInfo[count];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化粒子系统  </span></span><br><span class="line">    particleSys = <span class="keyword">this</span>.GetComponent&lt;ParticleSystem&gt;();</span><br><span class="line">    particleSys.loop = <span class="literal">false</span>;              <span class="comment">// 取消粒子循环</span></span><br><span class="line">    particleSys.startSpeed = <span class="number">0</span>;            <span class="comment">// 设置粒子初速度      </span></span><br><span class="line">    particleSys.maxParticles = count;      <span class="comment">// 设置最大粒子量  </span></span><br><span class="line">    particleSys.Emit(count);               <span class="comment">// 发射粒子  </span></span><br><span class="line">    particleSys.GetParticles(particleArr);</span><br><span class="line"></span><br><span class="line">    IniAll();   <span class="comment">// 初始化所有粒子</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第十步，初始化所有粒子。这里主要随机产生一些粒子的信息，比如粒子半径，角度，大小等。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IniAll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;                </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; ++i)</span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="comment">// 随机每个粒子半径，集中于平均半径附近  </span></span><br><span class="line">        <span class="keyword">float</span> midRadius = <span class="number">8.0</span>f;</span><br><span class="line">        <span class="keyword">float</span> radius = Random.Range(midRadius - <span class="number">2</span>, midRadius + <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 随机每个粒子的角度  </span></span><br><span class="line">        <span class="keyword">float</span> angle = Random.Range(<span class="number">0</span>, <span class="number">360</span>);</span><br><span class="line">        <span class="comment">// 转换成弧度制</span></span><br><span class="line">        <span class="keyword">float</span> radian = angle / <span class="number">180</span> * Mathf.PI;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 随机每个粒子的大小</span></span><br><span class="line">        <span class="keyword">float</span> size = Random.Range(<span class="number">0.01</span>f, <span class="number">0.03</span>f);</span><br><span class="line"></span><br><span class="line">        info[i] = <span class="keyword">new</span> ParticleInfo(radius, angle);            </span><br><span class="line"></span><br><span class="line">        particleArr[i].position = <span class="keyword">new</span> Vector3(info[i].radius * Mathf.Cos(radian), <span class="number">0</span>f, info[i].radius * Mathf.Sin(radian));</span><br><span class="line">        particleArr[i].size = size;            </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过初始化好的粒子数组设置粒子系统</span></span><br><span class="line">    particleSys.SetParticles(particleArr, particleArr.Length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后一步！重写update方法，每帧刷新以实现粒子群移动的效果，对i模2是为了是粒子运动效果更加丰富，可以同时有顺时针和逆时针移动的粒子。但是在真实情况中卫星带中的小卫星旋转方向应该都是大致一致的，不然会出大事，这里主要是为了体验一下粒子系统强大运算能力的魅力。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 除以半径是为了使速度更加多样化</span></span><br><span class="line">        <span class="keyword">float</span> rotateSpeed = (speed / info[i].radius) * (i % <span class="number">10</span> + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 一半粒子顺时针转，一半粒子逆时针转</span></span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            info[i].angle -= rotateSpeed;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            info[i].angle += rotateSpeed;</span><br><span class="line">        &#125;                </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保证角度合法</span></span><br><span class="line">        info[i].angle %= <span class="number">360.0</span>f;</span><br><span class="line">        <span class="comment">// 转换成弧度制</span></span><br><span class="line">        <span class="keyword">float</span> radian = info[i].angle * Mathf.PI / <span class="number">180</span>;     </span><br><span class="line"></span><br><span class="line">        particleArr[i].position = <span class="keyword">new</span> Vector3(info[i].radius * Mathf.Cos(radian), <span class="number">0</span>f, info[i].radius * Mathf.Sin(radian));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过粒子数组设置粒子系统</span></span><br><span class="line">    particleSys.SetParticles(particleArr, particleArr.Length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>经历过之前的所有方法后，我们就可以把代码跑起来了，内心激动，但是一看效果，贼尬，卫星带边缘如此明显，看着极其不自然。<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/edge.png" alt=""></p>
</li>
<li>于是上网搜了搜柔滑边缘的方法，看到大神是这么处理的。巧妙地使用比例随机来柔滑边缘，一看似乎很有道理，决定参照模仿一下，效果惊人。主要改动如下：<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IniAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;          </span><br><span class="line">    <span class="keyword">float</span> minRadius = <span class="number">6.0f</span>;  <span class="comment">// 最小半径  </span></span><br><span class="line">    <span class="keyword">float</span> maxRadius = <span class="number">10.0f</span>; <span class="comment">// 最大半径           </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; ++i)</span><br><span class="line">    &#123;   </span><br><span class="line">        <span class="comment">// 随机每个粒子半径，集中于平均半径附近  </span></span><br><span class="line">        <span class="keyword">float</span> midRadius = (maxRadius + minRadius) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">float</span> minRate = Random.Range(<span class="number">1.0f</span>, midRadius / minRadius);</span><br><span class="line">        <span class="keyword">float</span> maxRate = Random.Range(midRadius / maxRadius, <span class="number">1.0f</span>);</span><br><span class="line">        <span class="keyword">float</span> radius = Random.Range(minRadius * minRate, maxRadius * maxRate);</span><br><span class="line"></span><br><span class="line">        ...         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过初始化好的粒子数组设置粒子系统</span></span><br><span class="line">    particleSys.SetParticles(particleArr, particleArr.Length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>改后效果：<br><img src="/2018/05/28/Unity3d-hw7-粒子系统/NoEdge.png" alt=""></p>
<ul>
<li>优化，采用类似的原理，可以让每个粒子在一个很小的位置范围内抖动，让画面更加真实带感，实现方法是在update方法中可以加入一下随机的偏移量。<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 粒子在半径方向上抖动           </span></span><br><span class="line">        <span class="keyword">float</span> offset = Random.Range(<span class="number">-0.01</span>f, <span class="number">0.01</span>f);  <span class="comment">// 偏移范围</span></span><br><span class="line">        info[i].radius += offset;</span><br><span class="line"></span><br><span class="line">        particleArr[i].position = <span class="keyword">new</span> Vector3(info[i].radius * Mathf.Cos(radian), <span class="number">0</span>f, info[i].radius * Mathf.Sin(radian));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过粒子数组设置粒子系统</span></span><br><span class="line">    particleSys.SetParticles(particleArr, particleArr.Length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>到此便和一开始展示的效果完全一致了。</p>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>以上为个人理解，可能有误，仅供参考。</li>
<li>如感兴趣，可访问笔者Gayhub地址—<a href="(https://github.com/gitgiter/unity3d-learning/tree/master/homework7">传送门</a></li>
<li>视频演示地址—<a href="https://www.bilibili.com/video/av24039975/" target="_blank" rel="noopener">传送门</a></li>
<li>csdn博客地址—<a href="https://mp.csdn.net/mdeditor/80474739" target="_blank" rel="noopener">传送门</a></li>
</ul>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/28/Unity3d-hw7-粒子系统/" data-id="cjmdefsxt000c5sq2p1k4fa81" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw6-巡逻兵" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/11/Unity3d-hw6-巡逻兵/" class="article-date">
  <time datetime="2018-05-11T15:44:17.000Z" itemprop="datePublished">2018-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/11/Unity3d-hw6-巡逻兵/">Unity3d-hw6-巡逻兵</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="巡逻兵——MVC-工厂-订阅与发布模式"><a href="#巡逻兵——MVC-工厂-订阅与发布模式" class="headerlink" title="巡逻兵——MVC+工厂+订阅与发布模式"></a>巡逻兵——MVC+工厂+订阅与发布模式</h1><h2 id="游戏简介"><a href="#游戏简介" class="headerlink" title="游戏简介"></a>游戏简介</h2><p>巡逻兵游戏是一款敏捷类游戏，我将游戏规则制定如下：</p>
<ul>
<li>英雄：玩家</li>
<li>怪物：巡逻兵</li>
<li>当英雄出现在怪物一定范围内，怪物会开启追捕模式，即速度加快</li>
<li>每躲过一个巡逻兵的追捕，获得1分</li>
<li>当英雄没有进入怪物的搜寻范围时，怪物随机移动</li>
<li>被怪物追捕到即游戏结束</li>
<li>创新点：规则简单，游戏地形较复杂<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2></li>
</ul>
<ol>
<li>MVC模式<br>MVC模式在之前的有关牧师与魔鬼的博客中有详细解释过，这里沿用的是牧师与魔鬼的MVC框架，在此基础上做了一些改动，如果有兴趣可以到我的相关博客查看，这次主要解释下面两个模式。</li>
<li>工厂模式</li>
</ol>
<ul>
<li>为什么需要工厂模式<br>游戏对象的创建与销毁成本较高，所以当游戏涉及大量游戏对象的创建与销毁时，必须考虑减少销毁次数，比如这次的打飞碟游戏，或者像其他类型的射击游戏，其中子弹或者中弹对象的创建与销毁是很频繁的。</li>
<li>工厂模式的定义<br>工厂模式是我们最常用的实例化对象模式了，是用工厂方法代替new操作的一种模式。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</li>
<li>工厂模式的结构<br>游戏对象的创建与销毁，分别对应工厂里面的两个List，这两个List分别存放正在使用的游戏对象，已失效的游戏对象。同时保存两个List的目的是，减少游戏对象的创建与销毁的性能开销。如果已失效的List里面还有item，而这时工厂又需要完成一个新的“订单”，便可以从这些回收的item中拿出来再加工（一些逻辑处理），再返回给用户（调用方）。  </li>
<li>工厂模式的优缺点<ul>
<li>优点 <ul>
<li>一个调用者想创建一个对象，只要知道其名称就可以了。 - 扩展性高，如果想增加一个产品，只要扩展一个工厂类就可以。 </li>
<li>屏蔽产品的具体实现，调用者只关心产品的接口。</li>
<li>例子，如果一个客户需要一辆汽车，可以直接从工厂里面提货，而不用去管这辆汽车是怎么做出来的，以及这个汽车里面的具体实现。</li>
</ul>
</li>
<li>缺点<ul>
<li>一开始实现会比较复杂，需要用心设计一下工厂的结构</li>
<li>每增加一个产品，可能都需要对工厂进行一次较大的“整改”</li>
<li>如果工厂太大，实时保存的所有游戏对象的开销可能要大于游戏对象直接创建与销毁</li>
</ul>
</li>
</ul>
</li>
<li>工厂模式的意义（以上次打飞碟代码为例，我觉得上次的比较典型）<br>体现了面向对象设计的核心——抽象、包装、隐藏。道具工厂通过场景单实例，构建了可以被方便获取的disk类。包装了复杂的disk生产和回收逻辑，易于使用。包装了disk的产生规则，有利于应对未来游戏规则的变化，易于维护。</li>
<li>本次作业的工厂模式<br>本次巡逻兵的项目作业，还是按照要求套用了工厂模式，但由于我的规则设置比较简单，在套用上次的工厂模式框架后其实发现没什么必要，因为我的巡逻兵数目是固定的，从头到尾就是6个，没有新增也没有销毁，当时有想过随着时间的增加而增加巡逻兵的数量以增加游戏难度，以及玩家攻击巡逻兵可以导致巡逻兵销毁。但在我的地形的基础上，6个巡逻兵其实刚好，少了太简单，多了又难到玩不下去，要说玩家可以攻击巡逻兵以达到控制巡逻兵数量的话，那每个巡逻兵都可以被攻击，玩家就没有逃跑的必要了。所以在用完工厂模式的时候，其实还是有点想删掉工厂模式的，但是想想如果后面需要对这次游戏规则做一些改变的话，工厂模式留着还是挺有用的。</li>
</ul>
<ol start="3">
<li>订阅与发布模式</li>
</ol>
<ul>
<li>为什么需要订阅与发布模式<br>就像我们订阅报刊，有什么时事新闻出现，报社（发布者）可以第一时间印刷数百份乃至数千份报纸（传播媒介），发到各个订阅了该报纸的人（订阅者）手上，这样就完成了信息传播。</li>
<li>订阅与发布模式的定义<br>在计算机编程中，订阅与发布模式与观察者模式比较容易混淆。用几张图来说明，他们之间主要的区别<ul>
<li>观察者模式的结构<br>在观察者模式中，观察者需要直接订阅目标事件；在目标发出内容改变的事件后，直接接收事件并作出响应<br><img src="http://5b0988e595225.cdn.sohucs.com/images/20171128/ad665eccfa2a488b9628f6e36b762c02.jpeg" alt=""></li>
<li>订阅与发布模式的结构<br>在发布订阅模式中，发布者和订阅者之间多了一个发布通道；一方面从发布者接收事件，另一方面向订阅者发布事件；订阅者需要从事件通道订阅事件。以此避免发布者和订阅者之间产生依赖关系。<br><img src="http://5b0988e595225.cdn.sohucs.com/images/20171128/72bb65ed99dd44c48eb6962b9d140ea1.jpeg" alt=""></li>
<li>主要区别，直接和间接<br><img src="http://5b0988e595225.cdn.sohucs.com/images/20171128/7c5a95aa8ee348d9b7dff8417e4edb4e.jpeg" alt=""></li>
</ul>
</li>
<li>本次的项目的应用<br>当玩家得分或游戏结束时，都会GameEventManager的得分/游戏结束方法，但是具体怎么实现不用管。因为有可能后期需求更改，得分/游戏结束后需要实现更多效果。而此时我们只需要让这些效果订阅GameEventManager发布的得分/游戏结束信息，即可产生作用。实现功能的分类，降低代码耦合。</li>
</ul>
<h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><ul>
<li>基本地形<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/scene.jpg" alt=""></li>
<li>英雄模型<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/hero.jpg" alt=""></li>
<li>怪物模型<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/patrol.jpg" alt=""></li>
</ul>
<h2 id="重要类实现，代码请直接在项目中查看"><a href="#重要类实现，代码请直接在项目中查看" class="headerlink" title="重要类实现，代码请直接在项目中查看"></a>重要类实现，代码请直接在项目中查看</h2><ul>
<li>文件框架结构<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/file.jpg" alt=""><ul>
<li>ActionControl.cs，基础的动作管理类的集合，该文件里都是一些和动作管理有关的类。相当于动作的controller。</li>
<li>BaseCode.cs，一些最基本的类和接口的集合，如单实例导演类，控制场景的切换，IUserAction、回调接口等</li>
<li>FirstControl.cs，只包含FirstControl—控制第一个场景的类</li>
<li>GameEventManager.cs，只包含GameEventManager—发布者</li>
<li>UserGUI.cs，只包含UserGUI—订阅者兼用户界面管理器，比如显示分数、游戏状态以及监听键盘事件以控制角色的动画（走跑跳停等）</li>
<li>GameModel.cs，只包含GameModel—游戏模型，包括一些判定规则和运动规则</li>
<li>PatrolControl.cs，只包含PatrolControl—怪物（巡逻兵）的controller</li>
<li>HeroControl.cs，只包含HeroControl—英雄的controller</li>
<li>PatrolFactory.cs，只包含PatrolFactory—巡逻兵的制造工厂</li>
<li>Follow.cs，摄像机跟随人物移动的脚本</li>
</ul>
</li>
<li>脚本挂载与组件添加情况  <ul>
<li>camera<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/camera.jpg" alt=""></li>
<li>空对象<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/empty.jpg" alt=""></li>
<li>英雄<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/hero1.jpg" alt=""></li>
<li>巡逻兵<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/patrol1.jpg" alt=""></li>
<li>地形<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/scene1.jpg" alt=""></li>
</ul>
</li>
<li><p>代码</p>
<ul>
<li>ActionControl，这部分很长，但是基本套用模板，不需要改动太多，因此不放出来。</li>
<li><p>BaseCode.cs</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyGame</span></span><br><span class="line">&#123;</span><br><span class="line">    public class Director : System.Object</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Director _instance;</span><br><span class="line">        <span class="keyword">public</span> ISceneControl sceneCtrl &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> playing &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Director <span class="title">getInstance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (_instance == <span class="literal">null</span>) <span class="keyword">return</span> _instance = <span class="keyword">new</span> Director();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> _instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFPS</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Application.targetFrameRate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFPS</span>(<span class="params"><span class="keyword">int</span> fps</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Application.targetFrameRate = fps;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Singleton&lt;T&gt; : MonoBehaviour where T : MonoBehaviour</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">static</span> T instance;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//instance = new GameObject(typeof(T).Name).AddComponent&lt;T&gt;();</span></span><br><span class="line">                    instance = (T)FindObjectOfType(<span class="keyword">typeof</span>(T));</span><br><span class="line">                    <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Debug.LogError(<span class="string">"no scene instance"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISSActionCallback</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">ActionDone</span>(<span class="params">SSAction source, <span class="keyword">bool</span> catchState = <span class="literal">false</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISceneControl</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">LoadPrefabs</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUserAction</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">heroMove</span>(<span class="params"><span class="keyword">int</span> dir</span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Diretion</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> UP = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> DOWN = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> LEFT = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> RIGHT = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IAddAction</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">addRandomMovement</span>(<span class="params">GameObject sourceObj, <span class="keyword">bool</span> isActive</span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">addDirectMovement</span>(<span class="params">GameObject sourceObj</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IGameStatusOp</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Transform <span class="title">getHeroPosition</span>(<span class="params"></span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">heroEscapeAndScore</span>(<span class="params"></span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">patrolHitHeroAndGameover</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FirstControl</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line">public class FirstControl : MonoBehaviour, ISceneControl, IGameStatusOp, IUserAction, IAddAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//public ActionManager MyActionManager &#123; get; set; &#125;</span></span><br><span class="line">    <span class="keyword">public</span> GameEventManager gameEventManager;</span><br><span class="line">    <span class="keyword">public</span> GameModel gameModel;</span><br><span class="line">    <span class="keyword">public</span> PatrolFactory factory &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> UserGUI user;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Director diretor = Director.getInstance();</span><br><span class="line">        diretor.sceneCtrl = <span class="keyword">this</span>;                              </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Begin();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadPrefabs</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Begin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        LoadPrefabs();</span><br><span class="line">        <span class="comment">//MyActionManager = gameObject.AddComponent&lt;ActionManager&gt;() as ActionManager;        </span></span><br><span class="line">        gameEventManager = gameObject.AddComponent&lt;GameEventManager&gt;() <span class="keyword">as</span> GameEventManager;</span><br><span class="line">        <span class="comment">//gameModel = gameObject.AddComponent&lt;GameModel&gt;() as GameModel;</span></span><br><span class="line">        Debug.Log(<span class="string">"game model init"</span>);</span><br><span class="line">        user = gameObject.AddComponent&lt;UserGUI&gt;();</span><br><span class="line">        user.Begin();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SceneManager.LoadScene(<span class="string">"scene"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heroMove</span>(<span class="params"><span class="keyword">int</span> dir</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameModel.heroMove(dir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRandomMovement</span>(<span class="params">GameObject sourceObj, <span class="keyword">bool</span> isActive</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameModel.addRandomMovement(sourceObj, isActive);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDirectMovement</span>(<span class="params">GameObject sourceObj</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameModel.addDirectMovement(sourceObj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Transform <span class="title">getHeroPosition</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gameModel.getHeroPosition();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heroEscapeAndScore</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameEventManager.heroEscapeAndScore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patrolHitHeroAndGameover</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameEventManager.patrolHitHeroAndGameover();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>GameEventManager</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameEventManager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">GameScoreAction</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> GameScoreAction myGameScoreAction;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">GameOverAction</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> GameOverAction myGameOverAction;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FirstControl scene;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        scene = (FirstControl)Director.getInstance().sceneCtrl;</span><br><span class="line">        scene.gameEventManager = <span class="keyword">this</span>;</span><br><span class="line">    &#125;        </span><br><span class="line"></span><br><span class="line">    <span class="comment">//hero escape, get score</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heroEscapeAndScore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (myGameScoreAction != <span class="literal">null</span>)</span><br><span class="line">            myGameScoreAction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//hero gets caught, game over</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patrolHitHeroAndGameover</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (myGameOverAction != <span class="literal">null</span>)</span><br><span class="line">            myGameOverAction();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserGUI</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserGUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IUserAction action;</span><br><span class="line">    GUIStyle LabelStyle1;</span><br><span class="line">    GUIStyle LabelStyle2;</span><br><span class="line">    GUIStyle ButtonStyle;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> score = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> round = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> CoolTimes = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> game = <span class="number">0</span>; <span class="comment">// status</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        action = (IUserAction)Director.getInstance().sceneCtrl;</span><br><span class="line"></span><br><span class="line">        LabelStyle1 = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        LabelStyle1.fontSize = <span class="number">20</span>;</span><br><span class="line">        LabelStyle1.alignment = TextAnchor.MiddleCenter;</span><br><span class="line"></span><br><span class="line">        LabelStyle2 = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        LabelStyle2.fontSize = <span class="number">30</span>;</span><br><span class="line">        LabelStyle2.alignment = TextAnchor.MiddleCenter;</span><br><span class="line"></span><br><span class="line">        ButtonStyle = <span class="keyword">new</span> GUIStyle(<span class="string">"Button"</span>);</span><br><span class="line">        ButtonStyle.fontSize = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//check key input and decide whether the hero should play animation</span></span><br><span class="line">        GameObject hero = ((FirstControl)Director.getInstance().sceneCtrl).gameModel.getHero();        </span><br><span class="line">        <span class="keyword">bool</span> keyPressed = <span class="literal">false</span>;        </span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.UpArrow) || Input.GetKey(KeyCode.W))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.UP);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.DownArrow) || Input.GetKey(KeyCode.S))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.DOWN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.LeftArrow) || Input.GetKey(KeyCode.A))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.LEFT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.RightArrow) || Input.GetKey(KeyCode.D))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.RIGHT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.J))</span><br><span class="line">        &#123;</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Attack"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.Space))</span><br><span class="line">        &#123;</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Jump"</span>, PlayMode.StopAll);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (keyPressed == <span class="literal">false</span>)</span><br><span class="line">        &#123;                    </span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"idle"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//cool time system</span></span><br><span class="line">        time += Time.deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (time &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (game == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (CoolTimes &gt; <span class="number">1</span>) CoolTimes--;</span><br><span class="line">            <span class="keyword">else</span> game = <span class="number">0</span>;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CoolTimes = <span class="number">3</span>;</span><br><span class="line">        game = <span class="number">3</span>;</span><br><span class="line">        score = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Begin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Restart();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (game == <span class="number">0</span>) <span class="comment">// playing</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span>, Screen.height / <span class="number">2</span> - <span class="number">160</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Score: "</span> + score, LabelStyle1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (game == <span class="number">1</span>) <span class="comment">// game over</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">85</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Gameover!"</span>, LabelStyle2);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">70</span>, Screen.height / <span class="number">2</span>, <span class="number">140</span>, <span class="number">70</span>), <span class="string">"Restart"</span>, ButtonStyle))</span><br><span class="line">            &#123;</span><br><span class="line">                game = <span class="number">0</span>;</span><br><span class="line">                action.Restart();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (game == <span class="number">2</span>) <span class="comment">// win</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">85</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"You win!"</span>, LabelStyle2);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">70</span>, Screen.height / <span class="number">2</span>, <span class="number">140</span>, <span class="number">70</span>), <span class="string">"Restart"</span>, ButtonStyle))</span><br><span class="line">            &#123;</span><br><span class="line">                game = <span class="number">0</span>;</span><br><span class="line">                action.Restart();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (game == <span class="number">3</span>) <span class="comment">// ready</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">30</span>, Screen.height / <span class="number">2</span>, <span class="number">100</span>, <span class="number">50</span>), CoolTimes.ToString(), LabelStyle2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GameEventManager.myGameScoreAction += getScore;</span><br><span class="line">        GameEventManager.myGameOverAction += gameOver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GameEventManager.myGameScoreAction -= getScore;</span><br><span class="line">        GameEventManager.myGameOverAction -= gameOver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getScore</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        score++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">gameOver</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        game = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PatrolControl</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PatrolControl</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IAddAction addAction;</span><br><span class="line">    <span class="keyword">private</span> IGameStatusOp gameStatusOp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> whichPatrol;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> isCatching; <span class="comment">//whether found hero</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> CATCH_RADIUS = <span class="number">3.0</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        addAction = (FirstControl)Director.getInstance().sceneCtrl <span class="keyword">as</span> IAddAction;</span><br><span class="line">        gameStatusOp = (FirstControl)Director.getInstance().sceneCtrl <span class="keyword">as</span> IGameStatusOp;</span><br><span class="line"></span><br><span class="line">        whichPatrol = getIndex();</span><br><span class="line">        isCatching = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//check</span></span><br><span class="line">        <span class="keyword">if</span> (Vector3.Distance(gameStatusOp.getHeroPosition().position, gameObject.transform.position) &lt;= <span class="number">20</span>f)</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="comment">//hero go in the area</span></span><br><span class="line">            <span class="comment">//start catching</span></span><br><span class="line">            <span class="keyword">if</span> (!isCatching)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.Log(<span class="keyword">this</span>.gameObject + <span class="string">" is catching"</span>);</span><br><span class="line">                isCatching = <span class="literal">true</span>;                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//moves direct to the hero</span></span><br><span class="line">            addAction.addDirectMovement(<span class="keyword">this</span>.gameObject);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (isCatching)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.Log(<span class="keyword">this</span>.gameObject + <span class="string">" stops catching"</span>);</span><br><span class="line">                <span class="comment">//hero has moved out of the area</span></span><br><span class="line">                <span class="comment">//stop catching </span></span><br><span class="line">                gameStatusOp.heroEscapeAndScore();</span><br><span class="line">                isCatching = <span class="literal">false</span>;                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//then moves randomly</span></span><br><span class="line">            addAction.addRandomMovement(<span class="keyword">this</span>.gameObject, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//get the index of patrol</span></span><br><span class="line">        <span class="keyword">string</span> name = <span class="keyword">this</span>.gameObject.name;</span><br><span class="line">        <span class="keyword">return</span> name[name.Length - <span class="number">1</span>] - <span class="string">'0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnCollisionStay</span>(<span class="params">Collision e</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//hit other patrol, move to other direction</span></span><br><span class="line">        <span class="keyword">if</span> (e.gameObject.name.Contains(<span class="string">"Patrol"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            isCatching = <span class="literal">false</span>;</span><br><span class="line">            addAction.addRandomMovement(<span class="keyword">this</span>.gameObject, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//hit hero, game over</span></span><br><span class="line">        <span class="keyword">if</span> (e.gameObject.name.Contains(<span class="string">"hero"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            gameStatusOp.patrolHitHeroAndGameover();</span><br><span class="line">            Debug.Log(<span class="string">"Game Over!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Follow</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Follow</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Vector3 offset;</span><br><span class="line">    <span class="keyword">private</span> Transform playerBip;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> smoothing = <span class="number">0.5</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        playerBip = GameObject.Find(<span class="string">"hero"</span>).transform;</span><br><span class="line">        offset = transform.position - playerBip.position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//transform.position = playerBip.position + offset;</span></span><br><span class="line">        Vector3 targetPos = playerBip.position + offset;</span><br><span class="line">        transform.position = Vector3.Lerp(transform.position, targetPos, smoothing * Time.deltaTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>以上多数为个人理解，可能有误，仅供参考。</li>
<li>本次项目觉得做得最好的模式是MVC，在之前几次的基础上渐渐改进，本次项目分离得比较彻底，耦合度低了许多。</li>
<li>如感兴趣，可访问笔者Gayhub项目地址—<a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework6" target="_blank" rel="noopener">传送门</a></li>
<li>视频演示地址—<a href="https://www.bilibili.com/video/av23309694/" target="_blank" rel="noopener">传送门</a></li>
<li>csdn博客地址—<a href="https://mp.csdn.net/mdeditor/80288017" target="_blank" rel="noopener">传送门</a></li>
</ul>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/" data-id="cjmdefsxq00095sq2plczzldi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw5-打飞碟-混合版" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/24/Unity3d-hw5-打飞碟-混合版/" class="article-date">
  <time datetime="2018-04-24T11:10:44.000Z" itemprop="datePublished">2018-04-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/24/Unity3d-hw5-打飞碟-混合版/">Unity3d-hw5-打飞碟(混合版)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="打飞碟——基础版和物理版结合"><a href="#打飞碟——基础版和物理版结合" class="headerlink" title="打飞碟——基础版和物理版结合"></a>打飞碟——基础版和物理版结合</h1><h2 id="游戏简介"><a href="#游戏简介" class="headerlink" title="游戏简介"></a>游戏简介</h2><p>打飞碟游戏是一款敏捷类游戏（也可能是我手残），我将游戏规则制定如下：</p>
<ul>
<li>游戏总共3回合，以飞碟颜色区分</li>
<li>每个回合难度会增加，主要体现在飞碟速度和大小</li>
<li>每关分数独立计算，第一关1个飞碟1分，第2关2分，第三关3分</li>
<li>一个飞碟都不能掉才能进入下个回合（手动滑稽）<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2></li>
</ul>
<ol>
<li>MVC模式<br>MVC模式在之前的有关牧师与魔鬼的博客中有详细解释过，这里沿用的是牧师与魔鬼的MVC框架，在此基础上做了一些改动，如果有兴趣可以到我的相关博客查看，这次主要解释下面两个模式。</li>
<li>工厂模式</li>
</ol>
<ul>
<li>为什么需要工厂模式<br>游戏对象的创建与销毁成本较高，所以当游戏涉及大量游戏对象的创建与销毁时，必须考虑减少销毁次数，比如这次的打飞碟游戏，或者像其他类型的射击游戏，其中子弹或者中弹对象的创建与销毁是很频繁的。</li>
<li>工厂模式的定义<br>工厂模式是我们最常用的实例化对象模式了，是用工厂方法代替new操作的一种模式。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</li>
<li>工厂模式的结构<br>游戏对象的创建与销毁，分别对应工厂里面的两个List，这两个List分别存放正在使用的游戏对象，已失效的游戏对象。同时保存两个List的目的是，减少游戏对象的创建与销毁的性能开销。如果已失效的List里面还有item，而这时工厂又需要完成一个新的“订单”，便可以从这些回收的item中拿出来再加工（一些逻辑处理），再返回给用户（调用方）。  </li>
<li>工厂模式的优缺点<ul>
<li>优点 <ul>
<li>一个调用者想创建一个对象，只要知道其名称就可以了。 - 扩展性高，如果想增加一个产品，只要扩展一个工厂类就可以。 </li>
<li>屏蔽产品的具体实现，调用者只关心产品的接口。</li>
<li>例子，如果一个客户需要一辆汽车，可以直接从工厂里面提货，而不用去管这辆汽车是怎么做出来的，以及这个汽车里面的具体实现。</li>
</ul>
</li>
<li>缺点<ul>
<li>一开始实现会比较复杂，需要用心设计一下工厂的结构</li>
<li>每增加一个产品，可能都需要对工厂进行一次较大的“整改”</li>
<li>如果工厂太大，实时保存的所有游戏对象的开销可能要大于游戏对象直接创建与销毁</li>
</ul>
</li>
</ul>
</li>
<li>工厂模式的意义（以本次代码为例）<br>体现了面向对象设计的核心——抽象、包装、隐藏。道具工厂通过场景单实例，构建了可以被方便获取的disk类。包装了复杂的disk生产和回收逻辑，易于使用。包装了disk的产生规则，有利于应对未来游戏规则的变化，易于维护。</li>
</ul>
<ol start="3">
<li>适配器模式</li>
</ol>
<ul>
<li>为什么需要适配器模式<br>就像只有一个usb接口的电脑上想要插多个usb外设，就需要通过一个usb适配器来对这些接口进行扩展。在本游戏实例中，由于我们想要继续沿用上次的基础版ActionManager，并且新增一个管理物理运动的PhysicsActionManager，这时在FirstControl里就需要同时有两个变量分别指向这两个动作管理器了。而这样会造成FirstControl需要管理多个功能相同或类似的组件，如果未来还想加多几个动作管理器，就会显得越来越臃肿，可扩展性很差。所以我们希望FirstControl里只保留一个可扩展的变量，那就是适配器！</li>
<li>适配器模式的定义<br>在计算机编程中，适配器模式（有时候也称包装样式或者包装）将一个类的接口适配成用户所期待的。一个适配允许通常因为接口不兼容而不能在一起工作的类工作在一起，做法是将类自己的接口包裹在一个已存在的类中。</li>
<li>适配器模式的结构<ul>
<li>Target：目标抽象类（USB接口）</li>
<li>Adapter：适配器类（USB扩展器）</li>
<li>Adaptee：适配者类（鼠标、键盘、U盘）</li>
<li>Client：客户类（平板电脑）</li>
</ul>
</li>
<li>适配器模式的优缺点<ul>
<li>优点<ul>
<li>可以让任何两个没有关联的类一起运行。 </li>
<li>提高了类的复用。 </li>
<li>增加了类的透明度。 </li>
<li>灵活性好。</li>
</ul>
</li>
<li>缺点  <ul>
<li>过多地使用适配器，会让系统非常零乱，不易整体进行把握。</li>
<li>容易误导程序员或用户，比如，明明看到调用的是 A 接口，其实内部被适配成了 B 接口的实现。 </li>
</ul>
</li>
</ul>
</li>
<li>适配器模式的意义<br>适配器的主要作用，就是将多个类接入同一个接口，或者转接“不兼容”接口。有动机地修改一个正常运行的系统的接口，将一个类的接口转换成客户希望的另外一个接口。适配器模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</li>
</ul>
<h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><ul>
<li>Round1<br><img src="/2018/04/24/Unity3d-hw5-打飞碟-混合版/round1.jpg" alt=""></li>
<li>Round2<br><img src="/2018/04/24/Unity3d-hw5-打飞碟-混合版/round2.jpg" alt=""></li>
<li>Round3<br><img src="/2018/04/24/Unity3d-hw5-打飞碟-混合版/round3.jpg" alt=""></li>
</ul>
<h2 id="重要代码实现"><a href="#重要代码实现" class="headerlink" title="重要代码实现"></a>重要代码实现</h2><ul>
<li>文件框架结构<br><img src="/2018/04/24/Unity3d-hw5-打飞碟-混合版/file.jpg" alt=""></li>
<li>脚本挂载情况<br><img src="/2018/04/24/Unity3d-hw5-打飞碟-混合版/script.jpg" alt=""></li>
<li><p>ActionManager，基础动作管理器</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ActionManager</span> : <span class="title">SSActionManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> FirstControl sceneController;</span><br><span class="line">    <span class="keyword">public</span> DiskFactory diskFactory;</span><br><span class="line">    <span class="keyword">public</span> RecordControl scoreRecorder;</span><br><span class="line">    <span class="keyword">public</span> Emit EmitDisk;</span><br><span class="line">    <span class="keyword">public</span> GameObject Disk;</span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sceneController = (FirstControl)Director.getInstance().sceneCtrl;</span><br><span class="line">        diskFactory = sceneController.factory;</span><br><span class="line">        scoreRecorder = sceneController.scoreRecorder;</span><br><span class="line">        <span class="comment">//sceneController.MyActionManager = this;</span></span><br><span class="line">        sceneController.myAdapter.SetNormalAM(<span class="keyword">this</span>); <span class="comment">//修改的地方</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> new <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">base</span>.Update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playDisk</span>(<span class="params"><span class="keyword">int</span> round</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//Debug.Log(diskFactory);</span></span><br><span class="line">        EmitDisk = Emit.GetSSAction();</span><br><span class="line">        Disk = diskFactory.getDisk(round);</span><br><span class="line">        <span class="keyword">this</span>.AddAction(Disk, EmitDisk, <span class="keyword">this</span>);</span><br><span class="line">        Disk.GetComponent&lt;DiskControl&gt;().action = EmitDisk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SSActionEvent</span>(<span class="params">SSAction source</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!source.GameObject.GetComponent&lt;DiskControl&gt;().hit)</span><br><span class="line">            scoreRecorder.miss();</span><br><span class="line">        diskFactory.freeDisk(source.GameObject);</span><br><span class="line">        source.GameObject.GetComponent&lt;DiskControl&gt;().hit = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PhysicsManager，物理动作管理器</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PhysicsActionManager</span> : <span class="title">SSActionManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> FirstControl sceneController;</span><br><span class="line">    <span class="keyword">public</span> DiskFactory diskFactory;</span><br><span class="line">    <span class="keyword">public</span> RecordControl scoreRecorder;</span><br><span class="line">    <span class="keyword">public</span> PhysicsEmit EmitDisk;</span><br><span class="line">    <span class="keyword">public</span> GameObject Disk;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sceneController = (FirstControl)Director.getInstance().sceneCtrl;</span><br><span class="line">        diskFactory = sceneController.factory;</span><br><span class="line">        scoreRecorder = sceneController.scoreRecorder;</span><br><span class="line">        <span class="comment">//sceneController.MyActionManager = this;</span></span><br><span class="line">        sceneController.myAdapter.SetPhysicsAM(<span class="keyword">this</span>); <span class="comment">//修改的地方</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> new <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">base</span>.Update();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playDisk</span>(<span class="params"><span class="keyword">int</span> round</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        EmitDisk = PhysicsEmit.GetSSAction();</span><br><span class="line">        Disk = diskFactory.getDisk(round);</span><br><span class="line">        <span class="keyword">this</span>.AddAction(Disk, EmitDisk, <span class="keyword">this</span>);</span><br><span class="line">        Disk.GetComponent&lt;DiskControl&gt;().action = EmitDisk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SSActionEvent</span>(<span class="params">SSAction source</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!source.GameObject.GetComponent&lt;DiskControl&gt;().hit)</span><br><span class="line">            scoreRecorder.miss();</span><br><span class="line">        diskFactory.freeDisk(source.GameObject);</span><br><span class="line">        source.GameObject.GetComponent&lt;DiskControl&gt;().hit = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ActionManagerAdapter，适配器类，封装多个动作管理器</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ActionManagerAdapter</span></span><br><span class="line">&#123;</span><br><span class="line">    ActionManager normalAM;</span><br><span class="line">    PhysicsActionManager PhysicsAM;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> mode = <span class="number">0</span>; <span class="comment">// 0-&gt;normal, 1-&gt;physics</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ActionManagerAdapter</span>(<span class="params">GameObject main</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        normalAM = main.AddComponent&lt;ActionManager&gt;();</span><br><span class="line">        PhysicsAM = main.AddComponent&lt;PhysicsActionManager&gt;();</span><br><span class="line">        mode = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchActionMode</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        mode = <span class="number">1</span> - mode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayDisk</span>(<span class="params"><span class="keyword">int</span> round</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mode == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"normalAM"</span>);</span><br><span class="line">            normalAM.playDisk(round);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">"physicsAM"</span>);</span><br><span class="line">            PhysicsAM.playDisk(round);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetNormalAM</span>(<span class="params">ActionManager am</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        normalAM = am;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPhysicsAM</span>(<span class="params">PhysicsActionManager pam</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        PhysicsAM = pam;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionManager <span class="title">GetNormalAM</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> normalAM;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PhysicsActionManager <span class="title">GetPhysicsAM</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PhysicsAM;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FirstControl，控制第一个场景的类</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">public class FirstControl : MonoBehaviour, ISceneControl, IUserAction &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//public ActionManager MyActionManager &#123; get; set; &#125;</span></span><br><span class="line">    <span class="keyword">public</span> ActionManagerAdapter myAdapter; <span class="comment">// 修改的地方</span></span><br><span class="line">    <span class="keyword">public</span> DiskFactory factory &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> RecordControl scoreRecorder;</span><br><span class="line">    <span class="keyword">public</span> UserGUI user;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> time = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Director diretor = Director.getInstance();</span><br><span class="line">        diretor.sceneCtrl = <span class="keyword">this</span>;                    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Begin();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        time += Time.deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (time &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if round &lt;= 3 and is playing, </span></span><br><span class="line">        <span class="keyword">if</span> (user.round &lt;= <span class="number">3</span> &amp;&amp; user.game == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            PlayDisk();</span><br><span class="line">            user.num++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Begin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        LoadPrefabs();</span><br><span class="line">        <span class="comment">//MyActionManager = gameObject.AddComponent&lt;ActionManager&gt;() as ActionManager;</span></span><br><span class="line">        myAdapter = <span class="keyword">new</span> ActionManagerAdapter(gameObject); <span class="comment">// 修改的地方</span></span><br><span class="line">        scoreRecorder = gameObject.AddComponent&lt;RecordControl&gt;();</span><br><span class="line">        user = gameObject.AddComponent&lt;UserGUI&gt;();</span><br><span class="line">        user.Begin();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hit</span>(<span class="params">DiskControl diskCtrl</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;        </span><br><span class="line">        <span class="keyword">if</span> (user.game == <span class="number">0</span>)</span><br><span class="line">        &#123;            </span><br><span class="line">            Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);</span><br><span class="line">            RaycastHit hit;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (Physics.Raycast(ray, <span class="keyword">out</span> hit))</span><br><span class="line">            &#123;</span><br><span class="line">                hit.collider.gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">                Debug.Log(<span class="string">"Hit"</span>);</span><br><span class="line">                hit.collider.gameObject.GetComponent&lt;DiskControl&gt;().hit = <span class="literal">true</span>;</span><br><span class="line">                scoreRecorder.<span class="keyword">add</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Debug.Log(<span class="string">"Miss"</span>);</span><br><span class="line">                scoreRecorder.miss();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayDisk</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//MyActionManager.playDisk(user.round); </span></span><br><span class="line">        myAdapter.PlayDisk(user.round); <span class="comment">// 修改的地方</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SceneManager.LoadScene(<span class="string">"scene"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 切换模式</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchMode</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Debug.Log(<span class="string">"Switch Mode"</span>);</span><br><span class="line">        myAdapter.SwitchActionMode();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Check</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DiskFactory，飞碟工厂，管理飞碟的创建和回收</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DiskFactory</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DiskFactory _instance;</span><br><span class="line">    <span class="keyword">public</span> FirstControl sceneControler &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    GameObject diskPrefab;</span><br><span class="line">    <span class="keyword">public</span> DiskControl diskData;</span><br><span class="line">    <span class="keyword">public</span> List&lt;GameObject&gt; used;</span><br><span class="line">    <span class="keyword">public</span> List&lt;GameObject&gt; free;</span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DiskFactory <span class="title">getInstance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (_instance == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            _instance = Singleton&lt;DiskFactory&gt;.Instance;</span><br><span class="line">            _instance.used = <span class="keyword">new</span> List&lt;GameObject&gt;();</span><br><span class="line">            _instance.free = <span class="keyword">new</span> List&lt;GameObject&gt;();</span><br><span class="line">            diskPrefab = Instantiate(Resources.Load&lt;GameObject&gt;(<span class="string">"Prefabs/disk"</span>), <span class="keyword">new</span> Vector3(<span class="number">40</span>, <span class="number">0</span>, <span class="number">0</span>), Quaternion.identity);</span><br><span class="line">        &#125;</span><br><span class="line">        Debug.Log(<span class="string">"instance: "</span> + _instance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        sceneControler = (FirstControl)Director.getInstance().sceneCtrl;</span><br><span class="line">        sceneControler.factory = _instance;       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">getDisk</span>(<span class="params"><span class="keyword">int</span> round</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sceneControler.scoreRecorder.Score &gt;= round * <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (sceneControler.user.round &lt; <span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sceneControler.user.round++;</span><br><span class="line">                sceneControler.user.num = <span class="number">0</span>;</span><br><span class="line">                sceneControler.scoreRecorder.Score = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                sceneControler.user.game = <span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (sceneControler.user.num &gt;= <span class="number">10</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sceneControler.user.game = <span class="number">1</span>;</span><br><span class="line">            &#125;            </span><br><span class="line">        &#125;</span><br><span class="line">        GameObject newDisk;</span><br><span class="line">        RoundControl diskOfCurrentRound = <span class="keyword">new</span> RoundControl(round);        </span><br><span class="line">        <span class="keyword">if</span> (free.Count == <span class="number">0</span>) <span class="comment">// if no free disk, then create a new disk</span></span><br><span class="line">        &#123;</span><br><span class="line">            newDisk = GameObject.Instantiate(diskPrefab) <span class="keyword">as</span> GameObject;</span><br><span class="line">            newDisk.AddComponent&lt;ClickGUI&gt;();</span><br><span class="line">            diskData = newDisk.AddComponent&lt;DiskControl&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">// else let the first free disk be the newDisk</span></span><br><span class="line">        &#123;</span><br><span class="line">            newDisk = free[<span class="number">0</span>];</span><br><span class="line">            free.Remove(free[<span class="number">0</span>]);</span><br><span class="line">            newDisk.SetActive(<span class="literal">true</span>);</span><br><span class="line">            Debug.Log(<span class="string">"get from free"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        diskData = newDisk.GetComponent&lt;DiskControl&gt;();</span><br><span class="line">        diskData.color = diskOfCurrentRound.color;</span><br><span class="line"></span><br><span class="line">        newDisk.transform.localScale = diskOfCurrentRound.scale * diskPrefab.transform.localScale;</span><br><span class="line">        newDisk.GetComponent&lt;Renderer&gt;().material.color = diskData.color;</span><br><span class="line">        </span><br><span class="line">        used.Add(newDisk);</span><br><span class="line">        <span class="keyword">return</span> newDisk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">freeDisk</span>(<span class="params">GameObject disk1</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        used.Remove(disk1);</span><br><span class="line">        disk1.SetActive(<span class="literal">false</span>);</span><br><span class="line">        free.Add(disk1);</span><br><span class="line">        Debug.Log(<span class="string">"free: "</span> + free.Count);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        used.Clear();</span><br><span class="line">        free.Clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>以上多数为个人理解，可能有误，仅供参考。</li>
<li>如感兴趣，可访问笔者Gayhub项目地址—<a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework5" target="_blank" rel="noopener">传送门</a></li>
<li>视频演示地址—<a href="https://www.bilibili.com/video/av22528884/" target="_blank" rel="noopener">传送门</a></li>
<li>csdn博客地址—<a href="https://blog.csdn.net/wonderful_sky/article/details/80072194" target="_blank" rel="noopener">传送门</a></li>
</ul>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/24/Unity3d-hw5-打飞碟-混合版/" data-id="cjmdefsxe00045sq2exhw0pn1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SYSU-SE-2018-Part1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/15/SYSU-SE-2018-Part1/" class="article-date">
  <time datetime="2018-04-15T13:16:34.000Z" itemprop="datePublished">2018-04-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/15/SYSU-SE-2018-Part1/">SYSU-SE-2018-Part1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SYSU-SE-2018-中级实训"><a href="#SYSU-SE-2018-中级实训" class="headerlink" title="SYSU SE-2018 中级实训"></a>SYSU SE-2018 中级实训</h1><hr>
<ul>
<li>学号：16340255 姓名：谢涛</li>
</ul>
<hr>
<ul>
<li><strong>本篇自学报告说明</strong>：<em>出于想记录学习历程和记录一些关键的Linux命令，除了回答要求的Vi,Java,Ant,Junit的自学部分，我会将本次阶段一所遇到的较有价值的问题和对应解决方案记录下来，以及其他题目的完成过程。ta可直接只查看标有检查部分的内容</em>  </li>
</ul>
<hr>
<ul>
<li>如果markdown渲染效果不佳，欢迎访问本人github博客—<a href="https://gitgiter.github.io/2018/04/15/SYSU-SE-2018-Part1/" target="_blank" rel="noopener">传送门</a></li>
</ul>
<hr>
<h2 id="学习Vi-Vim编辑器的使用（检查部分）"><a href="#学习Vi-Vim编辑器的使用（检查部分）" class="headerlink" title="学习Vi/Vim编辑器的使用（检查部分）"></a>学习Vi/Vim编辑器的使用（检查部分）</h2><p>Vim是Vi的升级版，Vim基本上兼容所有的Vi指令，然后也扩展了一些新特性。所以这里就主要讲一下自己对Vi的一些尝试。Vi有3个模式：命令模式（command mode）、插入模式（Insert mode）和底行模式（last line mode）。用vi打开文件后，是处于命令行模式，命令行模式一般是用于控制屏幕光标的移动，字符、字或行的删除，复制和切换模式；在命令行模式下按一下字母[i]就可以进入插入模式，切换到插入模式才能够输入文字，插入模式中按[Esc]可以回到命令模式；在命令模式下按一下[:]可以进入底行模式。说一下第一次使用这种”强大的文本编辑器“的感受吧，就是到处碰壁，然后查命令，一不小心就在插入模式下使用了方向键和退格键。<br>记录一下我在编写Java的helloworld程序时尝试过的几个基本命令（均在虚拟机上测试过）。 </p>
<ul>
<li>vi helloworld.java 在本目录下创建或打开该文件</li>
<li>插入模式，输入文本，方向键不能使用，退格只有\b的作用没有删除作用</li>
<li>命令模式<ul>
<li>i进入插入模式，从光标当前位置开始输入文件</li>
<li>a进入插入模式，从光标下个位置开始输入文件</li>
<li>o进入插入模式，插入新的一行，从行首开始输入文字</li>
<li>删除、复制、更改等结合数字#可以指定操作多少个行或字或字符</li>
<li>移动光标<ul>
<li>方向键或hjkl可以上下左右移动</li>
<li>数字0可以移到行开头（Wiki的教程上写的是文章开头，我觉得写错了）</li>
<li>gg可以移到文章开头</li>
<li>G可以移到文章结尾</li>
<li>$、^可以分别移到行尾和行首</li>
<li>w移到下个字头</li>
<li>e移到下个字尾</li>
<li>b移到上个字头</li>
</ul>
</li>
<li>删除<ul>
<li>x、delete都可以删光标后的一个字符(如果在插入模式下，delete可以返回命令模式并删除后一个字符，x不可以)</li>
<li>X可以删前一个字符</li>
<li>dd删一行</li>
</ul>
</li>
<li>复制粘贴<ul>
<li>yw，复制光标到字尾</li>
<li>yy，复制光标行</li>
<li>p，粘贴到光标处</li>
</ul>
</li>
<li>cw，更改光标到字尾，相当于windows里的鼠标刷一段字之后修改</li>
<li>u，撤销一次操作，只有一次！！</li>
<li>r，R可以替换字符</li>
</ul>
</li>
<li>底行模式<ul>
<li>w，保存</li>
<li>q!，退出</li>
<li>wq!，保存并退出(Wiki上的教程写成qw)</li>
<li>set nu，显示行号</li>
<li>set nonu，取消行号显示</li>
</ul>
</li>
</ul>
<h2 id="熟悉JDK的环境并学习JAVA语言，完成HelloWorld的编译运行"><a href="#熟悉JDK的环境并学习JAVA语言，完成HelloWorld的编译运行" class="headerlink" title="熟悉JDK的环境并学习JAVA语言，完成HelloWorld的编译运行"></a>熟悉JDK的环境并学习JAVA语言，完成HelloWorld的编译运行</h2><ul>
<li><p>环境配置<br>首先是在Linux上配置jdk环境，根据实训Wiki上的指示，可以在官网上下载SunJDK，然后解压，手动逐条命令进行安装，最主要的是讲一下环境变量的配置，跟Windows一样，下了JDK都需要配置PATH，JAVA_HOME，CLASSPATH，这三个变量分别指定Java命令的搜索路径，Java的安装目录，Java的执行环境所需要的类或包所在的路径。明确了这三者的意义之后，我们大概就可以明白进行环境变量配置的意义了，结合Wiki上的教程，可以这么理解，配置完Java环境后，是更方便Java的运行，最直观的作用就是可以在任意目录下输入Java或Javac命令，系统都可以识别得到，在没有配置Java环境之前系统是识别不到的。Linux可以通过一下几个变量进行手动的环境变量配置配置完Java环境变量后，在终端输入Java或Javac就能看到系统对该指令的识别了。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/jdk1.6.0_16</span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class="line">export CLASSPATH=.$JAVA_HOME/lib/dt.jar: $JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure>
<p>  这里要提一下的是，个人认为建议学习这些手动安装的命令是为了理解这些操作的意义和更加了解环境变量配置的意义。在对这个意义有大概地一个了解的情况下，还是建议使用Linux提供的包管理器实现环境的配置为好，可以避免或减少一些错误的出现，比如路径不小心配置错误等。所以我选用了sudo apt-get openjdk-9-jdk的方式。但是出乎意料地还是出现了错误，先是报了不能下载其中某些包的错误，然后系统建议使用sudo apt-get update解决这个问题，然后尝试了一下，但是update失败了，报错是“E: Problem executing scripts APT::Update::Post-Invoke-Success ‘if /usr/bin/test -w /var/cache/app-info -a -e /usr/bin/appstreamcli; then appstreamcli refresh &gt; /dev/null; fi’”，后来在网上查到解决方案是依次输入这三条命令（不是很理解为什么，但是确实可以）</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pkill -KILL appstreamcli</span><br><span class="line">wget -P /tmp https://launchpad.net/ubuntu/+archive/primary/+files/appstream_0.9.4-1ubuntu1_amd64.deb https://launchpad.net/ubuntu/+archive/primary/+files/libappstream3_0.9.4-1ubuntu1_amd64.deb</span><br><span class="line">sudo dpkg -i /tmp/appstream_0.9.4-1ubuntu1_amd64.deb /tmp/libappstream3_0.9.4-1ubuntu1_amd64.deb</span><br></pre></td></tr></table></figure>
<p>  接着update成功之后，再次install就没有出现包无法下载的错误了，但是还有一个“正试图覆盖 /usr/lib/jvm/java-9-openjdk-amd64/include/linux/jawt_md.h，它同时被包含于软件包 openjdk-9-jdk-headless:amd64 9~b114-0ubuntu1”的错误，大概可能是之前安装到一半，有一些东西可能需要覆盖一遍，于是使用sudo apt-get -o Dpkg::Options::=”–force-overwrite” install openjdk-9-jdk强制覆盖安装。最后终于在自己的虚拟机上配置Java环境成功。<br>  检查配置成功的方法</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    java -version</span><br><span class="line">    出现以下反馈则配置成功</span><br><span class="line">    openjdk version &quot;9-internal&quot;</span><br><span class="line">    OpenJDK Runtime Environment (build 9-internal+0-2016-04-14-195246.buildd.src)</span><br><span class="line">    OpenJDK 64-Bit Server VM (build 9-internal+0-2016-04-14-195246.buildd.src, mixed mode)</span><br><span class="line"></span><br><span class="line">    javac -version</span><br><span class="line">    出现：javac 9-internal 则配置成功</span><br><span class="line">    ```  </span><br><span class="line">    ps：出于发现手动安装和包管理安装的JDK不一样，查阅资料后，可以简单归纳为：openjdk是jdk的开放原始码版本，基本上只包含最精简的JDK，sun jdk7是在openjdk7的基础上发布的，其大部分原始码都相同，只有少部分原始码被替换掉。</span><br><span class="line">- helloworld的编译运行  </span><br><span class="line">    通过vi/vim编辑器(学习目的)在helloworld.java文件中输入好以下信息并保存后</span><br><span class="line">    ``` java</span><br><span class="line">    public class helloworld</span><br><span class="line">    &#123;</span><br><span class="line">        public static void main(String[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(&quot;Hello World!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>  在对应目录的终端下面，依次输出编译、运行的命令，就可以在终端输出”Hello World!”了</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac helloworld.java</span><br><span class="line">java helloworld</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="熟悉Ant的环境并学习Ant，利用Ant实现HelloWorld的自动编译（检查部分）"><a href="#熟悉Ant的环境并学习Ant，利用Ant实现HelloWorld的自动编译（检查部分）" class="headerlink" title="熟悉Ant的环境并学习Ant，利用Ant实现HelloWorld的自动编译（检查部分）"></a>熟悉Ant的环境并学习Ant，利用Ant实现HelloWorld的自动编译（检查部分）</h2><ul>
<li><p>环境配置<br>  因为配置ant需要先配置好JDK环境，于是前面已经先把Java环境配置好了。接下来ant环境的配置和前面提到的JDK配置的步骤其实差不多。也是可以通过手动安装和包管理器安装两种方式。同样的，手动安装也是需要设置ant的环境变量。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ANT_HOME=/usr/apache-ant-1.9.6</span><br><span class="line">export PATH=$PATH:$ANT_HOME/bin</span><br></pre></td></tr></table></figure>
<p>  包管理器安装</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ant</span><br></pre></td></tr></table></figure>
<p>  检查配置成功的方法</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ant -version</span><br><span class="line">出现：Apache Ant(TM) version 1.9.6 compiled on July 8 2015 则配置成功</span><br></pre></td></tr></table></figure>
<p>  庆幸的是，ant的环境配置没有遇到什么其他问题。</p>
</li>
<li>自学ant<ul>
<li>简单了解ant<br>Ant是一种基于Java的build工具，类似Linux下c/c++的make，但是比make要好。ant虽然不是最好的，一些成熟的IDE也可以做到这些自动化程序，但是由于ant的轻量级，在许多场合下ant具有独特的优势，尤其是服务器上环境的搭建，不可能在每个服务器都搞一个庞大的IDE，这时候就是ant大显身手的时候。从一台服务器上移植到另一台服务器，有可能只是需要简单修改一下build.xml，然后就可以告诉甚至不懂程序的操作员，”你只要输入ant xxx”，就可以完成一系列部署。<br>那什么时候要用到ant？<blockquote>
<p>当一个代码项目大了以后，每次重新编译，打包，测试等都会变得非常复杂而且重复，因此c语言中有make脚本来帮助这些工作的批量完成。在Java 中应用是平台无关性的，当然不会用平台相关的make脚本来完成这些批处理任务了，ANT本身就是这样一个流程脚本引擎，用于自动化调用程序完成项目的编译，打包，测试等。除了基于JAVA是平台无关的外，脚本的格式是基于XML的，比make脚本来说还要好维护一些</p>
</blockquote>
</li>
<li>构建文件<ul>
<li>project元素的属性 </li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">name</td>
<td style="text-align:center">表示project的名称（可选）</td>
</tr>
<tr>
<td style="text-align:center">default</td>
<td style="text-align:center">表示构建脚本默认运行的目标，即制定默认的 target。一个project 可以包含多个target（必须）</td>
</tr>
<tr>
<td style="text-align:center">basedir</td>
<td style="text-align:center">表示当该属性没有指定时，使用 Ant 的构件文件的附目录作为基准目录（可选）</td>
</tr>
</tbody>
</table>
<pre><code>- target元素的属性 
</code></pre><table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">name</td>
<td style="text-align:center">表示target的名称（必须）</td>
</tr>
<tr>
<td style="text-align:center">depends</td>
<td style="text-align:center">用于描述 target 之间的依赖关系，若与多个 target 存在依赖关系时，需要以“,”间隔。Ant 会依照 depends 属性中 target 出现的顺序依次执行每个 target。被依赖的 target 会先执行（可选）</td>
</tr>
<tr>
<td style="text-align:center">decription</td>
<td style="text-align:center">关于 target 功能的简单描述（可选）</td>
</tr>
<tr>
<td style="text-align:center">if</td>
<td style="text-align:center">用于验证指定的属性是否存在，若不存在，所在 target 将不会被执行（可选）</td>
</tr>
<tr>
<td style="text-align:center">unless</td>
<td style="text-align:center">该属性的功能与 if 属性的功能正好相反，它也用于验证指定的属性是否存在，若不存在，所在 target 将会被执行（可选）</td>
</tr>
</tbody>
</table>
<pre><code>- 其他元素
    - fileset，用于定制文件集，可以用通配符过滤或选取某些模式的文件
    - property，属性设置，一般在这声明路径变量(使程序更简洁)
    - mkdir，创建文件夹(如果不存在)
    - javac，编译java源程序
    - java，运行java程序
    - classpath，指定java类文件的路径
</code></pre><ul>
<li>helloworld的编译运行<h2 id="学习Java语言，并编写Java小程序，完成要求请参考Java小程序完成要求（检查部分）"><a href="#学习Java语言，并编写Java小程序，完成要求请参考Java小程序完成要求（检查部分）" class="headerlink" title="学习Java语言，并编写Java小程序，完成要求请参考Java小程序完成要求（检查部分）"></a>学习Java语言，并编写Java小程序，完成要求请参考Java小程序完成要求（检查部分）</h2></li>
<li><p>Java自学</p>
<ul>
<li><p>几个重要特性</p>
<ul>
<li>跨平台(可移植)<br>主要原因是：我们编写的Java源码，编译后会生成一种 .class 文件，称为字节码文件。JVM就是负责将字节码文件翻译成特定平台下的机器码然后运行。但是值得注意的是JVM不是跨平台的，JVM翻译出来的机器码也不是跨平台的。因此，跨平台的是Java程序，不是JVM，在不同的平台需要安装对应的JVM。</li>
<li>面向对象<br>Java面向对象的三大特征：封装，继承，多态。封装可以起到很好的信息隐藏作用，隐藏实现细节。继承则可以使子类具有父类的一些基本成员和方法，也可以在父类的基础上扩展出一些新的功能。多态是<em>允许将父对象设置成为和一个或更多的他的子对象相等的技术</em>，简单来说就是允许父类指针指向子类，实现方法一般可以通过子类重写父类的一些方法。一开始我对继承和多态有些混淆，感觉差不多。虽然的确挺相似，但是还是有许多区别。最主要的应该是两者的侧重不同，继承主要是为了继承父类的方法而实现代码重用，多态则更多是为了重写父类的接口或方法，多态顾名思义就是”多种形态“，”多种实现方法“，”多种表现形式“</li>
<li>安全性<br>Java语言本身有提供很多安全性措施的支持。最主要的一个Java里面没有用指针，而且有内存回收机制，因此可以大大减少内存访问越界以及内存泄露的问题，还有万恶的野指针。另外因为Java支持网络编程，因此网络安全保护机制在Java中也是需要被重视的，Java也有一套独立的网络安全防范机制，尤其是针对有下载任务的时候。</li>
<li><p>多线程<br>Java多线程可以使得同一程序中有多个线程在同时地并行执行，最直观的作用是可以加快程序运行速度。比如我有一个有1000000个数的数组，要对他进行求和，这时多线程的威力就很好地体现出来。我可以一下开10个线程，每个线程负责把相隔10的数加起来，最后统一一下各线程的计算结果(各线程几乎是同时结束)，就能很快地得出最终结果，相比单线程得出结果的时间，可以接近快10倍。<br>线程的生命周期：新建状态，就绪状态，运行状态，阻塞状态，死亡状态。其中，新建状态执行start()后就你进入就绪状态；就绪状态执行run()方法后等到系统调度，获取到CPU资源之后进入到运行状态；运行状态可以通过sleep或yield让出CPU资源进入阻塞状态；阻塞状态会回到就绪状态，再开始一个循环；运行状态也可以一直运行到程序死亡或者通过stop与destroy函数强制终止进程进入死亡状态；  </p>
<blockquote>
<p>在Java语言中，线程是一种特殊的对象，它必须由Thread类或其子（孙）类来创建。通常有两种方法来创建线程：其一，使用型构为Thread(Runnable)的构造子将一个实现了Runnable接口的对象包装成一个线程，其二，从Thread类派生出子类并重写run方法，使用该子类创建的对象即为线程。值得注意的是Thread类已经实现了Runnable接口，因此，任何一个线程均有它的run方法，而run方法中包含了线程所要运行的代码。线程的活动由一组方法来控制。Java语言支持多个线程的同时执行，并提供多线程之间的同步机制（关键字为synchronized）。  </p>
</blockquote>
<p>几个重要方法  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">start(): 使该线程开始执行</span><br><span class="line">sleep(): 在指定的毫秒数内让当前正在执行的线程休眠</span><br><span class="line">yield(): 暂停当前正在执行的线程对象，并执行其他线程</span><br><span class="line">isAlive(): 判断线程是否处于活动状态。 </span><br><span class="line">join(): 等待线程终止。 </span><br><span class="line">activeCount(): 程序中活跃的线程数。 </span><br><span class="line">currentThread(): 返回对当前正在执行的线程对象的引用</span><br><span class="line">wait(): 强迫一个线程等待。 </span><br><span class="line">notify(): 通知一个线程继续运行。 </span><br><span class="line">setPriority(): 设置一个线程的优先级。</span><br></pre></td></tr></table></figure>
</li>
<li><p>分布式(支持网络编程)  </p>
<blockquote>
<p>Java语言支持Internet应用的开发，在基本的Java应用编程接口中有一个网络应用编程接口（java net），它提供了用于网络应用编程的类库，包括URL、URLConnection、Socket、ServerSocket等。Java的RMI（远程方法激活）机制也是开发分布式应用的重要手段。</p>
</blockquote>
</li>
</ul>
</li>
<li>基本的语法<br>对于Java的语法，我是觉得跟c和c++很像，尤其是面向对象的c++。感觉基本数据类型也基本上差不多，只不过是有些换了个名字。然后就是一些逻辑函数的语法，像if，for，where等等，用法可以说和c++就没什么太大区别。再有就是类的实现和定义和c++稍有不同，但也只是定义的句式上的不同，本质上还是一样的。</li>
<li><p>基本的输入输出</p>
<ul>
<li><p>输入<br>一般通过Scanner来输入，需要import java.util.Scanner，然后创建一个Scanner的实例，用这个实例来进行输入，Scanner可以分很多类型来读取。以下是我尝试的一些常见类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">num = in.nextInt(); <span class="comment">// read a integer</span></span><br><span class="line">str = in.nextLine(); <span class="comment">// read a line</span></span><br><span class="line">str = in.next(); <span class="comment">// read a string</span></span><br><span class="line">byt = in.nextByte(); <span class="comment">// read a byte</span></span><br><span class="line">in.close(); <span class="comment">// close Scanner</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>输出<br>一般通过System.out来输出，和输入一样，输出也可也分很多模式输出，以下是我尝试的一些常用的输出模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// print should add a \n to be same as the println</span></span><br><span class="line">System.out.println(<span class="string">"hello world"</span>);</span><br><span class="line">System.out.print(<span class="string">"hello world\n"</span>); </span><br><span class="line"><span class="comment">// printf can specify the output format like in C</span></span><br><span class="line">System.out.printf(<span class="string">"%2s %d"</span>, <span class="string">' '</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>GUI界面  </p>
<ul>
<li>大致结构<br>Java的GUI界面讲究框架、容器跟组件。通常都是先建立一个框架，把在这个框架上再放几个容器，然后往容器里面塞各种组件，这是目前我对Java GUI的理解。也就是说我要创建一个图形界面类，首先这个类就得继承一个最基本的框架JFrame，在JFrame上添加一些Pannel设定布局，再然后在实例化一些GUI组件添加到容器中。其中Frame是带标题和边框的最顶层窗体；Panel是个最简单的容器类，它提供空间让程序放其它组件，包括其它Panel。添加到容器中的组件放在一个列表中。列表的顺序将定义组件在容器内的正向堆栈顺序。如果将组件添加到容器中时未指定索引，则该索引将被添加到列表尾部（此后它位于堆栈顺序的底部）。</li>
<li><p>常用事件接口<br>GUI图像界面的交互，最重要的莫过于就是对事件的处理了。</p>
<ul>
<li><p>点击事件接口<br>继承ActionListener监听接口，并实现其核心函数actionPerformed。其中函数参数ActionEvent可以获得事件发出者的有关信息，比如最重要的事件来源，可以通过getSource()方法获得，进而做一些逻辑判断，以下是计算器小程序中实现actionPerformed的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="keyword">if</span> (e.getSource() == buttons[<span class="number">0</span>][<span class="number">0</span>]) &#123;</span><br><span class="line">        funcOperator(<span class="string">"+"</span>);	</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e.getSource() == buttons[<span class="number">0</span>][<span class="number">1</span>]) &#123;</span><br><span class="line">        funcOperator(<span class="string">"-"</span>);	</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e.getSource() == buttons[<span class="number">0</span>][<span class="number">2</span>]) &#123;</span><br><span class="line">        funcOperator(<span class="string">"*"</span>);		</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e.getSource() == buttons[<span class="number">0</span>][<span class="number">3</span>]) &#123;</span><br><span class="line">        funcOperator(<span class="string">"/"</span>);		</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e.getSource() == buttons[<span class="number">0</span>][<span class="number">4</span>]) &#123;</span><br><span class="line">        funcOk();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (e.getSource() == help) &#123;</span><br><span class="line">        funcHelp();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>键盘事件接口<br>继承KeyListener监听接口，KeyListener监听接口有四个必须需要实现的函数，这里仅展示实现keyPressed的实现，其他函数若不实现必须定义一个空实现。其中函数参数KeyEvent可以获得事件发出者的有关信息，事件来源可以通过getKeyCode()这类方法获得，进而做一些逻辑判断，以下是计算器小程序中实现keyPressed的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">keyPressed</span><span class="params">(KeyEvent e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">    <span class="keyword">if</span>(e.getKeyCode() == KeyEvent.VK_A || e.getKeyCode() == KeyEvent.VK_ADD) &#123;</span><br><span class="line">        funcOperator(<span class="string">"+"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(e.getKeyCode() == KeyEvent.VK_S || e.getKeyCode() == KeyEvent.VK_MINUS) &#123;</span><br><span class="line">        funcOperator(<span class="string">"-"</span>);		</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(e.getKeyCode() == KeyEvent.VK_D || e.getKeyCode() == KeyEvent.VK_MULTIPLY) &#123;</span><br><span class="line">        funcOperator(<span class="string">"*"</span>);		</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(e.getKeyCode() == KeyEvent.VK_F || e.getKeyCode() == KeyEvent.VK_DIVIDE) &#123;</span><br><span class="line">        funcOperator(<span class="string">"/"</span>);		</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(e.getKeyCode() == KeyEvent.VK_G || e.getKeyCode() == KeyEvent.VK_EQUALS) &#123;</span><br><span class="line">        funcOk();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>小程序</p>
<ul>
<li>基本功能如要求，不再赘述</li>
<li>拓展<ul>
<li>菜单栏</li>
<li>快捷键</li>
<li>支持键盘输入<h2 id="学习Junit，利用Ant、Junit测试通过HelloWorld（检查部分）"><a href="#学习Junit，利用Ant、Junit测试通过HelloWorld（检查部分）" class="headerlink" title="学习Junit，利用Ant、Junit测试通过HelloWorld（检查部分）"></a>学习Junit，利用Ant、Junit测试通过HelloWorld（检查部分）</h2></li>
</ul>
</li>
</ul>
</li>
<li>自学junit<br>JUnit 是一个 Java 编程语言的单元测试框架，被开发者用于实施对应用程序的单元测试，加快程序编制速度，同时提高编码的质量，增加了程序员的产量和程序的稳定性，可以减少程序员的压力和花费在排错上的时间。  <ul>
<li>JUnit 测试框架具有以下重要特性：<ul>
<li>测试工具<br>测试工具是一整套固定的工具用于基线测试。测试工具的目的是为了确保测试能够在共享且固定的环境中运行，因此保证测试结果的可重复性。<ul>
<li>在所有测试调用指令发起前的 setUp() 方法。</li>
<li>在测试方法运行后的 tearDown() 方法。</li>
</ul>
</li>
<li>测试套件<br>测试套件意味捆绑几个测试案例并且同时运行。在 JUnit 中，@RunWith 和 @Suite 都被用作运行测试套件。</li>
<li>测试运行器<br>测试运行器 用于执行测试案例。</li>
<li>测试分类<br>测试分类是在编写和测试 JUnit 的重要分类。几种重要的分类如下：<ul>
<li>包含一套断言方法的测试断言</li>
<li>包含规定运行多重测试工具的测试用例</li>
<li>包含收集执行测试用例结果的方法的测试结果</li>
</ul>
</li>
</ul>
</li>
<li>基本用法<ul>
<li>创建并编写好待测试类及其相关方法</li>
<li>创建测试类</li>
<li>创建用来执行测试类的运行类（可选）</li>
</ul>
</li>
</ul>
</li>
<li><p>ant编译运行helloworld</p>
<ul>
<li>文件结构部署（在同一目录下）<ul>
<li>创建src文件夹，将编写好的helloworld.java放入src文件夹</li>
<li>再创建一个build文件夹</li>
<li>创建一个build.xml文件，待写入ant执行task树</li>
</ul>
</li>
<li>build.xml编辑        <ul>
<li>几个要注意的地方<ul>
<li>project元素的basedir属性指定基准文件目录，”.”为build.xml所在目录   </li>
<li>project元素的default指定默认执行的target，如果只想编译而不运行，可以设置成default=”compile”(以我的代码为例)</li>
<li>property元素中可以定义一些常用的变量，比如路径，这里将src文件夹路径赋给src.dir，build文件夹路径赋给build.dir</li>
<li>target名字是自定义的，所以套用模板时记得更改</li>
<li>target:clean可以每次ant之前必须把之前历史生成的.class文件清空</li>
<li>target:compile进行编译，其中的javac元素要用src属性指定java源文件所在路径，用destdir属性指定.class文件输出的路径</li>
<li>target:run运行生成的.class文件，同理其中的java也要指定类文件的路径以及类名</li>
<li>target的depends属性用来指定依赖关系，决定各target的执行顺序</li>
</ul>
</li>
<li>模板大致如下面代码代码<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">name</span>=<span class="string">"helloworld"</span> <span class="attr">basedir</span>=<span class="string">"."</span> <span class="attr">default</span>=<span class="string">"run"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"src.dir"</span> <span class="attr">value</span>=<span class="string">"src"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"build.dir"</span> <span class="attr">value</span>=<span class="string">"build"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"helloworld"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">"master-classpath"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"$&#123;build.dir&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"*.class"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fileset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pathelement</span> <span class="attr">path</span>=<span class="string">"$&#123;build.dir&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">path</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"clean"</span> <span class="attr">description</span>=<span class="string">"Clean output directories"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"$&#123;build.dir&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"**/*.class"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fileset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"compile"</span> <span class="attr">depends</span>=<span class="string">"clean"</span> <span class="attr">description</span>=<span class="string">"Compile source java files"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">"$&#123;build.dir&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">javac</span> <span class="attr">destdir</span>=<span class="string">"$&#123;build.dir&#125;"</span> <span class="attr">includeAntRuntime</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">src</span> <span class="attr">path</span>=<span class="string">"$&#123;src.dir&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">javac</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"run"</span> <span class="attr">depends</span>=<span class="string">"compile"</span> <span class="attr">description</span>=<span class="string">"Run java program"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java</span> <span class="attr">classname</span>=<span class="string">"helloworld"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classpath</span> <span class="attr">refid</span>=<span class="string">"master-classpath"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">java</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>junit测试通过<br>这里我是使用了eclipse进行junit测试，这里简单记录一下操作过程  </p>
<ul>
<li>首先在eclipse中导入Junit，右击eclipse的项目名(这里是helloworld)-&gt;Java Build Path-&gt;Add Library-&gt;Junit-&gt;next-&gt;选择Junit4-&gt;finish</li>
<li>然后会警告xxx版本不能低于1.5，因此需要打开xxx更改其默认版本，</li>
<li>新建测试类，右击待测试的文件(这里是helloworld.java)-&gt;new-&gt;Junit Test Case-&gt;选择创建setUp方法(后面解释)-&gt;next-&gt;勾选helloworld中要测试的函数(这里是main)-&gt;finish</li>
<li><p>编写测试类  </p>
<ul>
<li>遇到的困难：通过代码可见完成测试最核心的函数就是assertEquals(arg1, arg2)，通常arg2是通过调用待测试的函数来获取返回值以比较是否达到期望，但是由于这里测试的是无返回值的main方法，且该main方法是helloworld类的一个静态方法，可以不通过创建实例便能直接用类名调用，造成获得arg2进行比较。</li>
<li>解决方案：<ul>
<li>这个方法比较简单，但是通用性不强。可以将helloworld的main方法改成普通函数，且有一个String的返回值，便可以直接调用该方法获得arg2</li>
<li>这个方法看起来比较复杂，但是通用性比较强。就是通过流获取到控制台的输出，将该流转成arg2以进行比较。这类方法可以测试所有有控制台输出的void方法</li>
<li>当然，还有其他测试void函数的方法，因为毕竟一个函数运行了，程序的状态，一些变量的值都会发生改变，可以通过检测这些状态来进行测试，但是由于时间问题这里就没有尝试</li>
</ul>
</li>
<li><p>代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> junit_test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"><span class="keyword">import</span> junit_test.helloworld;</span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">helloworldTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    ByteArrayOutputStream mybyte = <span class="keyword">null</span>;</span><br><span class="line">    PrintStream console = <span class="keyword">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// something need to be prepared before run test</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// to get the output on the console by stream</span></span><br><span class="line">        mybyte = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        console = System.out;</span><br><span class="line">        System.setOut(<span class="keyword">new</span> PrintStream(mybyte));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// test case</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// pass an empty argument</span></span><br><span class="line">        String[] str = <span class="keyword">new</span> String[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// run static method</span></span><br><span class="line">        helloworld.main(str);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// compare the expected output and the console output</span></span><br><span class="line">        assertEquals(<span class="string">"Hello World!\n"</span>, mybyte.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>运行测试类</p>
<ul>
<li>我的文件结构<ul>
<li>junit_test<ul>
<li>helloworld.java</li>
<li>helloworldTest.java</li>
</ul>
</li>
</ul>
</li>
<li>步骤：右击待测试类所在项目名(这里是junit_test)-&gt;Run As-&gt;JUnit Test，如果没有failure出现则说明通过，如果有failure出现，可以双击failure查看错误对比<h2 id="学习并配置SonarQube，利用SonarQube测试自己昨天写的Java小程序"><a href="#学习并配置SonarQube，利用SonarQube测试自己昨天写的Java小程序" class="headerlink" title="学习并配置SonarQube，利用SonarQube测试自己昨天写的Java小程序"></a>学习并配置SonarQube，利用SonarQube测试自己昨天写的Java小程序</h2></li>
</ul>
</li>
</ul>
</li>
<li><p>配置SonarQube</p>
<ul>
<li>获取安装包<br>在自己虚拟机上可以通过sudo获取，但是由于云桌面没有权限所以直接给了安装包，在云桌面/opt/resources目录下，将该目录下的sonar-3.7.4.zip和sonar-runner-dist-2.4.zip移到桌面上(方便起见我是移到桌面，当然也可以是其他目录，但是环境变量设置的时候就要对应相应的目录)，并解压</li>
<li><p>配置环境变量<br>配置Sonar环境变量的核心就是将这下面几行代码加入系统环境变量集中。至于如何添加，有以下三种方法</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export SONAR_HOME=/home/Desktop/sonar-3.7.4/bin/linux-x86-32</span><br><span class="line">export SONAR_RUNNER_HOME=/home/Desktop/sonar-runner-2.4</span><br><span class="line">export PATH=$SONAR_RUNNER_HOME/bin:$PATH</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">- 修改/etc/profile文件(推荐)  </span><br><span class="line">修改方法就类似Java环境配置，但是修改profile文件需要sudo权限，由于云平台没有sudo权限，所以该方法在云平台无效，可以在自己的虚拟机上测试该方法</span><br><span class="line">- 修改.bashrc文件(个人用户有效)---采用</span><br><span class="line">这种方法只对个人用户有效，但是已足够。.bashrc文件在~目录下，~等价于/home/username/，由于.bashrc是隐藏文件，所以在该目录下ls是不可见的，la才可以。然后可以通过vi/vim打开该文件往其中追加上面提到的代码。保存并退回shell界面的时候，键入以下命令，可以重新加载当前用户的环境变量源</span><br></pre></td></tr></table></figure>
<p>  souce ~/.bashrc</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">        - 直接在shell修改(只对当前Shell有效)</span><br><span class="line">        这种方法比较局限，只能在当前的shell界面有效，关闭当前shell之后就丢失了。虽然配置很简单，直接在shell中键入上面提到的三行代码即可</span><br><span class="line">- 启动Sonar服务  </span><br><span class="line">    - 进入到sonar.sh所在的文件夹</span><br></pre></td></tr></table></figure>
<p>cd $SONAR_HOME<br>or<br>cd /home/Desktop/sonar-3.7.4/bin/linux-x86-32</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 在该目录下执行相关命令</span><br><span class="line">每次使用完Sonar要记得stop</span><br></pre></td></tr></table></figure>
<p>./sonar.sh start 启动服务<br>./sonar.sh stop 终止服务<br>./sonar.sh restart 重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- 编写sonar-project.properties配置文件  </span><br><span class="line">配置文件基本按照这个模板，每次要改的一般就是projeckkey，projectName，projectBaseDir。分别前两个是该项目的唯一标识，第三个是源文件所在文件夹的路径（项目文件结构更改的时候要记得修改这个）</span><br><span class="line">``` </span><br><span class="line">sonar.projectKey = Calculator</span><br><span class="line">sonar.projectName = Calculator</span><br><span class="line">sonar.projectVersion = 1.0</span><br><span class="line"></span><br><span class="line">sonar.sourceEncoding = UTF-8</span><br><span class="line">sonar.modules = java-module</span><br><span class="line"></span><br><span class="line">java-module.sonar.projectName = Java Module</span><br><span class="line">java-module.sonar.language = java</span><br><span class="line"></span><br><span class="line">java-module.sonar.sources = .</span><br><span class="line">java-module.sonar.projectBaseDir = Part1/Calculator/src</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行sonar-runner<br>文件结构和配置文件部署好之后，在配置文件所在目录(该目录必须有sonar-runner相关的包，所以这里我的是Desktop)键入以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sonar-runner</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看项目评测情况<br>打开浏览器访问<a href="http://localhost:9000即可，综合评测结果可以通过RCI的值来判断(0~100)越高越好。具体的错误和建议也可以看得到。" target="_blank" rel="noopener">http://localhost:9000即可，综合评测结果可以通过RCI的值来判断(0~100)越高越好。具体的错误和建议也可以看得到。</a></p>
</li>
</ul>
</li>
</ul>
<h2 id="完成GridWorld的环境配置，学习gridworld-jar的引用，编译运行BugRunner"><a href="#完成GridWorld的环境配置，学习gridworld-jar的引用，编译运行BugRunner" class="headerlink" title="完成GridWorld的环境配置，学习gridworld.jar的引用，编译运行BugRunner"></a>完成GridWorld的环境配置，学习gridworld.jar的引用，编译运行BugRunner</h2><ul>
<li>获取安装包<br>在自己虚拟机上可以通过sudo获取，但是由于云桌面没有权限所以直接给了安装包，在云桌面/opt/resources目录下，将该目录下的grid-world.zip移到桌面上(方便起见我是移到桌面，当然也可以是其他目录，但是环境变量设置的时候就要对应相应的目录)，并解压</li>
<li><p>运行BugRunner<br>找到gridworld.jar所在文件目录，键入以下代码添加引用并编译运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac -classpath .:gridworld.jar/projects/fisrtProject/BugRunner.java</span><br><span class="line">java -classpath .:gridworld.jar:projects/firsrProject BugRunner</span><br></pre></td></tr></table></figure>
</li>
<li><p>gridworld.jar引用<br>jar包就是别人已经写好的一些类，然后将这些类进行打包，你可以将这些jar包引入你的项目中，然后就可以直接使用这些jar包中的类和属性了。所以引用gridworld.jar，简单来讲就是像c/c++里的include，java里面的import也是一个道理，在BugRunner里面import了一下gridworld.jar里面的库，就必须把gridworld.jar引用进来，否则就像c/c++里面用了某些头文件里面的函数却没有包含那个头文件，就会报函数未定义或者引用错误之类的信息。</p>
<h2 id="My-Short-Answer-on-Matrix"><a href="#My-Short-Answer-on-Matrix" class="headerlink" title="My Short Answer on Matrix"></a>My Short Answer on Matrix</h2></li>
</ul>
<hr>
<h3 id="Step1-Running-the-Demo"><a href="#Step1-Running-the-Demo" class="headerlink" title="Step1 Running the Demo"></a>Step1 Running the Demo</h3><ol>
<li>Does the bug always move to a new location? Explain.<br>Not always. The bug will only move to a new location when the location in front of it is empty and exists, whether there is a flower in the cell or not.   </li>
<li>In which direction does the bug move?<br>The bug will move to the cell in front of it, only when the bug can move, so there maybe four directions. However, the bug will just turn 45° clockwise per step when it can’t move.</li>
<li>What does the bug do if it does not move?<br>The bug will just turn 45° clockwise per step when it can’t move, until it can move.</li>
<li>What does a bug leave behind when it moves?<br>The bug will leave a flower behind, and the flower’s color is the same as the bug’s.</li>
<li>What happens when the bug is at an edge of the grid? (Consider whether the bug is facing the edge as well as whether the bug is facing some other direction when answering this question.)<br>The bug will just turn 45° clockwise per step when it can’t move(facing an edge or facing a rock), and it will continue to turn the direction until it can move.</li>
<li>What happens when a bug has a rock in the location immediately in front of it?<br>The bug will act like when it facing an edge, turning 45° clockwise per step util it can move.</li>
<li>Does a flower move?<br>No. Flower can’t move.</li>
<li>What behavior does a flower have?<br>The flower has fading behavior. It starts fading when it’s produced, and its color is getting dark. And it cannot stop fading until it’s covered by a new flower.</li>
<li>Does a rock move or have any other behavior?<br>No. The rock can not move, and it doesn’t seems like having any other behavior.</li>
<li>Can more than one actor (bug, flower, rock) be in the same location in the grid at the same time?<br>No. The grid cell can only contain an actor at a time.</li>
</ol>
<hr>
<h3 id="Step2-Exploring-Actor-State-and-Behavior"><a href="#Step2-Exploring-Actor-State-and-Behavior" class="headerlink" title="Step2 Exploring Actor State and Behavior"></a>Step2 Exploring Actor State and Behavior</h3><ol>
<li>Test the setDirection method with the following inputs and complete the table, giving the compass direction each input represents. </li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">Degrees</th>
<th style="text-align:center">Compass Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">North</td>
</tr>
<tr>
<td style="text-align:center">45</td>
<td style="text-align:center">North East</td>
</tr>
<tr>
<td style="text-align:center">90</td>
<td style="text-align:center">East</td>
</tr>
<tr>
<td style="text-align:center">135</td>
<td style="text-align:center">South East</td>
</tr>
<tr>
<td style="text-align:center">180</td>
<td style="text-align:center">South</td>
</tr>
<tr>
<td style="text-align:center">225</td>
<td style="text-align:center">South West</td>
</tr>
<tr>
<td style="text-align:center">270</td>
<td style="text-align:center">West</td>
</tr>
<tr>
<td style="text-align:center">315</td>
<td style="text-align:center">North West</td>
</tr>
<tr>
<td style="text-align:center">360</td>
<td style="text-align:center">North</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>Move a bug to a different location using the moveTo method. In which directions can you move it? How far can you move it? What happens if you try to move the bug outside the grid?<ul>
<li>The bug can move to any valid cell in the gridworld, but without changing the direction;</li>
<li>The diagonal line is the farthest;</li>
<li>The program will throw an IllegalArgumentException exception.</li>
</ul>
</li>
<li>Change the color of a bug, a flower, and a rock. Which method did you use?<br>The setColor method.</li>
<li>Move a rock on top of a bug and then move the rock again. What happened to the bug?<br>When a rock move to the location of a bug, the bug will be covered by the rock, and will disappear when the rock moves away.</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/15/SYSU-SE-2018-Part1/" data-id="cjmdefswz00005sq21gycjvmk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/中级实训/">中级实训</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw3-魔鬼与牧师v2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/" class="article-date">
  <time datetime="2018-04-10T14:09:05.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/">Unity3d_hw3_魔鬼与牧师v2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="操作与总结"><a href="#操作与总结" class="headerlink" title="操作与总结"></a>操作与总结</h1><h2 id="参考-Fantasy-Skybox-FREE-构建自己的游戏场景"><a href="#参考-Fantasy-Skybox-FREE-构建自己的游戏场景" class="headerlink" title="参考 Fantasy Skybox FREE 构建自己的游戏场景"></a>参考 Fantasy Skybox FREE 构建自己的游戏场景</h2><ul>
<li>首先要去Assets store里找到对应的资源下载，在搜索框输入Fantasy Skybox FREE有如下结果，选择第一个下载，然后import导入到项目资源中，便可以使用这个资源包了。</li>
<li>Skybox顾名思义，天空盒，是用来模拟游戏场景中的天空效果的。由于scene和game的视角从某种意义上来说是固定的，所以要较好的模拟天空的效果，就需要把天空当成一个六面体的盒，在每个面上贴上对应的Texture，以此来模拟天空罩住游戏场景。</li>
<li>下图是用了天空盒构建的场景图<br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/skybox.jpg" alt=""></li>
<li>只有天空或许显得单调，我们可以再给它加个地形Terrain，地形的贴图以及后来的花草树木在新版本的unity里面是没有自带的，也需要自行到Assets store里面下载导入。</li>
<li>以下是最终的效果图(water environment还没来得及做)<br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/scene1.png" alt=""><br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/scene2.png" alt=""></li>
</ul>
<h2 id="写一个简单的总结，总结游戏对象的使用"><a href="#写一个简单的总结，总结游戏对象的使用" class="headerlink" title="写一个简单的总结，总结游戏对象的使用"></a>写一个简单的总结，总结游戏对象的使用</h2><ul>
<li>游戏对象可以使用unity自带的正方体，圆柱体，球体等基础的资源构建</li>
<li>游戏对象也可以通过基础游戏对象组合构建之后做成预制，以便后来重复使用</li>
<li>游戏对象有许多属性，比较重要的有Transform属性，和纹理材质等</li>
<li>游戏对象可以添加许多组件，来实现不同的特定功能，使效果更加炫酷</li>
<li>游戏对象既可以在图形界面实例化，也可以通过代码实例化</li>
<li>游戏对象可以通过添加对应的脚本来实现不同的行为</li>
<li>等等<h1 id="编程实践—牧师与魔鬼"><a href="#编程实践—牧师与魔鬼" class="headerlink" title="编程实践—牧师与魔鬼"></a>编程实践—牧师与魔鬼</h1></li>
<li>本项目Github地址——<a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework3" target="_blank" rel="noopener">传送门</a></li>
<li>鉴于上次写的牧师与魔鬼v1版本没有来得及写博客，这次顺便补上,以下介绍从基础MVC版本到动作分离版的过渡<h2 id="牧师与魔鬼v1——基础MVC架构版"><a href="#牧师与魔鬼v1——基础MVC架构版" class="headerlink" title="牧师与魔鬼v1——基础MVC架构版"></a>牧师与魔鬼v1——基础MVC架构版</h2></li>
<li>MVC架构，简单来说目的是使代码分层，解耦，使每个类尽可能地行使单一的职责，以便于之后维护和扩展；另外，模块化的架构还可以使刚开始编程时尽可能少的考虑细节，使代码编写趋于简单。<blockquote>
<p>MVC架构定义：MVC全名是Model View Controller，是模型(model)－视图(view)－控制器(controller)的缩写，一种软件设计典范，用一种业务逻辑、数据、界面显示分离的方法组织代码，将业务逻辑聚集到一个部件里面，在改进和个性化定制界面及用户交互的同时，不需要重新编写业务逻辑。MVC被独特的发展起来用于映射传统的输入、处理和输出功能在一个逻辑的图形化用户界面的结构中。——百度百科</p>
</blockquote>
</li>
<li>游戏规则：很经典的游戏，应该大家以前都玩过。游戏初始界面是三个牧师和三个魔鬼都在同一侧河岸，准备过河，但只有一条船且只能容纳两个对象，船必须至少有一个对象才能开动。游戏目的是采取合适的策略将全部牧师和魔鬼安全送到对岸，如果途中出现某一岸魔鬼多于牧师的情况，则游戏失败。</li>
<li>先贴一下此版本的效果图<ul>
<li>启动界面<br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/PriestAndDevil1.jpg" alt="">  </li>
<li>胜利界面<br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/PriestAndDevil2.jpg" alt=""></li>
<li>失败界面<br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/PriestAndDevil3.jpg" alt="">  </li>
</ul>
</li>
<li>本项目分离出来的MVC框架<br>Model: Shore, Boat, Item<br>View: UserGUI, ClickGUI<br>Controller: BoatControl, ShoreControl, ItemControl, FirstControl, Director</li>
<li>以下是各个类的简要作用，代码较多就不一一贴上来了，可前往Github查看具体代码</li>
<li>Model——模型（可预制）<ul>
<li>Shore：岸的实例    </li>
<li>Boat：船的实例</li>
<li>Item：对象(魔鬼或牧师)的实例</li>
</ul>
</li>
<li>View——视图<ul>
<li>UserGUI<br>用户交互界面</li>
<li>ClickGUI<br>响应点击事件</li>
</ul>
</li>
<li><p>Controler——控制器</p>
<ul>
<li><p>Director：导演，总指挥，单例模式</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Diretor : System.Object</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Diretor _instance;</span><br><span class="line">    <span class="keyword">public</span> SceneControl sceneCtrl &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Diretor <span class="title">getInstance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (_instance == <span class="literal">null</span>) <span class="keyword">return</span> _instance = <span class="keyword">new</span> Diretor();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> _instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FirstControl：第一场景控制器，是唯一加到对象上的脚本</p>
</li>
<li>BoatControl：船的控制器，包括记录船上空余位置，船的属性和状态等</li>
<li>ShoreControl：岸的控制器，包括记录岸上空余位置，对象上岸离岸等</li>
<li>ItemControl：对象的控制器，包括对象的实例化，控制对象的移动</li>
</ul>
</li>
<li><p>一些接口</p>
<ul>
<li><p>SceneControl：负责整个场景的实例化</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">SceneControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LoadPrefabs</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserAction：控制动作</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">UserAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">BoatMove</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">ItemClick</span>(<span class="params">ItemControl itemCtrl</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>提一下主要的动作控制类——Moveable</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Moveable</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> time = <span class="number">3</span>; <span class="comment">//抛物时间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> g = <span class="number">-10</span>; <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 v0; <span class="comment">//初速度</span></span><br><span class="line">    <span class="keyword">private</span> Vector3 Gravity; <span class="comment">//由重力产生的垂直速度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> dTime = <span class="number">0</span>; <span class="comment">//记录运动时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> fixUpdateStep = <span class="number">0.1</span>f; <span class="comment">//设置运动速度</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">float</span> speed = <span class="number">20</span>; <span class="comment">//船的移速</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> status; <span class="comment">//运动状态</span></span><br><span class="line">    Vector3 des; <span class="comment">//终点</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (status == <span class="number">1</span>) <span class="comment">// 实现对象抛物线运动</span></span><br><span class="line">        &#123;</span><br><span class="line">            Gravity.y = g * (dTime += fixUpdateStep);</span><br><span class="line">            transform.Translate(v0 * fixUpdateStep);</span><br><span class="line">            transform.Translate(Gravity * fixUpdateStep);</span><br><span class="line">            <span class="keyword">if</span> (dTime &gt;= time - fixUpdateStep)</span><br><span class="line">            &#123;</span><br><span class="line">                transform.position = des;</span><br><span class="line">                status = <span class="number">0</span>;</span><br><span class="line">                dTime = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (status == <span class="number">2</span>) <span class="comment">// 实现船的直线运动</span></span><br><span class="line">        &#123;</span><br><span class="line">            transform.position = Vector3.MoveTowards(transform.position, des, speed * fixUpdateStep);</span><br><span class="line">            <span class="keyword">if</span> (transform.position == des) status = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveTo</span>(<span class="params">Vector3 target</span>) <span class="comment">// 设置运动的终点，并以此计算抛物线的初速度</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        des = target;</span><br><span class="line">        status = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (des.y == transform.position.y) status = <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//Debug.Log("From:" + transform.position);</span></span><br><span class="line">        v0 = <span class="keyword">new</span> Vector3((des.x - transform.position.x) / time,</span><br><span class="line">            (des.y - transform.position.y) / time - <span class="number">0.5</span>f * g * time, (des.z - transform.position.z) / time);</span><br><span class="line">        Gravity = Vector3.zero;</span><br><span class="line">        <span class="comment">//Debug.Log("v0:" + v0);</span></span><br><span class="line">        <span class="comment">//Debug.Log("Target:" + target);                       </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        status = <span class="number">0</span>;</span><br><span class="line">        dTime = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="牧师与魔鬼v2——动作分离版"><a href="#牧师与魔鬼v2——动作分离版" class="headerlink" title="牧师与魔鬼v2——动作分离版"></a>牧师与魔鬼v2——动作分离版</h2><p><strong>最主要的改动——利用ActionManager的模板，实现Movable类的转移</strong><br>这里不再介绍MVC，直接开始介绍动作分离。</p>
<ul>
<li>先上效果图，改进了UI，现学现用加了一个天空盒<br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/PriestAndDevil1_v2.jpg" alt=""><br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/PriestAndDevil2_v2.jpg" alt=""><br><img src="/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/PriestAndDevil3_v2.jpg" alt=""></li>
<li>添加的文件——Action，有关动作管理的类和实现全都转移到这个文件里，模板基本套用ppt上现成代码，略作修改</li>
<li><p>动作的分离，以下改动主要是将v1遗留的耦合动作剔除</p>
<ul>
<li><p>FirstControl里的改动</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">private</span> ActionManager MyActionManager; <span class="comment">// add in v2</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">// Use this for initialization</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       Diretor diretor = Diretor.getInstance();</span><br><span class="line">       diretor.sceneCtrl = <span class="keyword">this</span>;</span><br><span class="line">       itemCtrls = <span class="keyword">new</span> ItemControl[<span class="number">6</span>];</span><br><span class="line">       LoadPrefabs();</span><br><span class="line">       user = gameObject.AddComponent&lt;UserGUI&gt;();</span><br><span class="line">       user.Restart();</span><br><span class="line">       MyActionManager = gameObject.AddComponent&lt;ActionManager&gt;() <span class="keyword">as</span> ActionManager; <span class="comment">// add in v2</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BoatMove</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Debug.Log(<span class="string">"BoatMove"</span>);</span><br><span class="line">    <span class="keyword">if</span> (boat.IsEmpty()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//boat.Move();</span></span><br><span class="line">    MyActionManager.MoveBoat(boat); <span class="comment">// add in v2</span></span><br><span class="line">    user.step++;</span><br><span class="line">    user.status = Check();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ItemClick</span>(<span class="params">ItemControl itemCtrl</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Debug.Log(<span class="string">"ItemClick"</span>);</span><br><span class="line">    <span class="keyword">if</span> (itemCtrl.isOnBoat)</span><br><span class="line">    &#123;</span><br><span class="line">        ShoreControl side;</span><br><span class="line">        <span class="keyword">if</span> (boat.status == <span class="number">1</span>) side = fromShore;</span><br><span class="line">        <span class="keyword">else</span> side = toShore;</span><br><span class="line"></span><br><span class="line">        Debug.Log(side.GetEmptyPosition());</span><br><span class="line">        boat.GetOffBoat(itemCtrl);</span><br><span class="line">        <span class="comment">//itemCtrl.MoveTo(side.GetEmptyPosition());</span></span><br><span class="line">        MyActionManager.MoveItem(itemCtrl, side.GetEmptyPosition()); <span class="comment">// add in v2</span></span><br><span class="line">        itemCtrl.GetOnShore(side);</span><br><span class="line">        side.GetOnShore(itemCtrl);</span><br><span class="line">        user.step++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (boat.IsFull()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        Debug.Log(itemCtrl.item.name + <span class="string">" getting on boat"</span>);</span><br><span class="line">        ShoreControl side = itemCtrl.shoreCtrl;</span><br><span class="line">        <span class="keyword">if</span> (side.status != boat.status) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        side.GetOffShore(itemCtrl.item.name);</span><br><span class="line">        <span class="comment">//Debug.Log(MyActionManager);</span></span><br><span class="line">        <span class="comment">//Debug.Log(itemCtrl);</span></span><br><span class="line">        <span class="comment">//Debug.Log(boat);</span></span><br><span class="line">        <span class="comment">//itemCtrl.MoveTo(boat.GetOnBoat(itemCtrl));</span></span><br><span class="line">        MyActionManager.MoveItem(itemCtrl, boat.GetOnBoat(itemCtrl)); <span class="comment">// add in v2</span></span><br><span class="line">        itemCtrl.GetOnBoat(boat);</span><br><span class="line">        user.step++;</span><br><span class="line">    &#125;</span><br><span class="line">    user.status = Check();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>BoatControl的改动</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BoatControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> GameObject boat;</span><br><span class="line">    <span class="comment">//public Moveable moveable; // remove in v2</span></span><br><span class="line">    <span class="keyword">public</span> Vector3 <span class="keyword">from</span> = <span class="keyword">new</span> Vector3(<span class="number">10</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> Vector3 to = <span class="keyword">new</span> Vector3(<span class="number">-10</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> Vector3[] froms;</span><br><span class="line">    <span class="keyword">public</span> Vector3[] tos;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> status; <span class="comment">// from = 1, to = 0</span></span><br><span class="line">    <span class="keyword">public</span> ItemControl leftSeat;</span><br><span class="line">    <span class="keyword">public</span> ItemControl rightSeat;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> speed = <span class="number">50</span>; <span class="comment">// add in v2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BoatControl</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        status = <span class="number">1</span>;</span><br><span class="line">        leftSeat = <span class="literal">null</span>;</span><br><span class="line">        rightSeat = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        froms = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">9</span>, <span class="number">3</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">        tos = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">-11</span>, <span class="number">3</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">-9</span>, <span class="number">3</span>, <span class="number">0</span>) &#125;;</span><br><span class="line"></span><br><span class="line">        boat = (GameObject)Object.Instantiate(Resources.Load(<span class="string">"Prefabs/Boat"</span>, <span class="keyword">typeof</span>(GameObject)), <span class="keyword">from</span>, Quaternion.identity, <span class="literal">null</span>);           </span><br><span class="line">        boat.name = <span class="string">"Boat"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//moveable = boat.AddComponent(typeof(Moveable)) as Moveable; // remove in v2</span></span><br><span class="line">        boat.AddComponent(<span class="keyword">typeof</span>(ClickGUI)); <span class="comment">// add click event</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//public void Move() // remove in v2</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    if (status == -1) moveable.MoveTo(from);</span></span><br><span class="line">    <span class="comment">//    else moveable.MoveTo(to);</span></span><br><span class="line">    <span class="comment">//    status = -status;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsEmpty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (leftSeat == <span class="literal">null</span> &amp;&amp; rightSeat == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsFull</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (leftSeat != <span class="literal">null</span> &amp;&amp; rightSeat != <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector3 <span class="title">GetOnBoat</span>(<span class="params">ItemControl item</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (leftSeat == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            leftSeat = item;</span><br><span class="line">            <span class="keyword">return</span> status == <span class="number">-1</span> ? tos[<span class="number">0</span>] : froms[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (rightSeat == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            rightSeat = item;</span><br><span class="line">            <span class="keyword">return</span> status == <span class="number">-1</span> ? tos[<span class="number">1</span>] : froms[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ItemControl <span class="title">GetOffBoat</span>(<span class="params">ItemControl item</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// to decide which item to get off</span></span><br><span class="line">        ItemControl temp = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (leftSeat == item)</span><br><span class="line">        &#123;</span><br><span class="line">            temp = leftSeat;</span><br><span class="line">            leftSeat = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (rightSeat == item)</span><br><span class="line">        &#123;</span><br><span class="line">            temp = rightSeat;</span><br><span class="line">            rightSeat = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetItemNum</span>(<span class="params"><span class="keyword">int</span> type</span>) <span class="comment">// get the num of item, priest or devil</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (leftSeat != <span class="literal">null</span> &amp;&amp; leftSeat.itemType == type) count++;</span><br><span class="line">        <span class="keyword">if</span> (rightSeat != <span class="literal">null</span> &amp;&amp; rightSeat.itemType == type) count++;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//moveable.Reset(); // remove in v2</span></span><br><span class="line">        <span class="comment">//if (status == -1) Move(); // remove in v2</span></span><br><span class="line">        leftSeat = <span class="literal">null</span>;</span><br><span class="line">        rightSeat = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ItemControl的改动</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItemControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> GameObject item &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; <span class="comment">// the instance</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> itemType &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; <span class="comment">// the type of the item</span></span><br><span class="line">    <span class="keyword">public</span> ClickGUI clickGUI; <span class="comment">// manage click event</span></span><br><span class="line">    <span class="comment">//public Moveable moveable; // remove in v2</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> isOnBoat;</span><br><span class="line">    <span class="keyword">public</span> ShoreControl shoreCtrl;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemControl</span>(<span class="params"><span class="keyword">string</span> type</span>) <span class="comment">//Instantiate</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="string">"Priest"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            item = Object.Instantiate(Resources.Load(<span class="string">"Prefabs/Priest"</span>, <span class="keyword">typeof</span>(GameObject)), Vector3.zero, Quaternion.identity, <span class="literal">null</span>) <span class="keyword">as</span> GameObject;</span><br><span class="line">            itemType = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            item = Object.Instantiate(Resources.Load(<span class="string">"Prefabs/Devil"</span>, <span class="keyword">typeof</span>(GameObject)), Vector3.zero, Quaternion.identity, <span class="literal">null</span>) <span class="keyword">as</span> GameObject;</span><br><span class="line">            itemType = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//moveable = item.AddComponent(typeof(Moveable)) as Moveable; // remove in v2</span></span><br><span class="line"></span><br><span class="line">        clickGUI = item.AddComponent(<span class="keyword">typeof</span>(ClickGUI)) <span class="keyword">as</span> ClickGUI; <span class="comment">// add click event</span></span><br><span class="line">        clickGUI.itemCtrl = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//public void MoveTo(Vector3 des) // remove in v2</span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//    moveable.MoveTo(des);</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetOnBoat</span>(<span class="params">BoatControl boatCtrl</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        shoreCtrl = <span class="literal">null</span>;</span><br><span class="line">        item.transform.parent = boatCtrl.boat.transform;</span><br><span class="line">        isOnBoat = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetOnShore</span>(<span class="params">ShoreControl side</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        shoreCtrl = side;</span><br><span class="line">        item.transform.parent = <span class="literal">null</span>;</span><br><span class="line">        isOnBoat = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//moveable.Reset(); // remove in v2</span></span><br><span class="line">        ShoreControl fromShore = ((FirstControl)Diretor.getInstance().sceneCtrl).fromShore;</span><br><span class="line">        GetOnShore(fromShore);</span><br><span class="line">        item.transform.position = fromShore.GetEmptyPosition();</span><br><span class="line">        fromShore.GetOnShore(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Moveable的转移<br>这里简要提一下抛物线从Moveable转移到ActionManager的处理，原本在Movable里面是将抛物线分成一小段一小段的直线位移，利用固定帧的刷新来实现抛物线的曲线效果，但是因为Moveable既管理船的动作又管理对象的动作，就避免不了要用状态来区分到底是要执行谁的动作，这样看起来代码就不是很美观，可读性也有所下降。而在ActionManager中，虽然也是同时管理船的动作和对象的动作，但是却可以用<strong>单运动</strong>和<strong>组合运动</strong>来区分两者，单运动的处理就不用再赘述了，关于组合运动这里有个重要的方法就是SequenceAction，要知道把动作看成一小段一小段的直线运动的组合，就能实现几乎所有的曲线运动，也就是说，ActionManager完美解决了所有的曲线运动。在这里，虽然我也是将抛物线分成一小段一小段的直线运动，但并不是像Moveable里一样直接使用帧刷新来完成运动，而是通过将分段后的动作顺序放入一个Action的List中，交由SequenceAction来处理多个动作的连贯组合，就很好地避免了Moveable里面区分状态的尴尬局面。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ActionManager</span> : <span class="title">SSActionManager</span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveBoat</span>(<span class="params">BoatControl boatCtrl</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SSMoveToAction action;</span><br><span class="line">        <span class="keyword">if</span> (boatCtrl.status == <span class="number">-1</span>) </span><br><span class="line">            action = SSMoveToAction.GetSSMoveToAction(boatCtrl.<span class="keyword">from</span>, BoatControl.speed);</span><br><span class="line">        <span class="keyword">else</span> action = SSMoveToAction.GetSSMoveToAction(boatCtrl.to, BoatControl.speed);</span><br><span class="line">        boatCtrl.status = -boatCtrl.status;</span><br><span class="line">        AddAction(boatCtrl.boat, action, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveItem</span>(<span class="params">ItemControl itemCtrl, Vector3 finalDes</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//Debug.Log("enter MoveItem!");</span></span><br><span class="line">        <span class="keyword">float</span> time = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">float</span> g = <span class="number">-10</span>;</span><br><span class="line">        Vector3 v0;</span><br><span class="line">        <span class="keyword">float</span> vy_ByGravity = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">float</span> stepTime = <span class="number">0.1</span>f;</span><br><span class="line">        Vector3 currentDes = itemCtrl.item.transform.position;</span><br><span class="line"></span><br><span class="line">        List&lt;SSAction&gt; divide = <span class="keyword">new</span> List&lt;SSAction&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the des here is the final des</span></span><br><span class="line">        v0 = <span class="keyword">new</span> Vector3((finalDes.x - itemCtrl.item.transform.position.x) / time,</span><br><span class="line">            (finalDes.y - itemCtrl.item.transform.position.y) / time - <span class="number">0.5</span>f * g * time, (finalDes.z - itemCtrl.item.transform.position.z) / time);</span><br><span class="line">        <span class="comment">//Debug.Log(v0);</span></span><br><span class="line">        <span class="comment">//Debug.Log(time / stepTime);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// divide the curve to many parts</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; time / stepTime - <span class="number">1</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//Debug.Log(divide[i]);</span></span><br><span class="line">            <span class="comment">//Debug.Log(currentDes);</span></span><br><span class="line">            <span class="comment">// change the vy</span></span><br><span class="line">            vy_ByGravity += g * stepTime;</span><br><span class="line">            <span class="comment">// set current des</span></span><br><span class="line">            currentDes += v0 * stepTime;</span><br><span class="line">            currentDes.y += vy_ByGravity * stepTime;</span><br><span class="line">            <span class="comment">// get the current speed</span></span><br><span class="line">            <span class="keyword">float</span> currentSpeed = Mathf.Sqrt(v0.x * v0.x + (v0.y + vy_ByGravity) * (v0.y + vy_ByGravity));</span><br><span class="line">            <span class="comment">// add one of the movements</span></span><br><span class="line">            SSAction temp = SSMoveToAction.GetSSMoveToAction(currentDes, currentSpeed * <span class="number">10</span>);</span><br><span class="line">            divide.Add(temp);</span><br><span class="line">        &#125;</span><br><span class="line">        SSAction seqAction = SequenceAction.GetSequenceAction(<span class="number">1</span>, <span class="number">0</span>, divide);</span><br><span class="line">        AddAction(itemCtrl.item, seqAction, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/Unity3d-hw3-魔鬼与牧师v2/" data-id="cjmdefsxm00085sq23l3beoqt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Unity3d-hw2-太阳系-魔鬼与牧师v1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/" class="article-date">
  <time datetime="2018-04-03T12:46:50.000Z" itemprop="datePublished">2018-04-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/">Unity3d-hw2-太阳系-魔鬼与牧师v1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="简答题"><a href="#简答题" class="headerlink" title="简答题"></a>简答题</h1><ol>
<li>游戏对象运动的本质是什么？</li>
<li>请用三种方法以上方法，实现物体的抛物线运动。（如，修改Transform属性，使用向量Vector3的方法…）</li>
<li>写一个程序，实现一个完整的太阳系， 其他星球围绕太阳的转速必须不一样，且不在一个法平面上。  </li>
</ol>
<h1 id="个人理解"><a href="#个人理解" class="headerlink" title="个人理解"></a>个人理解</h1><ol>
<li><p>游戏对象运动的本质是游戏对象的位置的改变。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Uniform</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GameObject MyCube;</span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        MyCube = GameObject.Find(<span class="string">"Cube"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;      </span><br><span class="line">        MyCube.transform.position += (<span class="keyword">float</span>)<span class="number">0.1</span> * Vector3.left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>抛物线运动的三种实现</p>
<ul>
<li>修改Transform<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Parabola1</span> : <span class="title">MonoBehaviour</span> &#123;	</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GameObject MySphere;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> vx;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> vz;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> a;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> t;</span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MySphere = GameObject.Find(<span class="string">"Sphere"</span>);</span><br><span class="line">        vx = (<span class="keyword">float</span>)<span class="number">0.5</span>;</span><br><span class="line">        vz = <span class="number">0</span>;</span><br><span class="line">        a = (<span class="keyword">float</span>)<span class="number">0.1</span>;</span><br><span class="line">        t = Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> x = MySphere.transform.position.x;</span><br><span class="line">        <span class="keyword">float</span> y = MySphere.transform.position.y;</span><br><span class="line">        <span class="keyword">float</span> z = MySphere.transform.position.z;</span><br><span class="line">        MySphere.transform.position = <span class="keyword">new</span> Vector3(x + vx, y, z + vz);</span><br><span class="line">        vz += a * t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">- 使用Vector3  </span><br><span class="line">``` csharp</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Parabola2</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GameObject MyCapsule;</span><br><span class="line">    <span class="keyword">private</span> Vector3 vx;</span><br><span class="line">    <span class="keyword">private</span> Vector3 vz;</span><br><span class="line">    <span class="keyword">private</span> Vector3 a;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> t;</span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyCapsule = GameObject.Find(<span class="string">"Capsule"</span>);</span><br><span class="line">        vx = (<span class="keyword">float</span>)<span class="number">0.5</span> * Vector3.right;</span><br><span class="line">        vz = Vector3.zero;</span><br><span class="line">        a = (<span class="keyword">float</span>)<span class="number">0.1</span> * Vector3.forward;</span><br><span class="line">        t = Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyCapsule.transform.position += vx;</span><br><span class="line">        MyCapsule.transform.position += vz;</span><br><span class="line">        vz += a * t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">- 使用Rigidbody  </span><br><span class="line">``` csharp</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Parabola3</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Rigidbody rigid;</span><br><span class="line">    <span class="keyword">private</span> Vector3 v0;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        rigid = <span class="keyword">this</span>.GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">        v0 = <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">        rigid.velocity = v0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>具体实现见Solar.cs文件，以下部分是效果图和部分核心代码  </p>
<ul>
<li>材质<br>从网上下载各个行星对应的材质</li>
<li><p>自转(以地球自转为例)</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Earth.Rotate(Vector3.up * <span class="number">30</span> * Time.deltaTime);</span><br></pre></td></tr></table></figure>
</li>
<li><p>公转(以地球公转为例)</p>
<pre><code class="csharp">Earth.RotateAround(Sun.position, axis3, <span class="number">10</span> * Time.deltaTime);
</code></pre>
<p>月球绕地球转只需将绕点设成地球的position即可，有个地方要注意的是必须把月球放在地球的子对象中，否则会失去随地球绕太阳公转这一属性，显得有滞后性</p>
</li>
<li>轨迹<br>添加一个Trail Render的组件记录行星移动轨迹</li>
<li>轨道不同面<br>调整各个行星的公转轴使其不朝着一个方向即可</li>
<li>自发光<ul>
<li>将太阳的材质设置成可发光类型</li>
<li>在太阳的中心防止一个点光源</li>
<li>修改背景以显示阴影效果</li>
</ul>
</li>
<li>效果图<br><img src="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/Solar1.jpg" alt="solar1"><br><img src="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/Solar2.jpg" alt="solar2"></li>
<li>对象结构<br><img src="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/Solar3.jpg" alt="solar3"></li>
</ul>
</li>
</ol>
<h1 id="编程题"><a href="#编程题" class="headerlink" title="编程题"></a>编程题</h1><ul>
<li>动作表 </li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">动作</th>
<th style="text-align:center">条件</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">上船</td>
<td style="text-align:center">船靠所在岸且船没坐满</td>
</tr>
<tr>
<td style="text-align:center">上岸</td>
<td style="text-align:center">船靠岸</td>
</tr>
<tr>
<td style="text-align:center">开船</td>
<td style="text-align:center">船靠岸且船上有牧师或魔鬼</td>
</tr>
<tr>
<td style="text-align:center">失败</td>
<td style="text-align:center">船靠岸且一侧魔鬼多于牧师</td>
</tr>
<tr>
<td style="text-align:center">获胜</td>
<td style="text-align:center">牧师魔鬼全部在对岸</td>
</tr>
</tbody>
</table>
<ul>
<li>核心要求<ul>
<li>MVC架构</li>
<li>对象均由代码创建</li>
<li>不使用Find等耦合语句</li>
</ul>
</li>
<li>亮点<ul>
<li>抛物线上下船</li>
<li>UI</li>
<li>计时</li>
<li>计步</li>
</ul>
</li>
<li>效果图<ul>
<li>游戏界面<br><img src="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/PriestAndDevil1.jpg" alt="PriestAndDevil1"></li>
<li>胜利界面<br><img src="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/PriestAndDevil2.jpg" alt="PriestAndDevil2"></li>
<li>失败界面<br><img src="/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/PriestAndDevil3.jpg" alt="PriestAndDevil3"></li>
</ul>
</li>
<li>本项目Github地址——<a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework2" target="_blank" rel="noopener">传送门</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/03/Unity3d-hw2-太阳系-魔鬼与牧师v1/" data-id="cjmdefsxi00055sq2ucqsja6x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity3d/">Unity3d</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中级实训/">中级实训</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Unity3d/" style="font-size: 20px;">Unity3d</a> <a href="/tags/中级实训/" style="font-size: 10px;">中级实训</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/09/22/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/06/24/Unity3d-hw10-联机冰球对战/">Unity-hw10-联机冰球对战</a>
          </li>
        
          <li>
            <a href="/2018/06/19/Unity3d-hw9-AR小游戏/">Unity3d-hw9-AR小游戏</a>
          </li>
        
          <li>
            <a href="/2018/06/06/Unity3d-hw8-背包系统/">Unity3d-hw8-背包系统</a>
          </li>
        
          <li>
            <a href="/2018/05/28/Unity3d-hw7-粒子系统/">Unity3d-hw7-粒子系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 xie tao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>