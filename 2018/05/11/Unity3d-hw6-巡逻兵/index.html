<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Unity3d-hw6-巡逻兵 | gitgiter&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="巡逻兵——MVC+工厂+订阅与发布模式游戏简介巡逻兵游戏是一款敏捷类游戏，我将游戏规则制定如下：  英雄：玩家 怪物：巡逻兵 当英雄出现在怪物一定范围内，怪物会开启追捕模式，即速度加快 每躲过一个巡逻兵的追捕，获得1分 当英雄没有进入怪物的搜寻范围时，怪物随机移动 被怪物追捕到即游戏结束 创新点：规则简单，游戏地形较复杂设计模式   MVC模式MVC模式在之前的有关牧师与魔鬼的博客中有详细解释过，">
<meta name="keywords" content="Unity3d">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity3d-hw6-巡逻兵">
<meta property="og:url" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/index.html">
<meta property="og:site_name" content="gitgiter&#39;s blog">
<meta property="og:description" content="巡逻兵——MVC+工厂+订阅与发布模式游戏简介巡逻兵游戏是一款敏捷类游戏，我将游戏规则制定如下：  英雄：玩家 怪物：巡逻兵 当英雄出现在怪物一定范围内，怪物会开启追捕模式，即速度加快 每躲过一个巡逻兵的追捕，获得1分 当英雄没有进入怪物的搜寻范围时，怪物随机移动 被怪物追捕到即游戏结束 创新点：规则简单，游戏地形较复杂设计模式   MVC模式MVC模式在之前的有关牧师与魔鬼的博客中有详细解释过，">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://5b0988e595225.cdn.sohucs.com/images/20171128/ad665eccfa2a488b9628f6e36b762c02.jpeg">
<meta property="og:image" content="http://5b0988e595225.cdn.sohucs.com/images/20171128/72bb65ed99dd44c48eb6962b9d140ea1.jpeg">
<meta property="og:image" content="http://5b0988e595225.cdn.sohucs.com/images/20171128/7c5a95aa8ee348d9b7dff8417e4edb4e.jpeg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/scene.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/hero.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/patrol.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/file.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/camera.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/empty.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/hero1.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/patrol1.jpg">
<meta property="og:image" content="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/scene1.jpg">
<meta property="og:updated_time" content="2018-05-11T16:48:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity3d-hw6-巡逻兵">
<meta name="twitter:description" content="巡逻兵——MVC+工厂+订阅与发布模式游戏简介巡逻兵游戏是一款敏捷类游戏，我将游戏规则制定如下：  英雄：玩家 怪物：巡逻兵 当英雄出现在怪物一定范围内，怪物会开启追捕模式，即速度加快 每躲过一个巡逻兵的追捕，获得1分 当英雄没有进入怪物的搜寻范围时，怪物随机移动 被怪物追捕到即游戏结束 创新点：规则简单，游戏地形较复杂设计模式   MVC模式MVC模式在之前的有关牧师与魔鬼的博客中有详细解释过，">
<meta name="twitter:image" content="http://5b0988e595225.cdn.sohucs.com/images/20171128/ad665eccfa2a488b9628f6e36b762c02.jpeg">
  
    <link rel="alternate" href="/atom.xml" title="gitgiter&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gitgiter&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Unity3d-hw6-巡逻兵" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/11/Unity3d-hw6-巡逻兵/" class="article-date">
  <time datetime="2018-05-11T15:44:17.000Z" itemprop="datePublished">2018-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Unity3d-hw6-巡逻兵
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="巡逻兵——MVC-工厂-订阅与发布模式"><a href="#巡逻兵——MVC-工厂-订阅与发布模式" class="headerlink" title="巡逻兵——MVC+工厂+订阅与发布模式"></a>巡逻兵——MVC+工厂+订阅与发布模式</h1><h2 id="游戏简介"><a href="#游戏简介" class="headerlink" title="游戏简介"></a>游戏简介</h2><p>巡逻兵游戏是一款敏捷类游戏，我将游戏规则制定如下：</p>
<ul>
<li>英雄：玩家</li>
<li>怪物：巡逻兵</li>
<li>当英雄出现在怪物一定范围内，怪物会开启追捕模式，即速度加快</li>
<li>每躲过一个巡逻兵的追捕，获得1分</li>
<li>当英雄没有进入怪物的搜寻范围时，怪物随机移动</li>
<li>被怪物追捕到即游戏结束</li>
<li>创新点：规则简单，游戏地形较复杂<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2></li>
</ul>
<ol>
<li>MVC模式<br>MVC模式在之前的有关牧师与魔鬼的博客中有详细解释过，这里沿用的是牧师与魔鬼的MVC框架，在此基础上做了一些改动，如果有兴趣可以到我的相关博客查看，这次主要解释下面两个模式。</li>
<li>工厂模式</li>
</ol>
<ul>
<li>为什么需要工厂模式<br>游戏对象的创建与销毁成本较高，所以当游戏涉及大量游戏对象的创建与销毁时，必须考虑减少销毁次数，比如这次的打飞碟游戏，或者像其他类型的射击游戏，其中子弹或者中弹对象的创建与销毁是很频繁的。</li>
<li>工厂模式的定义<br>工厂模式是我们最常用的实例化对象模式了，是用工厂方法代替new操作的一种模式。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。</li>
<li>工厂模式的结构<br>游戏对象的创建与销毁，分别对应工厂里面的两个List，这两个List分别存放正在使用的游戏对象，已失效的游戏对象。同时保存两个List的目的是，减少游戏对象的创建与销毁的性能开销。如果已失效的List里面还有item，而这时工厂又需要完成一个新的“订单”，便可以从这些回收的item中拿出来再加工（一些逻辑处理），再返回给用户（调用方）。  </li>
<li>工厂模式的优缺点<ul>
<li>优点 <ul>
<li>一个调用者想创建一个对象，只要知道其名称就可以了。 - 扩展性高，如果想增加一个产品，只要扩展一个工厂类就可以。 </li>
<li>屏蔽产品的具体实现，调用者只关心产品的接口。</li>
<li>例子，如果一个客户需要一辆汽车，可以直接从工厂里面提货，而不用去管这辆汽车是怎么做出来的，以及这个汽车里面的具体实现。</li>
</ul>
</li>
<li>缺点<ul>
<li>一开始实现会比较复杂，需要用心设计一下工厂的结构</li>
<li>每增加一个产品，可能都需要对工厂进行一次较大的“整改”</li>
<li>如果工厂太大，实时保存的所有游戏对象的开销可能要大于游戏对象直接创建与销毁</li>
</ul>
</li>
</ul>
</li>
<li>工厂模式的意义（以上次打飞碟代码为例，我觉得上次的比较典型）<br>体现了面向对象设计的核心——抽象、包装、隐藏。道具工厂通过场景单实例，构建了可以被方便获取的disk类。包装了复杂的disk生产和回收逻辑，易于使用。包装了disk的产生规则，有利于应对未来游戏规则的变化，易于维护。</li>
<li>本次作业的工厂模式<br>本次巡逻兵的项目作业，还是按照要求套用了工厂模式，但由于我的规则设置比较简单，在套用上次的工厂模式框架后其实发现没什么必要，因为我的巡逻兵数目是固定的，从头到尾就是6个，没有新增也没有销毁，当时有想过随着时间的增加而增加巡逻兵的数量以增加游戏难度，以及玩家攻击巡逻兵可以导致巡逻兵销毁。但在我的地形的基础上，6个巡逻兵其实刚好，少了太简单，多了又难到玩不下去，要说玩家可以攻击巡逻兵以达到控制巡逻兵数量的话，那每个巡逻兵都可以被攻击，玩家就没有逃跑的必要了。所以在用完工厂模式的时候，其实还是有点想删掉工厂模式的，但是想想如果后面需要对这次游戏规则做一些改变的话，工厂模式留着还是挺有用的。</li>
</ul>
<ol start="3">
<li>订阅与发布模式</li>
</ol>
<ul>
<li>为什么需要订阅与发布模式<br>就像我们订阅报刊，有什么时事新闻出现，报社（发布者）可以第一时间印刷数百份乃至数千份报纸（传播媒介），发到各个订阅了该报纸的人（订阅者）手上，这样就完成了信息传播。</li>
<li>订阅与发布模式的定义<br>在计算机编程中，订阅与发布模式与观察者模式比较容易混淆。用几张图来说明，他们之间主要的区别<ul>
<li>观察者模式的结构<br>在观察者模式中，观察者需要直接订阅目标事件；在目标发出内容改变的事件后，直接接收事件并作出响应<br><img src="http://5b0988e595225.cdn.sohucs.com/images/20171128/ad665eccfa2a488b9628f6e36b762c02.jpeg" alt=""></li>
<li>订阅与发布模式的结构<br>在发布订阅模式中，发布者和订阅者之间多了一个发布通道；一方面从发布者接收事件，另一方面向订阅者发布事件；订阅者需要从事件通道订阅事件。以此避免发布者和订阅者之间产生依赖关系。<br><img src="http://5b0988e595225.cdn.sohucs.com/images/20171128/72bb65ed99dd44c48eb6962b9d140ea1.jpeg" alt=""></li>
<li>主要区别，直接和间接<br><img src="http://5b0988e595225.cdn.sohucs.com/images/20171128/7c5a95aa8ee348d9b7dff8417e4edb4e.jpeg" alt=""></li>
</ul>
</li>
<li>本次的项目的应用<br>当玩家得分或游戏结束时，都会GameEventManager的得分/游戏结束方法，但是具体怎么实现不用管。因为有可能后期需求更改，得分/游戏结束后需要实现更多效果。而此时我们只需要让这些效果订阅GameEventManager发布的得分/游戏结束信息，即可产生作用。实现功能的分类，降低代码耦合。</li>
</ul>
<h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><ul>
<li>基本地形<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/scene.jpg" alt=""></li>
<li>英雄模型<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/hero.jpg" alt=""></li>
<li>怪物模型<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/patrol.jpg" alt=""></li>
</ul>
<h2 id="重要类实现，代码请直接在项目中查看"><a href="#重要类实现，代码请直接在项目中查看" class="headerlink" title="重要类实现，代码请直接在项目中查看"></a>重要类实现，代码请直接在项目中查看</h2><ul>
<li>文件框架结构<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/file.jpg" alt=""><ul>
<li>ActionControl.cs，基础的动作管理类的集合，该文件里都是一些和动作管理有关的类。相当于动作的controller。</li>
<li>BaseCode.cs，一些最基本的类和接口的集合，如单实例导演类，控制场景的切换，IUserAction、回调接口等</li>
<li>FirstControl.cs，只包含FirstControl—控制第一个场景的类</li>
<li>GameEventManager.cs，只包含GameEventManager—发布者</li>
<li>UserGUI.cs，只包含UserGUI—订阅者兼用户界面管理器，比如显示分数、游戏状态以及监听键盘事件以控制角色的动画（走跑跳停等）</li>
<li>GameModel.cs，只包含GameModel—游戏模型，包括一些判定规则和运动规则</li>
<li>PatrolControl.cs，只包含PatrolControl—怪物（巡逻兵）的controller</li>
<li>HeroControl.cs，只包含HeroControl—英雄的controller</li>
<li>PatrolFactory.cs，只包含PatrolFactory—巡逻兵的制造工厂</li>
<li>Follow.cs，摄像机跟随人物移动的脚本</li>
</ul>
</li>
<li>脚本挂载与组件添加情况  <ul>
<li>camera<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/camera.jpg" alt=""></li>
<li>空对象<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/empty.jpg" alt=""></li>
<li>英雄<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/hero1.jpg" alt=""></li>
<li>巡逻兵<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/patrol1.jpg" alt=""></li>
<li>地形<br><img src="/2018/05/11/Unity3d-hw6-巡逻兵/scene1.jpg" alt=""></li>
</ul>
</li>
<li><p>代码</p>
<ul>
<li>ActionControl，这部分很长，但是基本套用模板，不需要改动太多，因此不放出来。</li>
<li><p>BaseCode.cs</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MyGame</span></span><br><span class="line">&#123;</span><br><span class="line">    public class Director : System.Object</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Director _instance;</span><br><span class="line">        <span class="keyword">public</span> ISceneControl sceneCtrl &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">bool</span> playing &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Director <span class="title">getInstance</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (_instance == <span class="literal">null</span>) <span class="keyword">return</span> _instance = <span class="keyword">new</span> Director();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> _instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFPS</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Application.targetFrameRate;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFPS</span>(<span class="params"><span class="keyword">int</span> fps</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Application.targetFrameRate = fps;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class Singleton&lt;T&gt; : MonoBehaviour where T : MonoBehaviour</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">static</span> T instance;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//instance = new GameObject(typeof(T).Name).AddComponent&lt;T&gt;();</span></span><br><span class="line">                    instance = (T)FindObjectOfType(<span class="keyword">typeof</span>(T));</span><br><span class="line">                    <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Debug.LogError(<span class="string">"no scene instance"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISSActionCallback</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">ActionDone</span>(<span class="params">SSAction source, <span class="keyword">bool</span> catchState = <span class="literal">false</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISceneControl</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">LoadPrefabs</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUserAction</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">heroMove</span>(<span class="params"><span class="keyword">int</span> dir</span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Diretion</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> UP = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> DOWN = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> LEFT = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">int</span> RIGHT = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IAddAction</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">addRandomMovement</span>(<span class="params">GameObject sourceObj, <span class="keyword">bool</span> isActive</span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">addDirectMovement</span>(<span class="params">GameObject sourceObj</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IGameStatusOp</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">Transform <span class="title">getHeroPosition</span>(<span class="params"></span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">heroEscapeAndScore</span>(<span class="params"></span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">patrolHitHeroAndGameover</span>(<span class="params"></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FirstControl</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.SceneManagement;</span><br><span class="line"></span><br><span class="line">public class FirstControl : MonoBehaviour, ISceneControl, IGameStatusOp, IUserAction, IAddAction</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//public ActionManager MyActionManager &#123; get; set; &#125;</span></span><br><span class="line">    <span class="keyword">public</span> GameEventManager gameEventManager;</span><br><span class="line">    <span class="keyword">public</span> GameModel gameModel;</span><br><span class="line">    <span class="keyword">public</span> PatrolFactory factory &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> UserGUI user;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Director diretor = Director.getInstance();</span><br><span class="line">        diretor.sceneCtrl = <span class="keyword">this</span>;                              </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Begin();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadPrefabs</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Begin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        LoadPrefabs();</span><br><span class="line">        <span class="comment">//MyActionManager = gameObject.AddComponent&lt;ActionManager&gt;() as ActionManager;        </span></span><br><span class="line">        gameEventManager = gameObject.AddComponent&lt;GameEventManager&gt;() <span class="keyword">as</span> GameEventManager;</span><br><span class="line">        <span class="comment">//gameModel = gameObject.AddComponent&lt;GameModel&gt;() as GameModel;</span></span><br><span class="line">        Debug.Log(<span class="string">"game model init"</span>);</span><br><span class="line">        user = gameObject.AddComponent&lt;UserGUI&gt;();</span><br><span class="line">        user.Begin();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SceneManager.LoadScene(<span class="string">"scene"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heroMove</span>(<span class="params"><span class="keyword">int</span> dir</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameModel.heroMove(dir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRandomMovement</span>(<span class="params">GameObject sourceObj, <span class="keyword">bool</span> isActive</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameModel.addRandomMovement(sourceObj, isActive);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDirectMovement</span>(<span class="params">GameObject sourceObj</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameModel.addDirectMovement(sourceObj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Transform <span class="title">getHeroPosition</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gameModel.getHeroPosition();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heroEscapeAndScore</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameEventManager.heroEscapeAndScore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patrolHitHeroAndGameover</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        gameEventManager.patrolHitHeroAndGameover();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>GameEventManager</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameEventManager</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">GameScoreAction</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> GameScoreAction myGameScoreAction;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">GameOverAction</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> GameOverAction myGameOverAction;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FirstControl scene;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        scene = (FirstControl)Director.getInstance().sceneCtrl;</span><br><span class="line">        scene.gameEventManager = <span class="keyword">this</span>;</span><br><span class="line">    &#125;        </span><br><span class="line"></span><br><span class="line">    <span class="comment">//hero escape, get score</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heroEscapeAndScore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (myGameScoreAction != <span class="literal">null</span>)</span><br><span class="line">            myGameScoreAction();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//hero gets caught, game over</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">patrolHitHeroAndGameover</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (myGameOverAction != <span class="literal">null</span>)</span><br><span class="line">            myGameOverAction();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserGUI</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserGUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IUserAction action;</span><br><span class="line">    GUIStyle LabelStyle1;</span><br><span class="line">    GUIStyle LabelStyle2;</span><br><span class="line">    GUIStyle ButtonStyle;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> score = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> round = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> CoolTimes = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> game = <span class="number">0</span>; <span class="comment">// status</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        action = (IUserAction)Director.getInstance().sceneCtrl;</span><br><span class="line"></span><br><span class="line">        LabelStyle1 = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        LabelStyle1.fontSize = <span class="number">20</span>;</span><br><span class="line">        LabelStyle1.alignment = TextAnchor.MiddleCenter;</span><br><span class="line"></span><br><span class="line">        LabelStyle2 = <span class="keyword">new</span> GUIStyle();</span><br><span class="line">        LabelStyle2.fontSize = <span class="number">30</span>;</span><br><span class="line">        LabelStyle2.alignment = TextAnchor.MiddleCenter;</span><br><span class="line"></span><br><span class="line">        ButtonStyle = <span class="keyword">new</span> GUIStyle(<span class="string">"Button"</span>);</span><br><span class="line">        ButtonStyle.fontSize = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//check key input and decide whether the hero should play animation</span></span><br><span class="line">        GameObject hero = ((FirstControl)Director.getInstance().sceneCtrl).gameModel.getHero();        </span><br><span class="line">        <span class="keyword">bool</span> keyPressed = <span class="literal">false</span>;        </span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.UpArrow) || Input.GetKey(KeyCode.W))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.UP);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.DownArrow) || Input.GetKey(KeyCode.S))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.DOWN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.LeftArrow) || Input.GetKey(KeyCode.A))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.LEFT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.RightArrow) || Input.GetKey(KeyCode.D))</span><br><span class="line">        &#123;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Run"</span>);</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            action.heroMove(Diretion.RIGHT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.J))</span><br><span class="line">        &#123;</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Attack"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKey(KeyCode.Space))</span><br><span class="line">        &#123;</span><br><span class="line">            keyPressed = <span class="literal">true</span>;</span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"Jump"</span>, PlayMode.StopAll);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (keyPressed == <span class="literal">false</span>)</span><br><span class="line">        &#123;                    </span><br><span class="line">            hero.GetComponent&lt;Animation&gt;().Play(<span class="string">"idle"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//cool time system</span></span><br><span class="line">        time += Time.deltaTime;</span><br><span class="line">        <span class="keyword">if</span> (time &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        time = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (game == <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (CoolTimes &gt; <span class="number">1</span>) CoolTimes--;</span><br><span class="line">            <span class="keyword">else</span> game = <span class="number">0</span>;</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        CoolTimes = <span class="number">3</span>;</span><br><span class="line">        game = <span class="number">3</span>;</span><br><span class="line">        score = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Begin</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Restart();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (game == <span class="number">0</span>) <span class="comment">// playing</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span>, Screen.height / <span class="number">2</span> - <span class="number">160</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Score: "</span> + score, LabelStyle1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (game == <span class="number">1</span>) <span class="comment">// game over</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">85</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Gameover!"</span>, LabelStyle2);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">70</span>, Screen.height / <span class="number">2</span>, <span class="number">140</span>, <span class="number">70</span>), <span class="string">"Restart"</span>, ButtonStyle))</span><br><span class="line">            &#123;</span><br><span class="line">                game = <span class="number">0</span>;</span><br><span class="line">                action.Restart();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (game == <span class="number">2</span>) <span class="comment">// win</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, Screen.height / <span class="number">2</span> - <span class="number">85</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"You win!"</span>, LabelStyle2);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">70</span>, Screen.height / <span class="number">2</span>, <span class="number">140</span>, <span class="number">70</span>), <span class="string">"Restart"</span>, ButtonStyle))</span><br><span class="line">            &#123;</span><br><span class="line">                game = <span class="number">0</span>;</span><br><span class="line">                action.Restart();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (game == <span class="number">3</span>) <span class="comment">// ready</span></span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">30</span>, Screen.height / <span class="number">2</span>, <span class="number">100</span>, <span class="number">50</span>), CoolTimes.ToString(), LabelStyle2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GameEventManager.myGameScoreAction += getScore;</span><br><span class="line">        GameEventManager.myGameOverAction += gameOver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        GameEventManager.myGameScoreAction -= getScore;</span><br><span class="line">        GameEventManager.myGameOverAction -= gameOver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getScore</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        score++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">gameOver</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        game = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>PatrolControl</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PatrolControl</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> IAddAction addAction;</span><br><span class="line">    <span class="keyword">private</span> IGameStatusOp gameStatusOp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> whichPatrol;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span> isCatching; <span class="comment">//whether found hero</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> CATCH_RADIUS = <span class="number">3.0</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        addAction = (FirstControl)Director.getInstance().sceneCtrl <span class="keyword">as</span> IAddAction;</span><br><span class="line">        gameStatusOp = (FirstControl)Director.getInstance().sceneCtrl <span class="keyword">as</span> IGameStatusOp;</span><br><span class="line"></span><br><span class="line">        whichPatrol = getIndex();</span><br><span class="line">        isCatching = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//check</span></span><br><span class="line">        <span class="keyword">if</span> (Vector3.Distance(gameStatusOp.getHeroPosition().position, gameObject.transform.position) &lt;= <span class="number">20</span>f)</span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="comment">//hero go in the area</span></span><br><span class="line">            <span class="comment">//start catching</span></span><br><span class="line">            <span class="keyword">if</span> (!isCatching)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.Log(<span class="keyword">this</span>.gameObject + <span class="string">" is catching"</span>);</span><br><span class="line">                isCatching = <span class="literal">true</span>;                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//moves direct to the hero</span></span><br><span class="line">            addAction.addDirectMovement(<span class="keyword">this</span>.gameObject);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (isCatching)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.Log(<span class="keyword">this</span>.gameObject + <span class="string">" stops catching"</span>);</span><br><span class="line">                <span class="comment">//hero has moved out of the area</span></span><br><span class="line">                <span class="comment">//stop catching </span></span><br><span class="line">                gameStatusOp.heroEscapeAndScore();</span><br><span class="line">                isCatching = <span class="literal">false</span>;                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//then moves randomly</span></span><br><span class="line">            addAction.addRandomMovement(<span class="keyword">this</span>.gameObject, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//get the index of patrol</span></span><br><span class="line">        <span class="keyword">string</span> name = <span class="keyword">this</span>.gameObject.name;</span><br><span class="line">        <span class="keyword">return</span> name[name.Length - <span class="number">1</span>] - <span class="string">'0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnCollisionStay</span>(<span class="params">Collision e</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//hit other patrol, move to other direction</span></span><br><span class="line">        <span class="keyword">if</span> (e.gameObject.name.Contains(<span class="string">"Patrol"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            isCatching = <span class="literal">false</span>;</span><br><span class="line">            addAction.addRandomMovement(<span class="keyword">this</span>.gameObject, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//hit hero, game over</span></span><br><span class="line">        <span class="keyword">if</span> (e.gameObject.name.Contains(<span class="string">"hero"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            gameStatusOp.patrolHitHeroAndGameover();</span><br><span class="line">            Debug.Log(<span class="string">"Game Over!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Follow</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> MyGame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Follow</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Vector3 offset;</span><br><span class="line">    <span class="keyword">private</span> Transform playerBip;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> smoothing = <span class="number">0.5</span>f;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this for initialization</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        playerBip = GameObject.Find(<span class="string">"hero"</span>).transform;</span><br><span class="line">        offset = transform.position - playerBip.position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//transform.position = playerBip.position + offset;</span></span><br><span class="line">        Vector3 targetPos = playerBip.position + offset;</span><br><span class="line">        transform.position = Vector3.Lerp(transform.position, targetPos, smoothing * Time.deltaTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>以上多数为个人理解，可能有误，仅供参考。</li>
<li>本次项目觉得做得最好的模式是MVC，在之前几次的基础上渐渐改进，本次项目分离得比较彻底，耦合度低了许多。</li>
<li>如感兴趣，可访问笔者Gayhub项目地址—<a href="https://github.com/gitgiter/unity3d-learning/tree/master/homework6" target="_blank" rel="noopener">传送门</a></li>
<li>视频演示地址—<a href="https://www.bilibili.com/video/av23309694/" target="_blank" rel="noopener">传送门</a></li>
<li>csdn博客地址—<a href="https://mp.csdn.net/mdeditor/80288017" target="_blank" rel="noopener">传送门</a></li>
</ul>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/11/Unity3d-hw6-巡逻兵/" data-id="cjmde5kx20009ikq2lrzh8d8c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3d/">Unity3d</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/05/28/Unity3d-hw7-粒子系统/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Unity3d-hw7-粒子系统
        
      </div>
    </a>
  
  
    <a href="/2018/04/24/Unity3d-hw5-打飞碟-混合版/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Unity3d-hw5-打飞碟(混合版)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity3d/">Unity3d</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中级实训/">中级实训</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Unity3d/" style="font-size: 20px;">Unity3d</a> <a href="/tags/中级实训/" style="font-size: 10px;">中级实训</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/09/22/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/06/24/Unity3d-hw10-联机冰球对战/">Unity-hw10-联机冰球对战</a>
          </li>
        
          <li>
            <a href="/2018/06/19/Unity3d-hw9-AR小游戏/">Unity3d-hw9-AR小游戏</a>
          </li>
        
          <li>
            <a href="/2018/06/06/Unity3d-hw8-背包系统/">Unity3d-hw8-背包系统</a>
          </li>
        
          <li>
            <a href="/2018/05/28/Unity3d-hw7-粒子系统/">Unity3d-hw7-粒子系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 xie tao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>